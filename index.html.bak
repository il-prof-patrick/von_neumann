<!DOCTYPE html>
<html lang="it">

<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1.0">
	<title>Architettura di Von Neumann</title>
	<!-- Tailwind CSS -->
	<script src="https://cdn.tailwindcss.com"></script>
	<!-- Google Fonts -->
	<link
		href="https://fonts.googleapis.com/css2?family=Space+Grotesk:wght@300;400;700&family=Space+Mono:ital,wght@0,400;0,700;1,400&display=swap"
		rel="stylesheet">
	<link href="https://fonts.googleapis.com/css2?family=VT323&display=swap" rel="stylesheet">
	<!-- Lucide Icons -->
	<script src="https://unpkg.com/lucide@latest"></script>
	<!-- Tailwind Config -->
	<script>
		tailwind.config = {
			theme: {
				extend: {
					colors: {
						'neon-blue': '#00f3ff',
						'neon-purple': '#bc13fe',
						'neon-green': '#00ff9d',
						'neon-pink': '#ff0099',
						'neon-amber': '#ffbf00',
						'neon-red': '#ff3333',
						'neon-teal': '#2dd4bf',
						'neon-orange': '#ff8800',
						'neon-lime': '#ccff00',
						'neon-yellow': '#facc15',
						'dark-bg': '#0a0a0f',
						'dark-card': '#13131f',
						'dark-lighter': '#1c1c2e',
						'bios-blue': '#0000AA',
					},
					fontFamily: {
						sans: ['Space Grotesk', 'sans-serif'],
						mono: ['Space Mono', 'monospace'],
						retro: ['VT323', 'monospace'],
					},
					animation: {
						'pulse-slow': 'pulse 4s cubic-bezier(0.4, 0, 0.6, 1) infinite',
						'float': 'float 6s ease-in-out infinite',
						'fade-in': 'fadeIn 0.5s ease-out forwards',
						'flow': 'flowAnimation 2s infinite linear',
						'spin-slow': 'spin 12s linear infinite',
						'blink': 'blink 1s step-end infinite',
						'dash': 'dash 1s linear infinite',
						'spin-reverse': 'spinReverse 15s linear infinite',
						'metronome-swing': 'metronomeSwing 1.2s ease-in-out infinite',
					},
					keyframes: {
						float: {
							'0%, 100%': { transform: 'translateY(0)' },
							'50%': { transform: 'translateY(-20px)' },
						},
						fadeIn: {
							'0%': { opacity: '0', transform: 'translateY(10px)' },
							'100%': { opacity: '1', transform: 'translateY(0)' },
						},
						flowAnimation: {
							'0%': { strokeDashoffset: '24' },
							'100%': { strokeDashoffset: '0' },
						},
						blink: {
							'0%, 100%': { opacity: '1' },
							'50%': { opacity: '0' },
						},
						dash: {
							'to': { strokeDashoffset: '-20' }
						},
						spinReverse: {
							'from': { transform: 'rotate(360deg)' },
							'to': { transform: 'rotate(0deg)' }
						},
						metronomeSwing: {
							'0%, 100%': { transform: 'rotate(-30deg)' },
							'50%': { transform: 'rotate(30deg)' }
						}
					}
				}
			}
		}
	</script>
	<style>
		body {
			background-color: #0a0a0f;
			color: #e2e8f0;
			overflow-x: hidden;
			zoom: 1.25;
		}

		canvas {
			image-rendering: pixelated;
		}

		.bg-grid {
			background-size: 50px 50px;
			background-image: linear-gradient(to right, rgba(0, 243, 255, 0.05) 1px, transparent 1px),
				linear-gradient(to bottom, rgba(0, 243, 255, 0.05) 1px, transparent 1px);
		}

		.text-glow {
			text-shadow: 0 0 10px rgba(0, 243, 255, 0.5), 0 0 20px rgba(0, 243, 255, 0.3);
		}

		.text-glow-purple {
			text-shadow: 0 0 10px rgba(188, 19, 254, 0.5), 0 0 20px rgba(188, 19, 254, 0.3);
		}

		.border-glow {
			box-shadow: 0 0 15px rgba(0, 243, 255, 0.2);
		}

		::-webkit-scrollbar {
			width: 8px;
		}

		::-webkit-scrollbar-track {
			background: #0a0a0f;
		}

		::-webkit-scrollbar-thumb {
			background: #334155;
			border-radius: 4px;
		}

		::-webkit-scrollbar-thumb:hover {
			background: #00f3ff;
		}

		.sidebar {
			transition: transform 0.3s ease-in-out;
		}

		@keyframes metronome-manual {

			0%,
			100% {
				transform: rotate(-30deg);
			}

			50% {
				transform: rotate(30deg);
			}
		}

		.animate-metronome-manual {
			animation: metronome-manual 1.2s ease-in-out infinite;
			transform-origin: bottom;
		}

		.custom-scrollbar::-webkit-scrollbar {
			width: 4px;
		}

		.custom-scrollbar::-webkit-scrollbar-thumb {
			background: #334155;
		}

		.cycle-circle {
			transition: all 0.5s ease;
		}

		.cycle-circle:hover {
			transform: scale(1.05);
			box-shadow: 0 0 20px rgba(0, 243, 255, 0.3);
		}

		.sim-task {
			transition: all 0.5s cubic-bezier(0.4, 0, 0.2, 1);
		}

		.sim-core {
			transition: all 0.3s ease;
		}

		.sim-bar-fill {
			transition: width 0.1s linear;
		}

		.task-queue-enter {
			animation: slideIn 0.3s ease-out;
		}

		@keyframes slideIn {
			from {
				opacity: 0;
				transform: translateX(-20px);
			}

			to {
				opacity: 1;
				transform: translateX(0);
			}
		}

		/* Effetto Volatilità RAM */
		.ram-cell {
			transition: all 0.5s ease;
			position: relative;
			overflow: hidden;
		}

		.ram-cell.off {
			background-color: transparent !important;
			border-color: rgba(255, 255, 255, 0.05) !important;
			box-shadow: none !important;
		}

		.tape-container {
			mask-image: linear-gradient(to right, transparent, black 15%, black 85%, transparent);
		}

		/* CODICE VELOCITÀ - CSS */
		.bus-line {
			transition: background 0.3s ease;
		}

		.data-packet {
			transition: all 0s linear;
		}

		.loading-bar-inner {
			transition: width 0s linear;
		}

		/* FINE CODICE VELOCITÀ */
		.access-cell {
			transition: all 0.3s ease;
		}

		.active-ram {
			background-color: #bc13fe !important;
			color: white !important;
			box-shadow: 0 0 12px #bc13fe;
			border-color: white !important;
		}

		.active-seq {
			background-color: #ffbf00 !important;
			color: black !important;
			box-shadow: 0 0 12px #ffbf00;
			border-color: white !important;
		}

		.read-head {
			transition: left 0.3s cubic-bezier(0.4, 0, 0.2, 1), opacity 0.3s ease;
			filter: drop-shadow(0 0 5px #ffbf00);
			opacity: 0;
		}

		.capacitor-charge {
			transition: height 0.1s linear, background-color 0.5s ease;
		}

		.matrix-row:hover {
			background-color: rgba(188, 19, 254, 0.15);
		}

		.matrix-row:hover .row-addr {
			color: #bc13fe;
			font-weight: bold;
		}

		.matrix-bit {
			display: flex;
			align-items: center;
			justify-content: center;
			user-select: none;
			transition: all 0.2s ease;
		}

		.ram-stack-line {
			height: 10px;
			width: 100%;
			background: rgba(255, 255, 255, 0.1);
			border: 1px solid rgba(255, 255, 255, 0.2);
			margin-bottom: 2px;
		}

		/* STILE CASSETTIERA */
		.drawer-box {
			background: linear-gradient(180deg, #1c1c2e 0%, #0f0f1a 100%);
			border: 2px solid #334155;
			height: 24px;
			width: 100%;
			margin-bottom: 4px;
			display: flex;
			align-items: center;
			justify-content: center;
			position: relative;
			box-shadow: inset 0 2px 5px rgba(0, 0, 0, 0.5);
		}

		.drawer-handle {
			width: 12px;
			height: 3px;
			background: #475569;
			border-radius: 10px;
		}

		/* STILE LENTE DI INGRANDIMENTO */
		#magnifier-box {
			position: fixed;
			z-index: 2000;
			background-color: #000;
			border: 4px solid #facc15;
			box-shadow: 0 0 50px rgba(0, 0, 0, 0.9), 0 0 30px rgba(250, 204, 21, 0.3);
			display: none;
			flex-direction: column;
			border-radius: 16px;
			max-width: 95vw;
			width: 800px;
			height: 350px;
			max-height: 85vh;
			overflow: hidden;
			top: 50%;
			left: 50%;
			transform: translate(-50%, -50%);
			resize: both;
			min-width: 300px;
			min-height: 150px;
		}

		#magnifier-header {
			background: #facc15;
			padding: 8px 16px;
			display: flex;
			justify-content: space-between;
			align-items: center;
			cursor: move;
			user-select: none;
			flex-shrink: 0;
		}

		.magnifier-title {
			color: #000;
			font-family: 'Space Mono', monospace;
			font-weight: 800;
			font-size: 12px;
			text-transform: uppercase;
		}

		#magnifier-close {
			color: #000;
			cursor: pointer;
			background: rgba(0, 0, 0, 0.1);
			border-radius: 4px;
			padding: 2px;
			display: flex;
			align-items: center;
			justify-content: center;
		}

		#magnifier-close:hover {
			background: rgba(0, 0, 0, 0.2);
		}

		#magnifier-body {
			padding: 10px 30px 30px 30px;
			overflow-y: auto;
			display: block;
			/* Cambiato da flex a block per evitare di nascondere il testo in alto */
		}

		#magnifier-content {
			color: #facc15;
			font-size: 3rem;
			font-weight: 800;
			line-height: 1.3;
			font-family: 'Space Grotesk', sans-serif;
			word-wrap: break-word;
			overflow-wrap: break-word;
			text-align: center;
		}

		.magnifier-toggle-active {
			background-color: #facc15 !important;
			color: #000 !important;
			box-shadow: 0 0 15px rgba(250, 204, 21, 0.5);
		}

		/* BUS ANIMATION STYLES */
		@keyframes pulse-teal {

			0%,
			100% {
				box-shadow: 0 0 5px rgba(45, 212, 191, 0.2);
			}

			50% {
				box-shadow: 0 0 20px rgba(45, 212, 191, 0.6);
			}
		}

		.bus-line-pulse {
			animation: pulse-teal 2s infinite;
		}

		.data-pulse {
			position: absolute;
			width: 6px;
			height: 6px;
			background: #2dd4bf;
			border-radius: 50%;
			filter: blur(1px);
			box-shadow: 0 0 10px #2dd4bf;
		}

		@keyframes moveData {
			from {
				left: 0%;
			}

			to {
				left: 100%;
			}
		}

		.animate-move-data {
			animation: moveData 3s linear infinite;
		}

		/* BUS INTERACTION SIMULATOR */
		.bus-wire {
			height: 4px;
			background: rgba(255, 255, 255, 0.05);
			position: relative;
			border-radius: 2px;
		}

		.bus-wire-active-addr {
			background: rgba(251, 191, 36, 0.2);
			box-shadow: 0 0 10px rgba(251, 191, 36, 0.3);
		}

		.bus-wire-active-data {
			background: rgba(45, 212, 191, 0.2);
			box-shadow: 0 0 10px rgba(45, 212, 191, 0.3);
		}

		.bus-wire-active-control {
			background: rgba(188, 19, 254, 0.2);
			box-shadow: 0 0 10px rgba(188, 19, 254, 0.3);
		}

		.data-packet {
			position: absolute;
			top: -4px;
			left: -20px;
			padding: 2px 8px;
			border-radius: 4px;
			font-family: monospace;
			font-size: 10px;
			font-weight: bold;
			white-space: nowrap;
			transition: all 0.5s ease;
			opacity: 0;
			z-index: 20;
		}

		.packet-addr {
			background: #fbbf24;
			color: black;
			box-shadow: 0 0 15px #fbbf24;
		}

		.packet-data {
			background: #2dd4bf;
			color: black;
			box-shadow: 0 0 15px #2dd4bf;
		}

		.packet-control {
			background: #bc13fe;
			color: white;
			box-shadow: 0 0 15px #bc13fe;
		}

		@keyframes flowLeftToRight {
			0% {
				left: 0%;
				opacity: 0;
			}

			10% {
				opacity: 1;
			}

			90% {
				opacity: 1;
			}

			100% {
				left: calc(100% - 20px);
				opacity: 0;
			}
		}

		@keyframes flowRightToLeft {
			0% {
				left: calc(100% - 20px);
				opacity: 0;
			}

			10% {
				opacity: 1;
			}

			90% {
				opacity: 1;
			}

			100% {
				left: 0%;
				opacity: 0;
			}
		}

		.animate-flow-lr {
			animation: flowLeftToRight 4s ease-in-out forwards;
		}

		.animate-flow-rl {
			animation: flowRightToLeft 4s ease-in-out forwards;
		}

		/* BUS RAM STACK STYLES */
		.memory-stack {
			display: flex;
			flex-direction: column-reverse;
			gap: 2px;
			background: rgba(255, 255, 255, 0.05);
			padding: 4px;
			border-radius: 8px;
			border: 1px solid rgba(251, 191, 36, 0.2);
			width: 140px;
		}

		.stack-cell {
			display: flex;
			font-family: monospace;
			font-size: 9px;
			border-radius: 2px;
			background: rgba(0, 0, 0, 0.3);
			border: 1px solid transparent;
			transition: all 0.3s ease;
		}

		.stack-cell-addr {
			width: 40px;
			color: #fbbf24;
			border-right: 1px solid rgba(251, 191, 36, 0.2);
			padding: 2px 4px;
			background: rgba(251, 191, 36, 0.05);
		}

		.stack-cell-data {
			flex-grow: 1;
			color: #2dd4bf;
			padding: 2px 4px;
			text-align: center;
		}

		.stack-cell.active-ram-cell {
			border-color: #fbbf24;
			background: rgba(251, 191, 36, 0.2);
			box-shadow: 0 0 10px rgba(251, 191, 36, 0.3);
			transform: scale(1.05);
			z-index: 10;
		}
	</style>
</head>

<body class="bg-dark-bg bg-grid min-h-screen flex flex-col relative transition-all duration-300">
	<!-- Magnifier Box -->
	<div id="magnifier-box">
		<div id="magnifier-header">
			<span class="magnifier-title">Lente di Ingrandimento (Alt + Z)</span>
			<div id="magnifier-close">
				<i data-lucide="x" class="w-5 h-5"></i>
			</div>
		</div>
		<div id="magnifier-body">
			<div id="magnifier-content"></div>
		</div>
		<div id="magnifier-resize-bl"
			style="position: absolute; bottom: 0; left: 0; width: 15px; height: 15px; cursor: nesw-resize; z-index: 100;">
		</div>
	</div>
	<!-- Navbar -->
	<nav class="fixed top-0 w-full z-50 bg-dark-bg/80 backdrop-blur-md border-b border-white/10">
		<div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
			<div class="flex justify-between items-center h-16">
				<div class="flex items-center space-x-2 group cursor-pointer" onclick="navigateTo('home')">
					<i data-lucide="cpu" class="text-neon-blue w-8 h-8 group-hover:animate-spin"></i>
					<span
						class="font-mono font-bold text-xl tracking-wider group-hover:text-neon-blue transition-colors">VON_NEUMANN</span>
				</div>
				<div class="flex items-center space-x-6">
					<button id="magnifier-toggle"
						onclick="const s=window.getSelection().toString(); if(s) openMagnifier(s); else alert('Seleziona del testo prima!')"
						class="flex items-center gap-2 px-3 py-1.5 rounded-lg border border-neon-yellow/30 text-neon-yellow hover:bg-neon-yellow/10 transition-all group"
						title="Ingrandisci Selezione (Alt + Z)">
						<i data-lucide="zoom-in" class="w-5 h-5"></i>
						<span class="hidden lg:block font-mono text-xs font-bold uppercase tracking-tighter">LENTE
							(Alt+Z)</span>
					</button>
					<button id="menu-btn" class="p-2 rounded-md hover:bg-white/10 transition-colors group">
						<div class="flex items-center gap-2">
							<span class="hidden md:block font-mono text-sm text-gray-400 group-hover:text-white">INDICE
								LEZIONI</span>
							<i data-lucide="menu" class="text-white w-6 h-6"></i>
						</div>
					</button>
				</div>
			</div>
		</div>
	</nav>
	<!-- Sidebar Navigation -->
	<div id="sidebar"
		class="fixed top-0 right-0 h-full w-80 bg-dark-card border-l border-white/10 transform translate-x-full transition-transform duration-300 z-[60] p-6 shadow-2xl flex flex-col">
		<div class="flex justify-between items-center mb-8">
			<h2 class="text-xl font-mono font-bold text-white">INDICE</h2>
			<button id="close-btn" class="p-2 hover:bg-white/10 rounded-full transition-colors">
				<i data-lucide="x" class="w-6 h-6 text-gray-400 hover:text-white"></i>
			</button>
		</div>
		<div class="space-y-2 overflow-y-auto flex-grow pr-2 custom-scrollbar">
			<button onclick="navigateTo('home')"
				class="w-full text-left p-3 rounded hover:bg-white/5 text-gray-400 hover:text-white transition-colors flex items-center gap-3 group">
				<i data-lucide="home" class="w-4 h-4 group-hover:text-neon-blue"></i> Home
			</button>
			<div class="h-px bg-white/10 my-2"></div>
			<button onclick="navigateTo('lesson-1')"
				class="w-full text-left p-3 rounded hover:bg-white/5 text-gray-300 hover:text-neon-blue transition-colors font-mono text-sm group flex items-center gap-3">
				<span class="text-neon-blue/50 group-hover:text-neon-blue">01.</span> Hardware e Computer
			</button>
			<button onclick="navigateTo('lesson-2')"
				class="w-full text-left p-3 rounded hover:bg-white/5 text-gray-300 hover:text-neon-purple transition-colors font-mono text-sm group flex items-center gap-3">
				<span class="text-neon-purple/50 group-hover:text-neon-purple">02.</span> Architettura Von Neumann
			</button>
			<!-- VOCE SBLOCCATA: LEZIONE 3 -->
			<button onclick="navigateTo('lesson-3')"
				class="w-full text-left p-3 rounded hover:bg-white/5 text-gray-300 hover:text-neon-orange transition-colors font-mono text-sm group flex items-center gap-3">
				<span class="text-neon-orange/50 group-hover:text-neon-orange">03.</span> Scheda Madre
			</button>
			<button onclick="navigateTo('lesson-4')"
				class="w-full text-left p-3 rounded hover:bg-white/5 text-gray-300 hover:text-neon-teal transition-colors font-mono text-sm group flex items-center gap-3">
				<span class="text-neon-teal/50 group-hover:text-neon-teal">04.</span> Microprocessore (CPU)
			</button>
			<!-- VOCE SBLOCCATA: LEZIONE 5 -->
			<button onclick="navigateTo('lesson-5')"
				class="w-full text-left p-3 rounded hover:bg-white/5 text-gray-300 hover:text-neon-pink transition-colors font-mono text-sm group flex items-center gap-3">
				<span class="text-neon-pink/50 group-hover:text-neon-pink">05.</span> GPU
			</button>
			<button onclick="navigateTo('lesson-6')"
				class="w-full text-left p-3 rounded hover:bg-white/5 text-gray-300 hover:text-neon-purple transition-colors font-mono text-sm group flex items-center gap-3">
				<span class="text-neon-purple/50 group-hover:text-neon-purple">06.</span> La Memoria RAM
			</button>
			<button onclick="navigateTo('lesson-7')"
				class="w-full text-left p-3 rounded hover:bg-white/5 text-gray-300 hover:text-neon-amber transition-colors font-mono text-sm group flex items-center gap-3">
				<span class="text-neon-amber/50 group-hover:text-neon-amber">07.</span> La Memoria ROM
			</button>
			<button onclick="navigateTo('lesson-8')"
				class="w-full text-left p-3 rounded hover:bg-white/5 text-gray-300 hover:text-neon-teal transition-colors font-mono text-sm group flex items-center gap-3">
				<span class="text-neon-teal/50 group-hover:text-neon-teal">08.</span> Il Bus
			</button>
			<button onclick="navigateTo('lesson-9')"
				class="w-full text-left p-3 rounded hover:bg-white/5 text-gray-300 hover:text-neon-amber transition-colors font-mono text-sm group flex items-center gap-3">
				<span class="text-neon-amber/50 group-hover:text-neon-amber">09.</span> Memorie di Massa
			</button>
			<button onclick="navigateTo('lesson-10')"
				class="w-full text-left p-3 rounded hover:bg-white/5 text-gray-300 hover:text-neon-pink transition-colors font-mono text-sm group flex items-center gap-3">
				<span class="text-neon-pink/50 group-hover:text-neon-pink">10.</span> Periferiche e Porte
			</button>
		</div>

	</div>
	<div id="overlay"
		class="fixed inset-0 bg-black/50 backdrop-blur-sm z-50 hidden opacity-0 transition-opacity duration-300"></div>
	<main class="flex-grow flex flex-col items-center justify-start relative px-4 pt-24 pb-12 w-full">
		<!-- Background Decorativi (Shared) -->
		<div
			class="fixed top-1/4 left-1/4 w-72 h-72 bg-neon-blue/10 rounded-full blur-[100px] pointer-events-none animate-pulse-slow">
		</div>
		<div
			class="fixed bottom-1/4 right-1/4 w-96 h-96 bg-neon-purple/5 rounded-full blur-[120px] pointer-events-none">
		</div>
		<!-- ================= HOME VIEW ================= -->
		<div id="home-view" class="w-full flex flex-col items-center justify-center animate-fade-in my-auto h-full">
			<div class="text-center z-10 max-w-4xl mx-auto space-y-6 animate-float">
				<div class="inline-block border border-neon-blue/30 bg-neon-blue/5 rounded-full px-4 py-1 mb-4">
					<span class="font-mono text-neon-blue text-sm tracking-widest">1° Liceo Scientifico Digitale</span>
				</div>
				<h1 class="text-5xl md:text-7xl font-bold tracking-tight text-white mb-2">
					ARCHITETTURA DI<br>
					<span
						class="text-transparent bg-clip-text bg-gradient-to-r from-neon-blue to-neon-purple text-glow">VON
						NEUMANN</span>
				</h1>
				<p class="text-xl md:text-2xl text-gray-400 max-w-2xl mx-auto font-light leading-relaxed">
					Viaggio al centro del computer!
				</p>
				<div class="flex flex-col sm:flex-row items-center justify-center gap-4 mt-8">
					<button onclick="navigateTo('lesson-1')"
						class="px-8 py-4 bg-neon-blue text-black font-bold rounded hover:bg-white hover:shadow-[0_0_20px_rgba(0,243,255,0.6)] transition-all transform hover:-translate-y-1">
						INIZIA LEZIONE 1
					</button>
					<button onclick="openMenu()"
						class="px-8 py-4 border border-white/20 text-white rounded hover:bg-white/10 hover:border-white transition-all font-mono">
						INDICE
					</button>
				</div>
			</div>
		</div>
		<!-- ================= LESSON 1 VIEW ================= -->
		<div id="lesson-1-view" class="hidden w-full max-w-5xl mx-auto animate-fade-in z-10">
			<div class="mb-12 border-b border-white/10 pb-6">
				<span class="text-neon-blue font-mono text-sm tracking-widest">LEZIONE 01</span>
				<h1 class="text-4xl md:text-5xl font-bold text-white mt-2">Hardware e Computer</h1>
				<p class="text-gray-400 mt-4 text-lg">Le basi fondamentali: corpo e mente della macchina.</p>
			</div>
			<!-- Sezione 1: Cos'è un Computer -->
			<section class="mb-16">
				<div
					class="bg-dark-card border border-white/5 rounded-2xl p-8 hover:border-neon-blue/30 transition-all">
					<h2 class="text-2xl font-bold text-white mb-6 flex items-center gap-2">
						<i data-lucide="help-circle" class="text-neon-blue"></i>
						Che cos'è un Computer?
					</h2>
					<p class="text-gray-300 leading-relaxed text-lg mb-8 text-justify">
						In ogni attività della nostra vita quotidiana usiamo apparecchi che contengono computer.
						Un computer è un dispositivo elettronico che riceve dati come input, li elabora e produce
						risultati (output).
					</p>
					<!-- SCHEMA INPUT -> ELABORAZIONE -> OUTPUT -->
					<div
						class="flex flex-col md:flex-row items-center justify-between gap-4 bg-black/20 p-6 rounded-xl border border-white/5 my-8">
						<!-- Input Node -->
						<div class="flex flex-col items-center text-center space-y-2 group w-full md:w-1/3">
							<div
								class="w-16 h-16 rounded-full bg-green-500/10 border border-green-500/30 flex items-center justify-center group-hover:scale-110 transition-transform shadow-[0_0_15px_rgba(34,197,94,0.2)]">
								<i data-lucide="keyboard" class="text-green-400 w-8 h-8"></i>
							</div>
							<span class="font-mono text-green-400 font-bold text-lg">INPUT</span>
							<span class="text-xs text-gray-500">Dati in ingresso</span>
						</div>
						<!-- Arrow -->
						<i data-lucide="arrow-right" class="text-gray-600 w-8 h-8 rotate-90 md:rotate-0"></i>
						<!-- Processing Node -->
						<div class="flex flex-col items-center text-center space-y-2 group w-full md:w-1/3">
							<div
								class="relative w-24 h-24 rounded-xl bg-neon-blue/10 border border-neon-blue/50 flex items-center justify-center group-hover:scale-110 transition-transform shadow-[0_0_30px_rgba(0,243,255,0.2)]">
								<i data-lucide="cpu" class="text-neon-blue w-12 h-12 animate-pulse"></i>
								<div class="absolute -top-1 -right-1 w-3 h-3 bg-neon-blue rounded-full animate-ping">
								</div>
							</div>
							<span class="font-mono text-neon-blue font-bold text-xl text-glow">COMPUTER</span>
							<span class="text-xs text-gray-500">Elaborazione</span>
						</div>
						<!-- Arrow Elaborazione -> Output -->
						<i data-lucide="arrow-right" class="text-gray-600 w-8 h-8 rotate-90 md:rotate-0"></i>
						<!-- Output Node -->
						<div class="flex flex-col items-center text-center space-y-2 group w-full md:w-1/3">
							<div
								class="w-16 h-16 rounded-full bg-neon-purple/10 border border-neon-purple/30 flex items-center justify-center group-hover:scale-110 transition-transform shadow-[0_0_15px_rgba(188,19,254,0.2)]">
								<i data-lucide="monitor" class="text-neon-purple w-8 h-8"></i>
							</div>
							<span class="font-mono text-neon-purple font-bold text-lg">OUTPUT</span>
							<span class="text-xs text-gray-500">Risultati</span>
						</div>
					</div>
					<p class="text-gray-300 leading-relaxed text-lg mb-8 text-justify">
						In inglese to compute significa «calcolare», perciò in italiano il computer è detto anche
						calcolatore elettronico o elaboratore elettronico.
					</p>
				</div>
			</section>
			<!-- Sezione 2: Hardware vs Software -->
			<section class="mb-16">
				<h2 class="text-2xl font-bold text-white mb-6">Hardware e Software</h2>
				<div class="grid md:grid-cols-2 gap-8">
					<!-- Hardware Card -->
					<div
						class="group relative bg-dark-lighter p-8 rounded-2xl border border-neon-blue/20 hover:border-neon-blue transition-all overflow-hidden hover:shadow-[0_0_30px_rgba(0,243,255,0.1)] flex flex-col">
						<!-- Background Icon -->
						<div
							class="absolute -right-6 -bottom-6 opacity-5 group-hover:opacity-10 transition-opacity transform rotate-12">
							<i data-lucide="cpu" class="w-48 h-48 text-neon-blue"></i>
						</div>
						<h3 class="text-xl font-mono font-bold text-neon-blue mb-4 flex items-center gap-2">
							<i data-lucide="hard-drive" class="w-6 h-6"></i> HARDWARE (HW)
						</h3>
						<p class="text-gray-300 leading-relaxed mb-6 flex-grow text-justify">
							I componenti fisici del computer sono chiamati Hardware. <br><br> Dell'hardware fanno parte,
							per esempio, lo schermo e la tastiera di un notebook e la batteria e l'antenna Wi-Fi di uno
							smartphone.
						</p>
						<!-- Hardware Image -->
						<div
							class="mt-auto w-full h-72 rounded-xl overflow-hidden border border-neon-blue/30 relative group-hover:border-neon-blue/50 transition-colors">
							<div
								class="absolute inset-0 bg-neon-blue/10 mix-blend-overlay z-10 group-hover:bg-transparent transition-colors">
							</div>
							<img src="hw.png" alt="Computer Hardware"
								onerror="this.src='https://images.unsplash.com/photo-1591799264318-7e6ef8ddb7ea?auto=format&fit=crop&q=80&w=1000'"
								class="w-full h-full object-cover transform group-hover:scale-110 transition-transform duration-700">
						</div>
					</div>
					<!-- Software Card -->
					<div
						class="group relative bg-dark-lighter p-8 rounded-2xl border border-neon-purple/20 hover:border-neon-purple transition-all overflow-hidden hover:shadow-[0_0_30px_rgba(188,19,254,0.1)] flex flex-col">
						<!-- Background Icon -->
						<div
							class="absolute -right-6 -bottom-6 opacity-5 group-hover:opacity-10 transition-opacity transform -rotate-12">
							<i data-lucide="binary" class="w-48 h-48 text-neon-purple"></i>
						</div>
						<h3 class="text-xl font-mono font-bold text-neon-purple mb-4 flex items-center gap-2">
							<i data-lucide="code-2" class="w-6 h-6"></i> SOFTWARE (SW)
						</h3>
						<p class="text-gray-300 leading-relaxed mb-6 flex-grow text-justify">
							Il funzionamento dell'Hardware è controllato dal Software, cioè da programmi che codificano
							gli algoritmi usati per elaborare i dati. E' dunque la parte astratta e non tangibile del
							computer. <br><br>
							Esempi di software sono il sistema operativo del computer, il browser con cui si naviga in
							Internet e le varie app installate sullo smartphone.
						</p>
						<!-- Software Image -->
						<div
							class="mt-auto w-full h-72 rounded-xl overflow-hidden border border-neon-purple/30 relative group-hover:border-neon-purple/50 transition-colors">
							<div
								class="absolute inset-0 bg-neon-purple/10 mix-blend-overlay z-10 group-hover:bg-transparent transition-colors">
							</div>
							<img src="sw.jpg" alt="Software Code"
								onerror="this.src='https://images.unsplash.com/photo-1517694712202-14dd9538aa97?auto=format&fit=crop&q=80&w=1000'"
								class="w-full h-full object-cover transform group-hover:scale-110 transition-transform duration-700">
						</div>
					</div>
				</div>
			</section>
			<!-- Sezione 3: Tipi di Computer -->
			<section class="mb-16">
				<h2 class="text-2xl font-bold text-white mb-6">Tipi di Computer</h2>
				<p class="text-gray-300 text-lg mb-8">
					Non tutti i computer sono uguali, anche se spesso funzionano in modo simile.
				</p>
				<div class="grid md:grid-cols-3 gap-6">
					<!-- General Purpose -->
					<div
						class="bg-gradient-to-br from-blue-900/20 to-transparent p-6 rounded-2xl border border-blue-500/30 hover:border-blue-500 hover:shadow-[0_0_20px_rgba(59,130,246,0.2)] transition-all group h-full flex flex-col">
						<div
							class="w-14 h-14 bg-blue-500/20 rounded-xl flex items-center justify-center mb-6 group-hover:scale-110 transition-transform">
							<i data-lucide="laptop-2" class="w-8 h-8 text-blue-400"></i>
						</div>
						<h3 class="text-xl font-bold text-white mb-3">General Purpose</h3>
						<p class="text-blue-200 text-xs font-mono uppercase tracking-widest mb-4">A SCOPO GENERALE</p>
						<p class="text-gray-300 text-sm leading-relaxed text-justify mb-6 flex-grow">
							Sono quelli che possiamo usare per tantissime attività diverse: possiamo installare
							programmi, scrivere documenti, navigare, programmare.
						</p>
						<!-- Image Placeholder -->
						<div
							class="mt-auto w-full h-72 rounded-xl overflow-hidden border border-neon-purple/30 relative group-hover:border-neon-purple/50 transition-colors">
							<div
								class="absolute inset-0 bg-neon-purple/10 mix-blend-overlay z-10 group-hover:bg-transparent transition-colors">
							</div>
							<img src="general.jpg" alt="General purpose"
								onerror="this.src='https://images.unsplash.com/photo-1496181133206-80ce9b88a853?auto=format&fit=crop&q=80&w=1000'"
								class="w-full h-full object-cover transform group-hover:scale-110 transition-transform duration-700">
						</div>
					</div>
					<!-- Special Purpose -->
					<div
						class="bg-gradient-to-br from-purple-900/20 to-transparent p-6 rounded-2xl border border-purple-500/30 hover:border-purple-500 hover:shadow-[0_0_20px_rgba(168,85,247,0.2)] transition-all group h-full flex flex-col">
						<div
							class="w-14 h-14 bg-purple-500/20 rounded-xl flex items-center justify-center mb-6 group-hover:scale-110 transition-transform">
							<i data-lucide="gamepad-2" class="w-8 h-8 text-purple-400"></i>
						</div>
						<h3 class="text-xl font-bold text-white mb-3">Special Purpose</h3>
						<p class="text-purple-200 text-xs font-mono uppercase tracking-widest mb-4">A SCOPO SPECIFICO
						</p>
						<p class="text-gray-300 text-sm leading-relaxed text-justify mb-6 flex-grow">
							Sono computer progettati per fare una sola cosa (o poche cose), ma molto bene e in modo
							molto specifico.
						</p>
						<!-- Image Placeholder -->
						<div
							class="mt-auto w-full h-72 rounded-xl overflow-hidden border border-neon-purple/30 relative group-hover:border-neon-purple/50 transition-colors">
							<div
								class="absolute inset-0 bg-neon-purple/10 mix-blend-overlay z-10 group-hover:bg-transparent transition-colors">
							</div>
							<img src="special.jpg" alt="Special purpose"
								onerror="this.src='https://images.unsplash.com/photo-1542751371-adc38448a05e?auto=format&fit=crop&q=80&w=1000'"
								class="w-full h-full object-cover transform group-hover:scale-110 transition-transform duration-700">
						</div>
					</div>
					<!-- Embedded -->
					<div
						class="bg-gradient-to-br from-orange-900/20 to-transparent p-6 rounded-2xl border border-orange-500/30 hover:border-orange-500 hover:shadow-[0_0_20px_rgba(249,115,22,0.2)] transition-all group h-full flex flex-col">
						<div
							class="w-14 h-14 bg-orange-500/20 rounded-xl flex items-center justify-center mb-6 group-hover:scale-110 transition-transform">
							<i data-lucide="cpu" class="w-8 h-8 text-orange-400"></i>
						</div>
						<h3 class="text-xl font-bold text-white mb-3">Embedded</h3>
						<p class="text-orange-200 text-xs font-mono uppercase tracking-widest mb-4">INCORPORATI</p>
						<p class="text-gray-300 text-sm leading-relaxed text-justify mb-6 flex-grow">
							Sono computer di tipo Special purpose che sono nascosti dentro oggetti di uso quotidiano
							che, al contrario degli altri Special purpose, conservano una funzionalità anche
							rimuovendovi il computer.
						</p>
						<!-- Image Placeholder -->
						<div
							class="mt-auto w-full h-72 rounded-xl overflow-hidden border border-neon-purple/30 relative group-hover:border-neon-purple/50 transition-colors">
							<div
								class="absolute inset-0 bg-neon-purple/10 mix-blend-overlay z-10 group-hover:bg-transparent transition-colors">
							</div>
							<img src="embedded.jpg" alt="Embedded"
								onerror="this.src='https://images.unsplash.com/photo-1555664424-778a184335a6?auto=format&fit=crop&q=80&w=1000'"
								class="w-full h-full object-cover transform group-hover:scale-110 transition-transform duration-700">
						</div>
					</div>
				</div>
			</section>
			<div class="flex justify-between mt-12 pt-8 border-t border-white/10">
				<button onclick="navigateTo('home')"
					class="flex items-center gap-2 text-gray-400 hover:text-white transition-colors">
					<i data-lucide="arrow-left"></i> Precedente: Home
				</button>
				<button onclick="navigateTo('lesson-2')"
					class="flex items-center gap-2 text-neon-purple hover:text-white font-bold transition-colors">
					Prossima: Architettura Von Neumann <i data-lucide="arrow-right"></i>
				</button>
			</div>
		</div>
		<!-- ================= LESSON 2 VIEW ================= -->
		<div id="lesson-2-view" class="hidden w-full max-w-5xl mx-auto animate-fade-in z-10">
			<div class="mb-12 border-b border-white/10 pb-6">
				<span class="text-neon-purple font-mono text-sm tracking-widest">LEZIONE 02</span>
				<h1 class="text-4xl md:text-5xl font-bold text-white mt-2">L'architettura di Von Neumann</h1>
				<p class="text-gray-400 mt-4 text-lg">Come è organizzato internamente un computer moderno.</p>
			</div>
			<section class="grid md:grid-cols-3 gap-8 mb-16">
				<div class="md:col-span-2 space-y-6">
					<h2 class="text-2xl font-bold text-white mb-4">Cos'è un'architettura?</h2>
					<p class="text-gray-300 text-lg leading-relaxed text-justify">
						In informatica, con il termine <strong>architettura</strong> si intende l'organizzazione interna
						del computer, ovvero il progetto logico che definisce:
					</p>
					<ul class="space-y-4">
						<li class="flex items-center gap-4 bg-white/5 p-4 rounded-lg border-l-4 border-neon-purple">
							<i data-lucide="component" class="text-neon-purple"></i>
							<span class="text-gray-200">Quali componenti ci sono</span>
						</li>
						<li class="flex items-center gap-4 bg-white/5 p-4 rounded-lg border-l-4 border-neon-purple">
							<i data-lucide="activity" class="text-neon-purple"></i>
							<span class="text-gray-200">Che ruolo hanno</span>
						</li>
						<li class="flex items-center gap-4 bg-white/5 p-4 rounded-lg border-l-4 border-neon-purple">
							<i data-lucide="network" class="text-neon-purple"></i>
							<span class="text-gray-200">Come comunicano tra loro</span>
						</li>
					</ul>
				</div>
				<div
					class="bg-gradient-to-br from-neon-purple/20 to-blue-900/20 p-6 rounded-2xl border border-neon-purple/30 text-center relative overflow-hidden group">
					<div class="absolute top-0 left-0 w-full h-1 bg-neon-purple"></div>
					<div
						class="w-24 h-24 mx-auto bg-gray-800 rounded-full border-2 border-neon-purple flex items-center justify-center mb-4 overflow-hidden relative">
						<img src="https://upload.wikimedia.org/wikipedia/commons/thumb/5/5e/JohnvonNeumann-LosAlamos.gif/220px-JohnvonNeumann-LosAlamos.gif"
							alt="John von Neumann"
							class="w-full h-full object-cover grayscale group-hover:grayscale-0 transition-all duration-500">
					</div>
					<h3 class="text-xl font-bold text-white font-mono">John von Neumann</h3>
					<p class="text-neon-purple text-sm mb-4">1945</p>
					<p class="text-gray-300 text-sm italic leading-relaxed text-justify">
						Matematico ungherese e padre dell'informatica moderna. La sua idea rivoluzionaria:
					</p>
					<div class="mt-4 bg-black/40 p-2 rounded text-xs font-mono text-neon-blue">
						"Dati e istruzioni nella stessa memoria"
					</div>
					<br>
					<p class="text-gray-300 text-sm italic leading-relaxed text-justify">
						Prima, per cambiare programma bisognava modificare fisicamente la macchina. Grazie a questa
						intuizione nasce il computer programmabile, flessibile e universale.
					</p>
				</div>
			</section>
			<section class="mb-16">
				<h3 class="text-xl font-bold text-white mb-6 font-mono border-l-4 border-neon-blue pl-4">Il Ciclo di
					Elaborazione</h3>
				<div class="space-y-4">
					<div
						class="flex gap-4 p-4 bg-white/5 rounded-lg border border-transparent hover:border-green-500/50 transition-colors">
						<div
							class="flex-shrink-0 w-8 h-8 rounded-full bg-green-500 text-black font-bold flex items-center justify-center">
							1</div>
						<div>
							<p class="text-gray-300 text-justify">Dati e comandi vengono forniti attraverso i <strong
									class="text-green-400">Dispositivi di Input</strong> (tastiera, mouse, hard disk).
							</p>
						</div>
					</div>
					<div
						class="flex gap-4 p-4 bg-white/5 rounded-lg border border-transparent hover:border-neon-purple/50 transition-colors">
						<div
							class="flex-shrink-0 w-8 h-8 rounded-full bg-neon-purple text-black font-bold flex items-center justify-center">
							2</div>
						<div>
							<p class="text-gray-300 text-justify">Essi vengono memorizzati temporaneamente nella <strong
									class="text-neon-purple">Memoria Centrale (RAM)</strong>.</p>
						</div>
					</div>
					<div
						class="flex gap-4 p-4 bg-white/5 rounded-lg border border-transparent hover:border-neon-blue/50 transition-colors">
						<div
							class="flex-shrink-0 w-8 h-8 rounded-full bg-neon-blue text-black font-bold flex items-center justify-center">
							3</div>
						<div>
							<p class="text-gray-300 text-justify">Il microprocessore <strong
									class="text-neon-blue">(CPU)</strong> preleva i dati dalla RAM.</p>
						</div>
					</div>
					<div
						class="flex gap-4 p-4 bg-white/5 rounded-lg border border-transparent hover:border-neon-blue/50 transition-colors">
						<div
							class="flex-shrink-0 w-8 h-8 rounded-full bg-neon-blue text-black font-bold flex items-center justify-center">
							4</div>
						<div>
							<p class="text-gray-300 text-justify">L'istruzione viene <strong class="text-neon-blue">
									interpretata ed eseguita </strong> dalla CPU.</p>
						</div>
					</div>
					<div
						class="flex gap-4 p-4 bg-white/5 rounded-lg border border-transparent hover:border-neon-purple/50 transition-colors">
						<div
							class="flex-shrink-0 w-8 h-8 rounded-full bg-neon-purple text-black font-bold flex items-center justify-center">
							5</div>
						<div>
							<p class="text-gray-300 text-justify">La CPU trasferisce i risultati dell'elaborazione di
								nuovo alla <strong class="text-neon-purple"> RAM </strong>.</p>
						</div>
					</div>
					<div
						class="flex gap-4 p-4 bg-white/5 rounded-lg border border-transparent hover:border-neon-red-500/50 transition-colors">
						<div
							class="flex-shrink-0 w-8 h-8 rounded-full bg-red-500 text-black font-bold flex items-center justify-center">
							6</div>
						<div>
							<p class="text-gray-300 text-justify">I dati in uscita vengono comunicati all'esterno
								tramite i <strong class="text-red-400">Dispositivi di Output</strong> (monitor,
								stampante, hard disk).</p>
						</div>
					</div>
				</div>
				<br><br>
				<section class="mb-16">
					<h2 class="text-2xl font-bold text-white mb-8 text-center">Il Ciclo di Funzionamento</h2>
					<div class="bg-gray-900 p-6 md:p-10 rounded-3xl border border-white/10 shadow-xl overflow-hidden relative min-h-[400px] flex flex-col items-center justify-center"
						id="vn-diagram">
						<!-- DATI ANIMATI (Sovraposti) -->
						<div id="data-group"
							class="absolute z-50 flex gap-2 transition-all duration-1000 ease-in-out pointer-events-none"
							style="opacity: 0;">
							<!-- Il contenuto viene generato dinamicamente via JavaScript -->
						</div>
						<!-- Struttura Statica -->
						<div
							class="flex flex-col md:flex-row items-end justify-center w-full max-w-5xl gap-2 md:gap-0 pb-16">
							<!-- 1. INPUT -->
							<div id="input-target"
								class="flex-none w-24 h-24 bg-gray-800 rounded-xl border-2 border-green-500 flex flex-col items-center justify-center p-4 shadow-[0_0_15px_rgba(34,197,94,0.1)] bg-opacity-90 z-10">
								<i data-lucide="keyboard" class="text-green-400 w-8 h-8 mb-2"></i>
								<span class="font-mono font-bold text-green-400 text-xs">INPUT</span>
							</div>
							<!-- Freccia Input -> RAM -->
							<div class="hidden md:flex flex-grow h-24 items-end pb-12 px-2 relative">
								<div
									class="w-full h-[2px] bg-gradient-to-r from-transparent via-gray-500/50 to-gray-400 shadow-[0_0_8px_rgba(156,163,175,0.6)]">
								</div>
								<div
									class="absolute right-2 bottom-[45px] w-3 h-3 border-t-2 border-r-2 border-gray-400 rotate-45 shadow-[0_0_10px_rgba(156,163,175,0.9)]">
								</div>
							</div>
							<div class="md:hidden text-gray-500 my-2"><i data-lucide="arrow-down"></i></div>
							<!-- STACK CENTRALE -->
							<div class="flex flex-col items-center gap-4 z-10">
								<!-- CPU -->
								<div id="cpu-target"
									class="w-64 p-5 bg-gray-800 rounded-xl border-2 border-cyan-400 flex items-center gap-4 shadow-[0_0_20px_rgba(0,243,255,0.1)]">
									<i data-lucide="cpu" class="text-cyan-400 w-10 h-10"></i>
									<div>
										<h3 class="font-bold text-white text-lg">CPU</h3>
										<p class="text-xs text-gray-400 font-mono">ELABORAZIONE</p>
									</div>
								</div>
								<!-- BUS Connections -->
								<div class="h-16 w-40 flex justify-between px-10 py-0">
									<div
										class="h-full w-[2px] bg-gradient-to-t from-transparent via-gray-500/50 to-gray-400 relative shadow-[0_0_8px_rgba(156,163,175,0.5)]">
										<div
											class="absolute top-0 -left-[3px] w-2 h-2 border-t-2 border-l-2 border-gray-400 rotate-45">
										</div>
									</div>
									<div
										class="h-full w-[2px] bg-gradient-to-b from-transparent via-gray-500/50 to-gray-400 relative shadow-[0_0_8px_rgba(156,163,175,0.5)]">
										<div
											class="absolute bottom-0 -left-[3px] w-2 h-2 border-b-2 border-r-2 border-gray-400 rotate-45">
										</div>
									</div>
								</div>
								<!-- RAM -->
								<div id="ram-target"
									class="w-64 p-5 bg-gray-800 rounded-xl border-2 border-purple-500 flex items-center gap-4 shadow-[0_0_20px_rgba(188,19,254,0.1)]">
									<i data-lucide="grid" class="text-purple-500 w-10 h-10"></i>
									<div>
										<h3 class="font-bold text-white text-lg">RAM</h3>
										<p class="text-xs text-gray-400 font-mono">MEMORIA CENTRALE</p>
									</div>
								</div>
							</div>
							<!-- Freccia RAM -> Output -->
							<div class="hidden md:flex flex-grow h-24 items-end pb-12 px-2 relative">
								<div
									class="w-full h-[2px] bg-gradient-to-r from-gray-500 to-gray-400 shadow-[0_0_8px_rgba(156,163,175,0.6)]">
								</div>
								<div
									class="absolute right-2 bottom-[45px] w-3 h-3 border-t-2 border-r-2 border-gray-400 rotate-45 shadow-[0_0_10px_rgba(156,163,175,0.9)]">
								</div>
							</div>
							<div class="md:hidden text-gray-500 my-2"><i data-lucide="arrow-down"></i></div>
							<!-- 3. OUTPUT -->
							<div id="output-target"
								class="flex-none w-24 h-24 bg-gray-800 rounded-xl border-2 border-red-400 flex flex-col items-center justify-center p-4 shadow-[0_0_15px_rgba(248,113,113,0.1)] bg-opacity-90 z-10">
								<i data-lucide="monitor" class="text-red-400 w-8 h-8 mb-2"></i>
								<span class="font-mono font-bold text-red-400 text-xs">OUTPUT</span>
							</div>
						</div>
						<!-- Controlli Player -->
						<div class="absolute bottom-4 w-full flex justify-center items-center gap-4 z-50 px-4">
							<button onclick="prevStep()"
								class="p-2 rounded-full bg-white/10 hover:bg-white/20 border border-white/20 transition-colors disabled:opacity-30 disabled:cursor-not-allowed flex-shrink-0"
								id="btn-prev">
								<i data-lucide="chevron-left" class="w-6 h-6 text-white"></i>
							</button>
							<div
								class="bg-black/50 px-4 py-2 rounded-full border border-white/10 backdrop-blur-md w-[240px] md:w-[320px] h-12 flex items-center justify-center">
								<span id="step-desc"
									class="font-mono text-cyan-400 text-xs md:text-sm font-bold truncate px-2"></span>
							</div>
							<button onclick="nextStep()"
								class="p-2 rounded-full bg-white/10 hover:bg-white/20 border border-white/20 transition-colors disabled:opacity-30 disabled:cursor-not-allowed flex-shrink-0"
								id="btn-next">
								<i data-lucide="chevron-right" class="w-6 h-6 text-white"></i>
							</button>
						</div>
					</div>
					<div class="mt-8 p-6 bg-yellow-500/5 border border-yellow-500/20 rounded-xl">
						<h4 class="text-yellow-500 font-bold mb-2 flex items-center gap-2">
							<i data-lucide="save" class="w-4 h-4"></i> Nota Bene: La Memoria di Massa
						</h4>
						<p class="text-gray-400 text-sm text-justify">
							Oltre ai componenti mostrati nello schema, un computer è dotato anche di una memoria di
							massa, utilizzata per conservare dati e programmi in modo permanente.
							Durante il funzionamento, i dati vengono trasferiti dalla RAM alla memoria di massa per
							essere salvati: in questo senso la memoria di massa svolge il ruolo di dispositivo di
							output.
							Allo stesso tempo, quando fornisce alla RAM i dati e i programmi necessari alle elaborazioni
							successive, la memoria di massa agisce come dispositivo di input.
							Per questo motivo, pur non essendo sempre rappresentata esplicitamente nello schema, la
							memoria di massa è implicitamente inclusa nel flusso di input e output del sistema.
						</p>
					</div>
				</section>
				<div class="flex justify-between mt-12 pt-8 border-t border-white/10">
					<button onclick="navigateTo('lesson-1')"
						class="flex items-center gap-2 text-gray-400 hover:text-white transition-colors">
						<i data-lucide="arrow-left"></i> Precedente: HW e computer
					</button>
					<!-- AGGIORNATO: Punta alla Lezione 3 -->
					<button onclick="navigateTo('lesson-3')"
						class="flex items-center gap-2 text-neon-orange hover:text-white font-bold transition-colors">
						Prossima: Scheda Madre <i data-lucide="arrow-right"></i>
					</button>
				</div>
		</div>
		</div>
		<!-- ================= LESSON 3 VIEW (WORK IN PROGRESS) ================= -->
		<div id="lesson-3-view"
			class="hidden w-full max-w-5xl mx-auto animate-fade-in z-10 flex flex-col items-center justify-center min-h-[60vh]">
			<div
				class="text-center space-y-8 p-12 bg-dark-card border border-neon-orange/20 rounded-3xl relative overflow-hidden group">
				<!-- Background Decoration -->
				<div class="absolute inset-0 bg-gradient-to-br from-neon-orange/5 to-transparent pointer-events-none">
				</div>
				<!-- Animated Icon -->
				<div class="relative w-32 h-32 mx-auto mb-6">
					<div class="absolute inset-0 bg-neon-orange/20 rounded-full blur-xl animate-pulse-slow"></div>
					<div
						class="relative bg-gray-900 border-4 border-neon-orange rounded-full w-full h-full flex items-center justify-center shadow-[0_0_30px_rgba(255,136,0,0.3)]">
						<i data-lucide="hammer" class="w-16 h-16 text-neon-orange animate-bounce"></i>
					</div>
					<!-- Gears -->
					<i data-lucide="settings"
						class="absolute -top-2 -right-2 w-12 h-12 text-gray-500 animate-spin-slow"></i>
					<i data-lucide="settings-2"
						class="absolute -bottom-2 -left-2 w-10 h-10 text-gray-600 animate-spin-reverse"></i>
				</div>
				<div>
					<span class="text-neon-orange font-mono text-sm tracking-widest uppercase mb-2 block">Lezione
						03</span>
					<h1 class="text-4xl md:text-6xl font-bold text-white mb-4">Lavori in Corso</h1>
					<p class="text-gray-400 text-lg md:text-xl max-w-md mx-auto leading-relaxed">
						Stiamo saldando i circuiti della <strong class="text-neon-orange">Scheda Madre</strong>. <br>
						Questa sezione sarà disponibile a breve con schemi interattivi e dettagli sui BUS di sistema.
					</p>
				</div>
				<div
					class="w-full h-2 bg-gray-800 rounded-full overflow-hidden max-w-sm mx-auto border border-gray-700">
					<div
						class="h-full bg-repeating-linear-gradient(45deg, #ff8800, #ff8800 10px, #cc6d00 10px, #cc6d00 20px) animate-flow w-[200%]">
					</div>
				</div>
			</div>
			<div class="flex justify-between w-full mt-12 pt-8 border-t border-white/10">
				<button onclick="navigateTo('lesson-2')"
					class="flex items-center gap-2 text-gray-400 hover:text-white transition-colors">
					<i data-lucide="arrow-left"></i> Precedente: Architettura Von Neumann
				</button>
				<button onclick="navigateTo('lesson-4')"
					class="flex items-center gap-2 text-neon-teal hover:text-white font-bold transition-colors">
					Prossima: Microprocessore <i data-lucide="arrow-right"></i>
				</button>
			</div>
		</div>
		<!-- ================= LESSON 4 VIEW (NEW) ================= -->
		<div id="lesson-4-view" class="hidden w-full max-w-5xl mx-auto animate-fade-in z-10">
			<!-- Intestazione -->
			<div class="mb-12 border-b border-white/10 pb-6 flex items-center justify-between">
				<div>
					<span class="text-neon-teal font-mono text-sm tracking-widest">LEZIONE 04</span>
					<h1 class="text-4xl md:text-5xl font-bold text-white mt-2">Il Microprocessore o CPU</h1>
					<p class="text-gray-400 mt-4 text-lg">Il cervello del computer.</p>
				</div>
				<div class="hidden md:block text-neon-teal/20 animate-spin-slow">
					<i data-lucide="cpu" class="w-24 h-24"></i>
				</div>
			</div>
			<!-- Intro: Cervello, Transistor, Bit -->
			<section class="grid md:grid-cols-2 gap-12 mb-16 items-center">
				<div class="space-y-6">
					<div
						class="bg-gradient-to-r from-neon-teal/10 to-transparent p-6 rounded-xl border-l-4 border-neon-teal">
						<p class="text-xl text-white font-light italic text-justify">
							"La CPU (Central Processing Unit), chiamata anche microprocessore o chip, è considerata il
							<strong class="text-neon-teal">cervello</strong> del computer."
						</p>
					</div>
					<p class="text-gray-300 text-justify">
						È il componente che esegue le istruzioni e elabora i dati, permettendo al computer di
						funzionare.
					</p>
				</div>
				<!-- Spazio Foto CPU (Fronte/Retro) -->
				<div
					class="bg-dark-card rounded-2xl border border-neon-teal/30 p-6 flex flex-col items-center justify-center gap-4">
					<div class="flex flex-row gap-4 justify-center w-full">
						<!-- Fronte -->
						<div class="flex flex-col gap-2 items-center group">
							<div
								class="relative w-32 h-32 md:w-40 md:h-40 rounded-lg overflow-hidden border border-neon-teal/50">
								<img src="https://m.media-amazon.com/images/I/61DzCZUwryL.jpg" alt="CPU Fronte"
									class="w-full h-full object-cover group-hover:scale-110 transition-transform">
							</div>
							<span class="text-xs text-gray-500 font-mono">FRONTE</span>
						</div>
						<!-- Retro -->
						<div class="flex flex-col gap-2 items-center group">
							<div
								class="relative w-32 h-32 md:w-40 md:h-40 rounded-lg overflow-hidden border border-neon-teal/50">
								<img src="https://www.edn.com/wp-content/uploads/New_CPU_bottom.jpg" alt="CPU Retro"
									class="w-full h-full object-cover group-hover:scale-110 transition-transform">
							</div>
							<span class="text-xs text-gray-500 font-mono">RETRO</span>
						</div>
					</div>
				</div>
			</section>
			<!-- Sezione Transistor -->
			<section class="mb-16">
				<div>
					<h3 class="text-lg font-bold text-white mb-2 flex items-center gap-2"><i data-lucide="zap"
							class="text-yellow-400 w-5 h-5"></i> Come funziona</h3>
					<p class="text-gray-300 text-justify mb-8">
						La CPU è composta da miliardi di <strong>transistor</strong>, cioè microscopici interruttori
						elettronici con due possibili stati:
					</p>
				</div>
				<div class="grid md:grid-cols-2 gap-8">
					<!-- Visualizzazione Transistor Logico -->
					<div class="bg-dark-card p-6 rounded-xl border border-white/10 flex flex-col gap-4">
						<p class="text-xs text-gray-500 uppercase font-mono tracking-wider text-center">Schema Logico
						</p>
						<div class="flex justify-around items-end h-full pb-4 gap-4">
							<!-- OFF State -->
							<div class="flex flex-col items-center gap-2 group w-full">
								<div
									class="w-full h-36 bg-gray-900 rounded-lg border border-gray-700 flex flex-col items-center justify-center relative overflow-hidden transition-all duration-300 group-hover:border-gray-500">
									<!-- Circuit Graphic OFF (Open Switch) -->
									<div class="flex items-center w-full justify-center px-4">
										<div class="h-1.5 w-10 bg-gray-600"></div>
										<div class="relative h-12 w-12 flex justify-center">
											<!-- Interruttore alzato -->
											<div
												class="absolute bottom-0 left-0 w-12 h-1.5 bg-gray-600 origin-left transform -rotate-45 transition-all">
											</div>
										</div>
										<div class="h-1.5 w-10 bg-gray-600"></div>
									</div>
									<span
										class="text-xs text-gray-500 mt-6 font-mono font-bold tracking-widest">APERTO</span>
								</div>
								<div class="text-center mt-2">
									<div class="font-bold text-gray-400 text-lg">OFF - Valore bit: 0</div>
									<span class="text-xs text-gray-600">Nessuna corrente</span>
								</div>
							</div>
							<!-- Vertical Divider -->
							<div class="w-px h-32 bg-white/10 self-center"></div>
							<!-- ON State -->
							<div class="flex flex-col items-center gap-2 group w-full">
								<div
									class="w-full h-36 bg-gray-900 rounded-lg border border-neon-green/30 flex flex-col items-center justify-center relative overflow-hidden shadow-[0_0_25px_rgba(0,255,157,0.15)] transition-all duration-300 group-hover:border-neon-green/60">
									<!-- Circuit Graphic ON (Closed Switch) -->
									<div class="flex items-center w-full justify-center px-4 relative">
										<!-- Linea base -->
										<div class="h-1.5 w-full bg-gray-700 absolute"></div>
										<!-- Flusso Corrente -->
										<div
											class="h-1.5 w-full bg-neon-green shadow-[0_0_12px_rgba(0,255,157,0.8)] z-10 animate-pulse">
										</div>
										<!-- Particelle che scorrono -->
										<div class="absolute top-0 left-0 w-3 h-1.5 bg-white blur-[2px] z-20 animate-flow"
											style="animation-duration: 1.2s"></div>
									</div>
									<span
										class="text-xs text-neon-green mt-6 font-mono font-bold tracking-widest shadow-neon">CHIUSO</span>
								</div>
								<div class="text-center mt-2">
									<div class="font-bold text-white text-lg">ON - Valore bit: 1</div>
									<span class="text-xs text-neon-green">Passa corrente</span>
								</div>
							</div>
						</div>
					</div>
					<!-- Spazio Foto Transistor -->
					<div
						class="bg-dark-card rounded-2xl border border-neon-teal/30 p-6 flex flex-col items-center justify-center gap-4 h-full">
						<div class="flex flex-col gap-4 items-center group text-center">
							<div
								class="relative w-56 h-56 rounded-full overflow-hidden border-4 border-neon-teal/30 shadow-[0_0_30px_rgba(45,212,191,0.2)] group-hover:border-neon-teal/60 transition-all duration-500">
								<img src="https://www.azom.com/images/Article_Images/ImageForArticle_22916_16911443322394545.jpg"
									alt="Transistor"
									class="w-full h-full object-cover group-hover:scale-110 transition-transform duration-700">
							</div>
							<span class="text-xs text-gray-400 font-mono max-w-xs leading-relaxed">
								Un singolo transistor ingrandito. <br>In una CPU moderna ce ne sono miliardi, grandi
								pochi nanometri, 20.000 volte più piccoli di un capello!
							</span>
						</div>
					</div>
				</div>
				<!-- NUOVA SEZIONE VIDEO VERTICALE -->
				<div class="mt-12 flex flex-col items-center animate-fade-in">
					<div class="flex items-center gap-2 mb-6">
						<div class="w-2 h-2 rounded-full bg-neon-red animate-pulse"></div>
						<h3 class="text-lg font-bold text-white tracking-wide">VIDEO APPROFONDIMENTO</h3>
					</div>
					<!-- Container Video Stile Smartphone -->
					<div
						class="relative w-full max-w-[320px] aspect-[9/16] bg-black rounded-[2.5rem] border-8 border-gray-900 shadow-[0_0_40px_rgba(0,243,255,0.1)] overflow-hidden group hover:shadow-[0_0_50px_rgba(0,243,255,0.2)] transition-all duration-500">
						<!-- Video Player -->
						<video class="w-full h-full object-cover" controls playsinline>
							<source src="video_transistor.mp4" type="video/mp4">
							Il tuo browser non supporta il tag video.
						</video>
						<!-- Riflesso Schermo (overlay estetico) -->
						<div
							class="absolute top-0 left-0 w-full h-full bg-gradient-to-tr from-white/5 to-transparent pointer-events-none rounded-[2rem]">
						</div>
						<!-- Notch simulato -->
						<div class="absolute top-0 left-1/2 -translate-x-1/2 w-32 h-6 bg-gray-900 rounded-b-xl z-20">
						</div>
						<!-- Indicatore Home simulato -->
						<div
							class="absolute bottom-2 left-1/2 -translate-x-1/2 w-1/3 h-1 bg-white/20 rounded-full z-20 backdrop-blur-sm">
						</div>
					</div>
					<p class="text-gray-500 text-sm mt-4 font-mono text-center max-w-md">
						<i data-lucide="smartphone" class="inline w-4 h-4 mr-1"></i>
						Visualizzazione verticale ottimizzata
					</p>
				</div>
			</section>
			<!-- Sezione: CU e ALU -->
			<section class="mb-16">
				<h2 class="text-2xl font-bold text-white mb-8">Le due unità principali della CPU</h2>
				<div class="grid md:grid-cols-2 gap-6">
					<!-- CU Card -->
					<div
						class="bg-dark-lighter p-8 rounded-2xl border-t-4 border-neon-orange relative overflow-hidden group hover:bg-white/5 transition-colors">
						<div
							class="absolute top-4 right-4 text-neon-orange/20 group-hover:text-neon-orange/40 transition-colors">
							<i data-lucide="activity" class="w-16 h-16"></i>
						</div>
						<h3 class="text-xl font-bold text-white mb-2">Contol Unit (CU)</h3>
						<p class="text-neon-orange text-xs font-mono mb-4">Unità di controllo</p>
						<ul class="space-y-3 text-gray-300 text-sm">
							<li class="flex items-start gap-2">
								<i data-lucide="check" class="w-4 h-4 text-neon-orange mt-1"></i>
								Dirige tutto il processo di elaborazione dei dati.
							</li>
							<li class="flex items-start gap-2">
								<i data-lucide="check" class="w-4 h-4 text-neon-orange mt-1"></i>
								Coordina le attività di input e output.
							</li>
							<li class="flex items-start gap-2">
								<i data-lucide="check" class="w-4 h-4 text-neon-orange mt-1"></i>
								Dice all’ALU cosa fare in ogni momento.
							</li>
						</ul>
					</div>
					<!-- ALU Card -->
					<div
						class="bg-dark-lighter p-8 rounded-2xl border-t-4 border-neon-pink relative overflow-hidden group hover:bg-white/5 transition-colors">
						<div
							class="absolute top-4 right-4 text-neon-pink/20 group-hover:text-neon-pink/40 transition-colors">
							<i data-lucide="calculator" class="w-16 h-16"></i>
						</div>
						<h3 class="text-xl font-bold text-white mb-2">Arithmetic Logic Unit (ALU)</h3>
						<p class="text-neon-pink text-xs font-mono mb-4">Unità aritmetico-logica</p>
						<ul class="space-y-3 text-gray-300 text-sm">
							<li class="flex items-start gap-2">
								<i data-lucide="plus-circle" class="w-4 h-4 text-neon-pink mt-1"></i>
								Esegue operazioni aritmetiche (somma, sottrazione…).
							</li>
							<li class="flex items-start gap-2">
								<i data-lucide="scale" class="w-4 h-4 text-neon-pink mt-1"></i>
								Esegue operazioni logiche (confronti come “maggiore di” e operatori logici come "AND").
							</li>
						</ul>
					</div>
				</div>
				<!-- Registri Info -->
				<div
					class="mt-8 bg-white/5 border border-white/10 rounded-xl p-6 flex flex-col md:flex-row gap-6 items-center">
					<div class="bg-gray-800 p-3 rounded-lg border border-gray-600">
						<i data-lucide="database" class="text-gray-300 w-8 h-8"></i>
					</div>
					<div>
						<h4 class="text-white font-bold mb-2">Le memorie della CPU</h4>
						<p class="text-gray-400 text-sm text-justify leading-relaxed">
							All’interno della CPU sono presenti i <strong>registri</strong>, piccole memorie molto
							veloci utilizzate per conservare temporaneamente dati e istruzioni durante l’elaborazione.
							La capacità dei registri determina la lunghezza della parola, cioè il numero di bit che il
							processore è in grado di trattare simultaneamente.
							<span class="text-neon-teal block mt-2">I PC moderni usano CPU a 64 bit.</span>
							<br>
							All'interno della CPU vi è inoltre <strong>la Cache</strong>, una memoria interna
							superveloce dove vengono conservati i dati e le istruzioni usati più di recente, per evitare
							il lento accesso alla RAM.
						</p>
					</div>
				</div>
			</section>
			<!-- Sezione: Ciclo Istruzione -->
			<section class="mb-16">
				<h2 class="text-2xl font-bold text-white mb-8 text-center">Il Ciclo di Istruzione</h2>
				<p class="text-gray-300 text-center mb-10 max-w-2xl mx-auto">
					Ogni elaborazione complessa del computer viene suddivisa in passaggi elementari, chiamati cicli di
					istruzione.
					La CPU li esegue ripetutamente seguendo quattro fasi principali:
				</p>
				<!-- Container del Ciclo -->
				<div class="relative max-w-4xl mx-auto h-auto md:h-[450px] p-4 flex items-center justify-center">
					<!-- SVG CONNECTION LAYER (Background) -->
					<!-- 
							COORDINATE RICALCOLATE PERFETTAMENTE:
							Area SVG: 800x450.
							Centri stimati delle Card (Box):
							- Fetch (Alto Sx):   X=200, Y=110
							- Decode (Alto Dx):  X=600, Y=110
							- Execute (Basso Dx): X=600, Y=340
							- Store (Basso Sx):  X=200, Y=340
							
							Dimensioni Box (approssimative per distanziamento frecce):
							- Larghezza mezza box: ~150px
							- Altezza mezza box: ~80px
							-->
					<svg class="absolute inset-0 w-full h-full pointer-events-none z-0 hidden md:block"
						viewBox="0 0 800 450" fill="none" xmlns="http://www.w3.org/2000/svg">
						<defs>
							<!-- Marker Punta Freccia Moderna -->
							<marker id="arrowhead-modern" markerWidth="12" markerHeight="12" refX="10" refY="6"
								orient="auto">
								<path d="M 0 0 L 12 6 L 0 12 L 3 6 Z" fill="#475569" />
							</marker>
							<!-- Marker Colorati -->
							<marker id="arrow-blue-modern" markerWidth="12" markerHeight="12" refX="10" refY="6"
								orient="auto">
								<path d="M 0 0 L 12 6 L 0 12 L 3 6 Z" fill="#3b82f6" />
							</marker>
							<marker id="arrow-yellow-modern" markerWidth="12" markerHeight="12" refX="10" refY="6"
								orient="auto">
								<path d="M 0 0 L 12 6 L 0 12 L 3 6 Z" fill="#eab308" />
							</marker>
							<marker id="arrow-red-modern" markerWidth="12" markerHeight="12" refX="10" refY="6"
								orient="auto">
								<path d="M 0 0 L 12 6 L 0 12 L 3 6 Z" fill="#ef4444" />
							</marker>
							<marker id="arrow-green-modern" markerWidth="12" markerHeight="12" refX="10" refY="6"
								orient="auto">
								<path d="M 0 0 L 12 6 L 0 12 L 3 6 Z" fill="#22c55e" />
							</marker>
							<!-- Filtro Glow -->
							<filter id="glow-line">
								<feGaussianBlur stdDeviation="2" result="coloredBlur" />
								<feMerge>
									<feMergeNode in="coloredBlur" />
									<feMergeNode in="SourceGraphic" />
								</feMerge>
							</filter>
						</defs>
						<!-- Percorsi Base (Grigio scuro) -->
						<!-- 1. FETCH -> DECODE (Orizzontale Alto) -->
						<!-- Da X=360 (bordo dx Fetch) a X=440 (bordo sx Decode) a Y=110 -->
						<line x1="360" y1="110" x2="440" y2="110" stroke="#334155" stroke-width="2"
							marker-end="url(#arrowhead-modern)" />
						<!-- 2. DECODE -> EXECUTE (Verticale Destra) -->
						<!-- Da Y=200 (bordo basso Decode) a Y=250 (bordo alto Execute) a X=600 -->
						<line x1="600" y1="200" x2="600" y2="250" stroke="#334155" stroke-width="2"
							marker-end="url(#arrowhead-modern)" />
						<!-- 3. EXECUTE -> STORE (Orizzontale Basso) -->
						<!-- Da X=440 (bordo sx Execute) a X=360 (bordo dx Store) a Y=340 -->
						<line x1="440" y1="340" x2="360" y2="340" stroke="#334155" stroke-width="2"
							marker-end="url(#arrowhead-modern)" />
						<!-- 4. STORE -> FETCH (Verticale Sinistra) -->
						<!-- Da Y=250 (bordo alto Store) a Y=200 (bordo basso Fetch) a X=200 -->
						<line x1="200" y1="250" x2="200" y2="200" stroke="#334155" stroke-width="2"
							marker-end="url(#arrowhead-modern)" />
						<!-- ANIMAZIONI (Linee colorate che scorrono) -->
						<!-- 1. Blue Stream (Fetch -> Decode) -->
						<line x1="360" y1="110" x2="440" y2="110" stroke="#3b82f6" stroke-width="3"
							stroke-dasharray="80 80" stroke-dashoffset="160" filter="url(#glow-line)"
							marker-end="url(#arrow-blue-modern)">
							<animate attributeName="stroke-dashoffset" from="160" to="0" dur="2s"
								repeatCount="indefinite" />
							<animate attributeName="opacity" values="0;1;0" dur="2s" repeatCount="indefinite" />
						</line>
						<!-- 2. Yellow Stream (Decode -> Execute) -->
						<line x1="600" y1="200" x2="600" y2="250" stroke="#eab308" stroke-width="3"
							stroke-dasharray="50 50" stroke-dashoffset="100" filter="url(#glow-line)"
							marker-end="url(#arrow-yellow-modern)">
							<animate attributeName="stroke-dashoffset" from="100" to="0" dur="2s" begin="0.5s"
								repeatCount="indefinite" />
							<animate attributeName="opacity" values="0;1;0" dur="2s" begin="0.5s"
								repeatCount="indefinite" />
						</line>
						<!-- 3. Red Stream (Execute -> Store) -->
						<line x1="440" y1="340" x2="360" y2="340" stroke="#ef4444" stroke-width="3"
							stroke-dasharray="80 80" stroke-dashoffset="160" filter="url(#glow-line)"
							marker-end="url(#arrow-red-modern)">
							<animate attributeName="stroke-dashoffset" from="160" to="0" dur="2s" begin="1s"
								repeatCount="indefinite" />
							<animate attributeName="opacity" values="0;1;0" dur="2s" begin="1s"
								repeatCount="indefinite" />
						</line>
						<!-- 4. Green Stream (Store -> Fetch) -->
						<line x1="200" y1="250" x2="200" y2="200" stroke="#22c55e" stroke-width="3"
							stroke-dasharray="50 50" stroke-dashoffset="100" filter="url(#glow-line)"
							marker-end="url(#arrow-green-modern)">
							<animate attributeName="stroke-dashoffset" from="100" to="0" dur="2s" begin="1.5s"
								repeatCount="indefinite" />
							<animate attributeName="opacity" values="0;1;0" dur="2s" begin="1.5s"
								repeatCount="indefinite" />
						</line>
					</svg>
					<!-- GRID LAYOUT -->
					<div class="grid grid-cols-1 md:grid-cols-2 gap-x-32 gap-y-16 w-full max-w-3xl relative z-10">
						<!-- 1. FETCH (Order 1) -->
						<div class="relative group">
							<!-- Label numerica flottante -->
							<div
								class="absolute -top-4 -left-4 w-10 h-10 bg-dark-bg border border-blue-500 rounded-lg flex items-center justify-center text-blue-400 font-mono font-bold shadow-[0_0_15px_rgba(59,130,246,0.5)] z-20 group-hover:scale-110 transition-transform">
								1</div>
							<!-- Card -->
							<div
								class="bg-dark-card/90 backdrop-blur-sm p-6 rounded-xl border border-blue-500/20 hover:border-blue-500 transition-all duration-300 shadow-lg hover:shadow-[0_0_30px_rgba(59,130,246,0.15)] h-full flex flex-col justify-center">
								<div class="flex items-center gap-3 mb-2">
									<i data-lucide="download" class="text-blue-400 w-5 h-5"></i>
									<h3 class="text-white font-bold tracking-wide">FETCH</h3>
								</div>
								<p class="text-gray-400 text-xs leading-relaxed">La CU prende dalla RAM l’istruzione
									successiva e i dati necessari e li porta nei registri della CPU.</p>
							</div>
						</div>
						<!-- 2. DECODE (Order 2) -->
						<div class="relative group">
							<div
								class="absolute -top-4 -right-4 md:-left-4 w-10 h-10 bg-dark-bg border border-yellow-500 rounded-lg flex items-center justify-center text-yellow-400 font-mono font-bold shadow-[0_0_15px_rgba(234,179,8,0.5)] z-20 group-hover:scale-110 transition-transform">
								2</div>
							<div
								class="bg-dark-card/90 backdrop-blur-sm p-6 rounded-xl border border-yellow-500/20 hover:border-yellow-500 transition-all duration-300 shadow-lg hover:shadow-[0_0_30px_rgba(234,179,8,0.15)] h-full flex flex-col justify-center text-right md:text-left">
								<div class="flex items-center justify-end md:justify-start gap-3 mb-2">
									<h3 class="text-white font-bold tracking-wide order-1 md:order-2">DECODE</h3>
									<i data-lucide="binary" class="text-yellow-400 w-5 h-5 order-2 md:order-1"></i>
								</div>
								<p class="text-gray-400 text-xs leading-relaxed">La CU interpreta l’istruzione e
									comunica all’ALU quale operazione eseguire.</p>
							</div>
						</div>
						<!-- 3. EXECUTE (Was Order 3 in code, but visually needed Bottom Right. Now placed 3rd in DOM, forced to Order 4 on Desktop) -->
						<div class="relative group md:order-4">
							<div
								class="absolute -bottom-4 -right-4 md:-left-4 w-10 h-10 bg-dark-bg border border-red-500 rounded-lg flex items-center justify-center text-red-400 font-mono font-bold shadow-[0_0_15px_rgba(239,68,68,0.5)] z-20 group-hover:scale-110 transition-transform">
								3</div>
							<div
								class="bg-dark-card/90 backdrop-blur-sm p-6 rounded-xl border border-red-500/20 hover:border-red-500 transition-all duration-300 shadow-lg hover:shadow-[0_0_30px_rgba(239,68,68,0.15)] h-full flex flex-col justify-center text-right md:text-left">
								<div class="flex items-center justify-end md:justify-start gap-3 mb-2">
									<h3 class="text-white font-bold tracking-wide order-1 md:order-2">EXECUTE</h3>
									<i data-lucide="zap" class="text-red-400 w-5 h-5 order-2 md:order-1"></i>
								</div>
								<p class="text-gray-400 text-xs leading-relaxed">L’ALU svolge l’operazione aritmetica o
									logica richiesta.</p>
							</div>
						</div>
						<!-- 4. STORE (Was Order 4 in code, but visually needed Bottom Left. Now placed 4th in DOM, forced to Order 3 on Desktop) -->
						<div class="relative group md:order-3">
							<div
								class="absolute -bottom-4 -left-4 w-10 h-10 bg-dark-bg border border-green-500 rounded-lg flex items-center justify-center text-green-400 font-mono font-bold shadow-[0_0_15px_rgba(34,197,94,0.5)] z-20 group-hover:scale-110 transition-transform">
								4</div>
							<div
								class="bg-dark-card/90 backdrop-blur-sm p-6 rounded-xl border border-green-500/20 hover:border-green-500 transition-all duration-300 shadow-lg hover:shadow-[0_0_30px_rgba(34,197,94,0.15)] h-full flex flex-col justify-center">
								<div class="flex items-center gap-3 mb-2">
									<i data-lucide="save" class="text-green-400 w-5 h-5"></i>
									<h3 class="text-white font-bold tracking-wide">STORE</h3>
								</div>
								<p class="text-gray-400 text-xs leading-relaxed">Il risultato dell’operazione viene
									scritto di nuovo nella RAM, pronto per essere usato da altre istruzioni.</p>
							</div>
						</div>
					</div>
					<!-- Freccia di ritorno Mobile (Solo Mobile) -->
					<div
						class="md:hidden absolute left-4 top-1/2 w-1 h-full border-l-2 border-dashed border-gray-700 -z-10">
					</div>
				</div>
				<p class="text-gray-300 text-center mb-10 max-w-2xl mx-auto">
					Dopo lo store, la CPU passa automaticamente all’istruzione successiva e ripete il ciclo milioni o
					miliardi di volte al secondo.
				</p>
				<!-- ANIMAZIONE SCHEMATICA DEL CICLO DI FETCH -->
				<div class="bg-gray-900 p-6 md:p-10 rounded-3xl border border-white/10 shadow-xl relative min-h-[500px] flex flex-col md:flex-row items-center justify-center gap-12 overflow-hidden pb-32"
					id="fetch-diagram">
					<!-- Token Dati che si muove (Instruction ADD) -->
					<div id="f-token-instr"
						class="absolute w-12 h-12 bg-white rounded-full z-50 flex items-center justify-center font-bold text-black shadow-[0_0_8px_rgba(255,255,255,0.5)] transition-all duration-1000 ease-in-out hidden border-2 border-neon-purple font-mono text-xs">
						+
					</div>
					<!-- Token Dati che si muove (DATA 3) -->
					<div id="f-token-data1"
						class="absolute w-10 h-10 bg-white rounded-full z-50 flex items-center justify-center font-bold text-black shadow-[0_0_8px_rgba(255,255,255,0.5)] transition-all duration-1000 ease-in-out hidden border-2 border-neon-green font-mono">
						3
					</div>
					<!-- Token Dati che si muove (DATA 5) -->
					<div id="f-token-data2"
						class="absolute w-10 h-10 bg-white rounded-full z-50 flex items-center justify-center font-bold text-black shadow-[0_0_8px_rgba(255,255,255,0.5)] transition-all duration-1000 ease-in-out hidden border-2 border-neon-green font-mono">
						5
					</div>
					<!-- Token Risultato (8) -->
					<div id="f-token-result"
						class="absolute w-12 h-12 bg-cyan-500 text-black rounded-full z-50 flex items-center justify-center font-bold shadow-[0_0_15px_rgba(0,243,255,0.4)] transition-all duration-1000 ease-in-out hidden border-2 border-white font-mono animate-pulse">
						8
					</div>
					<!-- CPU CONTAINER (Left) -->
					<div
						class="relative w-full md:w-1/2 h-[400px] bg-dark-card rounded-2xl border-2 border-neon-teal/50 p-6 flex flex-col justify-between shadow-[0_0_20px_rgba(45,212,191,0.1)]">
						<div class="absolute -top-3 left-4 bg-gray-900 px-2 text-neon-teal font-mono font-bold">CPU
							(Processore)</div>
						<!-- CU -->
						<div id="f-cu"
							class="w-full h-24 bg-gray-800 rounded-xl border border-neon-orange/50 flex flex-col items-center justify-center transition-all duration-300">
							<span class="text-neon-orange font-bold text-xl">CONTROL UNIT</span>
						</div>
						<!-- REGISTRI -->
						<div id="f-reg"
							class="w-full h-24 bg-gray-800 rounded-xl border border-white/20 flex flex-col items-center justify-center transition-all duration-300">
							<span class="text-white font-bold text-xl">REGISTRI</span>
						</div>
						<!-- ALU -->
						<div id="f-alu"
							class="w-full h-24 bg-gray-800 rounded-xl border border-neon-pink/50 flex flex-col items-center justify-center transition-all duration-300 relative">
							<span class="text-neon-pink font-bold text-xl">ALU</span>
						</div>
					</div>
					<!-- BUS CONNECTION (Middle) -->
					<div class="hidden md:flex flex-col h-[300px] justify-center items-center gap-8 w-16">
						<i data-lucide="move-right" class="w-12 h-12 text-gray-500"></i>
						<i data-lucide="move-left" class="w-12 h-12 text-gray-500"></i>
					</div>
					<!-- RAM CONTAINER (Right) -->
					<div id="f-ram"
						class="relative w-full md:w-1/3 h-[400px] bg-dark-card rounded-2xl border-2 border-purple-500/50 p-6 shadow-[0_0_20px_rgba(168,85,247,0.1)] flex flex-col items-center justify-center gap-2 transition-all duration-300">
						<div class="absolute -top-3 right-4 bg-gray-900 px-2 text-purple-500 font-mono font-bold">RAM
							(Memoria)</div>
						<!-- Memory Cells -->
						<div id="f-mem-data1"
							class="w-full h-10 bg-gray-800/50 border border-gray-700 rounded flex items-center justify-between px-4 text-gray-400 text-sm font-mono">
							<span class="text-xs">0x00</span> <span class="text-white">DATA: 3</span>
						</div>
						<div id="f-mem-data2"
							class="w-full h-10 bg-gray-800/50 border border-gray-700 rounded flex items-center justify-between px-4 text-gray-400 text-sm font-mono">
							<span class="text-xs">0x01</span> <span class="text-white">DATA: 5</span>
						</div>
						<div id="f-mem-instr"
							class="w-full h-10 bg-purple-900/30 border border-purple-500 rounded flex items-center justify-between px-4 text-purple-200 text-sm font-mono shadow-[0_0_10px_rgba(168,85,247,0.3)]">
							<span class="text-xs">0x02</span> <span>INSTR: +</span>
						</div>
						<!-- Cella vuota per il risultato -->
						<div id="f-ram-result"
							class="w-full h-10 bg-gray-800/50 border border-gray-700 rounded flex items-center justify-between px-4 text-gray-400 text-sm font-mono opacity-50 transition-all duration-500">
							<!-- Si riempirà con JS -->
						</div>
						<div class="w-full h-8 bg-gray-800/50 border border-gray-700 rounded mb-1 opacity-50"></div>
					</div>
					<!-- Controls -->
					<div class="absolute bottom-2 w-full flex justify-center items-center gap-4 z-50 px-4">
						<button onclick="prevFetchStep()"
							class="p-2 rounded-full bg-white/10 hover:bg-white/20 border border-white/20 transition-colors disabled:opacity-30 disabled:cursor-not-allowed flex-shrink-0"
							id="btn-f-prev">
							<i data-lucide="chevron-left" class="w-6 h-6 text-white"></i>
						</button>
						<div
							class="bg-black/90 px-6 py-3 rounded-full border border-neon-teal/30 backdrop-blur-md w-[90%] max-w-3xl h-auto flex items-center justify-center text-center">
							<span id="fetch-desc" class="font-mono text-neon-teal text-xs font-bold px-2">Start: Dati
								pronti in RAM</span>
						</div>
						<button onclick="nextFetchStep()"
							class="p-2 rounded-full bg-white/10 hover:bg-white/20 border border-white/20 transition-colors disabled:opacity-30 disabled:cursor-not-allowed flex-shrink-0"
							id="btn-f-next">
							<i data-lucide="chevron-right" class="w-6 h-6 text-white"></i>
						</button>
					</div>
				</div>
			</section>
			<section class="mb-16">
				<div
					class="bg-gradient-to-br from-gray-900 to-black p-8 md:p-12 rounded-2xl border border-white/10 relative overflow-hidden flex flex-col md:flex-row items-center gap-12 group hover:border-neon-teal/30 transition-all">
					<div
						class="absolute top-1/2 right-10 -translate-y-1/2 p-4 opacity-5 pointer-events-none group-hover:opacity-10 transition-opacity">
						<i data-lucide="watch" class="w-64 h-64 md:w-96 md:h-96"></i>
					</div>
					<div class="flex-1 z-10 space-y-6">
						<h3 class="text-3xl font-bold text-white flex items-center gap-3"><i data-lucide="clock"
								class="text-neon-teal w-8 h-8"></i> Orologio di Sistema (Clock)</h3>
						<p class="text-gray-300 text-lg text-justify leading-relaxed"> Il clock di sistema (system
							clock) è un circuito elettronico che genera segnali periodici sotto forma di impulsi
							elettrici. Come il battito di un metronomo, ogni impulso scandisce il tempo, generando
							scandendo un ritmo regolare che scandisce ogni singola operazione interna. </p>
						<p class="text-gray-300 text-lg text-justify leading-relaxed"> In particolare, fa partire e
							scandisce le operazioni della CPU e permette di sincronizzare tutte le parti del computer
							(CPU, memoria, bus, periferiche). </p>
						<p class="text-gray-300 text-lg text-justify leading-relaxed"> Senza clock, il computer non
							avrebbe un tempo comune e svolgerebbe le proprie operazioni con tempistiche totalmente
							sfalsate. </p>
						<p class="text-gray-300 text-lg text-justify leading-relaxed">La velocità del clock si misura in
							<strong>Hertz (Hz)</strong>, ovvero cicli al secondo.
						</p>
						<div class="flex flex-wrap gap-4 mt-4 opacity-70">
							<div class="bg-black/50 p-3 rounded-lg border border-white/10 flex flex-col items-start">
								<span
									class="text-gray-500 text-[10px] font-mono uppercase tracking-wider">Definizione</span><span
									class="text-gray-300 font-mono text-sm">1 Hz = 1 ciclo/s</span>
							</div>
							<div class="bg-black/50 p-3 rounded-lg border border-white/10 flex flex-col items-start">
								<span
									class="text-gray-500 text-[10px] font-mono uppercase tracking-wider">Definizione</span><span
									class="text-gray-300 font-mono text-sm">1 GHz = 1 Miliardo/s</span>
							</div>
						</div>
						<span class="text-neon-teal block mt-2">Le CPU moderne hanno un clock tra i 2GHz e i
							5GHz.</span>
					</div>
					<div class="flex flex-col items-center gap-6 z-10">
						<div
							class="relative w-64 h-64 flex-shrink-0 flex items-end justify-center bg-white/5 rounded-full border border-white/5 shadow-inner backdrop-blur-sm p-8">
							<div
								class="absolute inset-0 rounded-full border-t border-r border-l border-transparent border-t-gray-600/30 rotate-45">
							</div>
							<div class="absolute bottom-10 w-4 h-4 bg-gray-400 rounded-full z-20 shadow-lg"></div>
							<div id="metronome-stick"
								class="w-1.5 h-40 bg-gray-600 rounded-full origin-bottom animate-metronome-manual relative z-10 flex flex-col justify-between items-center pb-2"
								style="animation-duration: 2s;">
								<div class="w-6 h-8 bg-neon-teal rounded shadow-[0_0_20px_rgba(45,212,191,0.6)] relative top-4 transition-all duration-300"
									id="metronome-weight">
									<div class="absolute inset-0 bg-white/30 rounded blur-[2px]"></div>
								</div>
							</div>
							<div class="absolute top-10 left-10 text-gray-600 font-mono text-xs animate-pulse">TIC</div>
							<div class="absolute top-10 right-10 text-gray-600 font-mono text-xs animate-pulse"
								style="animation-delay: 0.6s">TAC</div>
							<div id="clock-status-text"
								class="absolute bottom-4 text-neon-teal font-mono text-xs font-bold tracking-widest uppercase z-30">
								1 Hz (Didattico)</div>
						</div>
						<div class="flex gap-3 bg-black/40 p-2 rounded-xl border border-white/10 backdrop-blur-md">
							<button onclick="changeClockSpeed('slow', this)"
								class="clock-btn bg-neon-teal text-black font-bold px-4 py-2 rounded-lg text-xs font-mono transition-all hover:scale-105 border border-transparent shadow-[0_0_10px_rgba(45,212,191,0.3)]">1
								Hz</button>
							<button onclick="changeClockSpeed('medium', this)"
								class="clock-btn bg-transparent text-gray-400 hover:text-white hover:bg-white/10 px-4 py-2 rounded-lg text-xs font-mono transition-all border border-transparent">100
								MHz</button>
							<button onclick="changeClockSpeed('fast', this)"
								class="clock-btn bg-transparent text-gray-400 hover:text-white hover:bg-white/10 px-4 py-2 rounded-lg text-xs font-mono transition-all border border-transparent group">4
								GHz</button>
						</div>
					</div>
				</div>
			</section>
			<section class="bg-dark-card border border-white/5 rounded-2xl p-8 mb-16">
				<h2 class="text-2xl font-bold text-white mb-6">Microprocessori Multi-core</h2>
				<div class="flex flex-col md:flex-row gap-8 items-center">
					<div class="flex-1">
						<p class="text-gray-300 text-justify mb-4">
							Per aumentare la potenza di calcolo, i moderni microprocessori non si limitano più ad avere
							una sola unità di calcolo, ma integrano più core all’interno dello stesso chip.
							Ogni core può essere visto come una piccola CPU autonoma, con la propria unità di controllo
							e la propria ALU.
						</p>
						<ul class="space-y-2 text-sm text-gray-400 mb-6">
							<li>• <strong>Dual-core:</strong> 2 unità di calcolo</li>
							<li>• <strong>Quad-core:</strong> 4 unità di calcolo</li>
						</ul>
						<span class="text-neon-teal block mt-2">I PC moderni hanno anche da 8 fino a 32 core!</span>
					</div>
					<div class="flex-shrink-0 grid grid-cols-2 gap-2 p-4 bg-black rounded-xl border border-gray-700">
						<div
							class="w-20 h-20 bg-neon-teal/10 border border-neon-teal flex items-center justify-center rounded">
							<span class="text-neon-teal font-mono font-bold">CORE 1</span>
						</div>
						<div
							class="w-20 h-20 bg-neon-teal/10 border border-neon-teal flex items-center justify-center rounded">
							<span class="text-neon-teal font-mono font-bold">CORE 2</span>
						</div>
						<div
							class="w-20 h-20 bg-neon-teal/10 border border-neon-teal flex items-center justify-center rounded">
							<span class="text-neon-teal font-mono font-bold">CORE 3</span>
						</div>
						<div
							class="w-20 h-20 bg-neon-teal/10 border border-neon-teal flex items-center justify-center rounded">
							<span class="text-neon-teal font-mono font-bold">CORE 4</span>
						</div>
					</div>
				</div>
			</section>
			<!-- Sezione: Tipologie di Calcolo (NUOVA) -->
			<section class="mb-16">
				<h2 class="text-2xl font-bold text-white mb-8 border-l-4 border-white pl-4">Tipologie di calcolo</h2>
				<div class="grid md:grid-cols-3 gap-6">
					<!-- 1. Calcolo Sequenziale -->
					<div
						class="bg-dark-card p-6 rounded-xl border border-blue-500/30 hover:border-blue-500 transition-all group flex flex-col h-full hover:shadow-[0_0_20px_rgba(59,130,246,0.15)]">
						<div class="flex items-center gap-4 mb-4">
							<div
								class="w-12 h-12 bg-blue-500/20 rounded-full flex items-center justify-center group-hover:scale-110 transition-transform">
								<i data-lucide="arrow-right-circle" class="text-blue-400 w-6 h-6"></i>
							</div>
							<div>
								<h3 class="text-lg font-bold text-white leading-tight">Calcolo sequenziale</h3>
								<p class="text-blue-400 text-[10px] font-mono uppercase tracking-widest mt-1">Una
									istruzione alla volta</p>
							</div>
						</div>
						<div class="flex-grow">
							<p class="text-gray-300 text-sm mb-4 leading-relaxed text-justify">
								È il metodo tradizionale: la CPU esegue un'istruzione dopo l'altra in ordine rigoroso.
								<br>
								Se un programma si blocca o richiede un'operazione lunga, tutto il sistema deve
								aspettare.
							</p>
						</div>
					</div>
					<!-- 2. Multitasking -->
					<div
						class="bg-dark-card p-6 rounded-xl border border-neon-purple/30 hover:border-neon-purple transition-all group flex flex-col h-full hover:shadow-[0_0_20px_rgba(188,19,254,0.15)]">
						<div class="flex items-center gap-4 mb-4">
							<div
								class="w-12 h-12 bg-neon-purple/20 rounded-full flex items-center justify-center group-hover:scale-110 transition-transform">
								<i data-lucide="layers" class="text-neon-purple w-6 h-6"></i>
							</div>
							<div>
								<h3 class="text-lg font-bold text-white leading-tight">Multitasking</h3>
								<p class="text-neon-purple text-[10px] font-mono uppercase tracking-widest mt-1">
									Simulazione di simultaneità</p>
							</div>
						</div>
						<div class="flex-grow">
							<p class="text-gray-300 text-sm mb-4 leading-relaxed text-justify">
								Permette di eseguire più programmi "contemporaneamente". In realtà, se il core è uno
								solo, la CPU passa velocemente da un programma all'altro (Context Switching) creando
								l'illusione della simultaneità.
							</p>
						</div>
					</div>
					<!-- 3. Calcolo Parallelo -->
					<div
						class="bg-dark-card p-6 rounded-xl border border-neon-teal/30 hover:border-neon-teal transition-all group flex flex-col h-full hover:shadow-[0_0_20px_rgba(45,212,191,0.15)]">
						<div class="flex items-center gap-4 mb-4">
							<div
								class="w-12 h-12 bg-neon-teal/20 rounded-full flex items-center justify-center group-hover:scale-110 transition-transform">
								<i data-lucide="cpu" class="text-neon-teal w-6 h-6"></i>
							</div>
							<div>
								<h3 class="text-lg font-bold text-white leading-tight">Calcolo Parallelo</h3>
								<p class="text-neon-teal text-[10px] font-mono uppercase tracking-widest mt-1">
									Simultaneità reale</p>
							</div>
						</div>
						<div class="flex-grow">
							<p class="text-gray-300 text-sm mb-4 leading-relaxed text-justify">
								Sfruttando processori Multi-core, il computer può eseguire istruzioni diverse nello
								stesso identico istante su core diversi. È una vera esecuzione simultanea che raddoppia
								o quadruplica la velocità.
							</p>
						</div>
					</div>
				</div>
				<!-- SIMULATORE INTERATTIVO (NUOVO) -->
				<div class="bg-dark-card border border-white/10 rounded-2xl p-6 mb-10 mt-16 overflow-hidden relative">
					<div
						class="absolute top-0 left-0 w-full h-1 bg-gradient-to-r from-neon-blue via-neon-purple to-neon-teal">
					</div>
					<div class="flex flex-col md:flex-row justify-between items-center mb-4 gap-4">
						<h3 class="text-xl font-bold text-white flex items-center gap-2">
							<i data-lucide="play-circle" class="text-neon-green"></i> Simulatore Processi
						</h3>
						<!-- Controlli -->
						<div class="flex bg-black/40 p-1 rounded-lg border border-white/10">
							<button onclick="setSimMode('sequential')" id="btn-seq"
								class="px-4 py-2 rounded-md text-xs font-mono font-bold transition-all text-gray-400 hover:text-white">SEQUENZIALE</button>
							<button onclick="setSimMode('multitasking')" id="btn-multi"
								class="px-4 py-2 rounded-md text-xs font-mono font-bold transition-all text-gray-400 hover:text-white">MULTITASKING</button>
							<button onclick="setSimMode('parallel')" id="btn-para"
								class="px-4 py-2 rounded-md text-xs font-mono font-bold transition-all text-gray-400 hover:text-white">PARALLELO</button>
						</div>
					</div>
					<!-- Spiegazione Dinamica (SPOSTATA SOPRA) -->
					<div
						class="mb-6 p-4 bg-white/5 rounded-lg border border-white/10 min-h-[60px] flex items-center justify-center">
						<p id="sim-description" class="text-sm text-gray-300 font-mono leading-relaxed text-center">
							Seleziona una modalità per iniziare la simulazione.
						</p>
					</div>
					<!-- Area Visualizzazione -->
					<div class="grid grid-cols-1 md:grid-cols-4 gap-4 min-h-[300px]">
						<!-- Colonna 1: Coda Processi -->
						<div class="md:col-span-1 bg-black/20 rounded-xl p-4 border border-white/5 flex flex-col">
							<h4 class="text-gray-400 text-xs font-mono uppercase mb-4 text-center">Coda (Queue)</h4>
							<div id="sim-queue"
								class="flex-grow flex flex-col-reverse justify-start gap-2 p-2 min-h-[200px] border-2 border-dashed border-gray-700/50 rounded-lg">
								<!-- I task appariranno qui -->
							</div>
						</div>
						<!-- Colonna 2 & 3: CPU Cores -->
						<div
							class="md:col-span-2 bg-gray-900/50 rounded-xl p-6 border border-white/10 relative flex flex-col justify-center items-center gap-6">
							<h4 class="absolute top-4 left-4 text-gray-400 text-xs font-mono uppercase">CPU Unit</h4>
							<!-- Core 1 -->
							<div class="w-full flex items-center gap-4">
								<div class="w-16 text-right text-xs font-mono text-neon-teal font-bold">CORE 1</div>
								<div id="sim-core-1"
									class="sim-core flex-grow h-24 bg-dark-card border-2 border-neon-teal/30 rounded-xl flex items-center justify-center relative overflow-hidden shadow-inner transition-all">
									<!-- Placeholder per task attivo -->
									<div class="absolute bottom-0 left-0 h-1 bg-neon-teal transition-all duration-75 w-0"
										id="progress-core-1"></div>
									<span class="text-gray-600 text-xs font-mono">IDLE</span>
								</div>
							</div>
							<!-- Core 2 (Visibile solo in Parallelo) -->
							<div id="core-2-container"
								class="w-full flex items-center gap-4 opacity-30 blur-[2px] transition-all duration-500">
								<div class="w-16 text-right text-xs font-mono text-neon-purple font-bold">CORE 2</div>
								<div id="sim-core-2"
									class="sim-core flex-grow h-24 bg-dark-card border-2 border-neon-purple/30 rounded-xl flex items-center justify-center relative overflow-hidden shadow-inner">
									<div class="absolute bottom-0 left-0 h-1 bg-neon-purple transition-all duration-75 w-0"
										id="progress-core-2"></div>
									<span class="text-gray-600 text-xs font-mono">OFFLINE</span>
								</div>
							</div>
						</div>
						<!-- Colonna 4: Completati -->
						<div class="md:col-span-1 bg-black/20 rounded-xl p-4 border border-white/5 flex flex-col">
							<h4 class="text-gray-400 text-xs font-mono uppercase mb-4 text-center">Finiti</h4>
							<div id="sim-finished"
								class="flex-grow flex flex-col justify-start gap-2 p-2 min-h-[200px] border-2 border-dashed border-gray-700/50 rounded-lg">
								<!-- Task finiti -->
							</div>
						</div>
					</div>
				</div>
			</section>
			<div class="flex justify-between mt-12 pt-8 border-t border-white/10">
				<!-- AGGIORNATO: Punta alla Lezione 3 -->
				<button onclick="navigateTo('lesson-3')"
					class="flex items-center gap-2 text-gray-400 hover:text-white transition-colors">
					<i data-lucide="arrow-left"></i> Precedente: Scheda madre
				</button>
				<!-- AGGIORNATO: Punta alla Lezione 5 -->
				<button onclick="navigateTo('lesson-5')"
					class="flex items-center gap-2 text-neon-pink hover:text-white font-bold transition-colors">
					Prossima: La GPU <i data-lucide="arrow-right"></i>
				</button>
			</div>
		</div>
		<!-- ================= LESSON 5 VIEW (NUOVA: GPU) ================= -->
		<div id="lesson-5-view" class="hidden w-full max-w-5xl mx-auto animate-fade-in z-10">
			<!-- Intestazione -->
			<div class="mb-12 border-b border-white/10 pb-6 flex items-center justify-between">
				<div>
					<span class="text-neon-pink font-mono text-sm tracking-widest">LEZIONE 05</span>
					<h1 class="text-4xl md:text-5xl font-bold text-white mt-2">La GPU</h1>
					<p class="text-gray-400 mt-4 text-lg">Graphics Processing Unit: la potenza del calcolo parallelo.
					</p>
				</div>
				<div class="hidden md:block text-neon-pink/20 animate-spin-slow">
					<i data-lucide="monitor-play" class="w-24 h-24"></i>
				</div>
			</div>
			<section class="mb-16 animate-fade-in">
				<!-- Intro GPU (Testo + Foto) -->
				<div class="grid md:grid-cols-2 gap-8 mb-12 items-center">
					<div class="space-y-6 text-gray-300 text-justify leading-relaxed">
						<p>
							La scheda video di un computer integra un microprocessore molto potente, chiamato <strong
								class="text-neon-pink">GPU (Graphics Processing Unit)</strong>, nato per gestire la
							grafica del computer, in particolare il rendering delle immagini e della grafica
							tridimensionale.
						</p>
						<p> La GPU contiene un numero enorme di ALU che lavorano in parallelo, nell'ordine delle
							migliaia o decine di migliaia!
							Viene inoltre affiancata da una memoria RAM dedicata, che si trova fisicamente dentro la
							scheda video e quindi con un tempo di accesso molto più veloce.
						</p>
					</div>
					<!-- Foto GPU -->
					<div
						class="bg-dark-card rounded-2xl border border-neon-pink/30 p-4 md:p-6 flex flex-col items-center justify-center gap-4 h-full shadow-[0_0_30px_rgba(255,0,153,0.1)] hover:shadow-[0_0_40px_rgba(255,0,153,0.2)] transition-shadow">
						<div
							class="relative w-full aspect-[4/3] rounded-lg overflow-hidden border border-neon-pink/50 group">
							<img src="https://images.unsplash.com/photo-1591488320449-011701bb6704?q=80&w=2070&auto=format&fit=crop"
								alt="Scheda Video GPU"
								class="w-full h-full object-cover group-hover:scale-110 transition-transform duration-700">
							<!-- Overlay estetico -->
							<div
								class="absolute inset-0 bg-neon-pink/10 mix-blend-overlay group-hover:bg-transparent transition-colors">
							</div>
						</div>
						<span class="text-xs text-gray-400 font-mono text-center flex items-center gap-2">
							<i data-lucide="cpu" class="w-3 h-3 text-neon-pink"></i> Una scheda video moderna
						</span>
					</div>
				</div>
				<!-- SIMULATORE INTERATTIVO: CPU VS GPU RACE -->
				<div class="bg-dark-card border border-white/10 rounded-2xl p-6 relative overflow-hidden mb-12">
					<div class="absolute top-0 left-0 w-full h-1 bg-gradient-to-r from-neon-teal to-neon-pink"></div>
					<div class="text-center mb-8">
						<h3 class="text-2xl font-bold text-white mb-2">Simulazione Rendering</h3>
						<p class="text-gray-400 text-sm">Obiettivo: Calcolare (colorare) un'immagine di <strong
								class="text-white">10.000 pixel</strong> (100x100).</p>
					</div>
					<div class="flex justify-center mb-2">
						<button onclick="startCpuGpuRace()" id="btn-race"
							class="px-8 py-3 bg-white text-black font-bold rounded-full hover:bg-gray-200 transition-all shadow-[0_0_20px_rgba(255,255,255,0.2)] flex items-center gap-2 group">
							<i data-lucide="play" class="group-hover:fill-black"></i> AVVIA CONFRONTO
						</button>
					</div>
					<!-- SPAZIO RISERVATO PER IL COUNTDOWN -->
					<div id="race-countdown-display"
						class="h-16 flex items-center justify-center mb-6 font-mono text-4xl font-bold text-neon-green tracking-widest drop-shadow-[0_0_10px_rgba(0,255,157,0.5)] min-h-[4rem]">
					</div>
					<div class="grid md:grid-cols-2 gap-8 md:gap-16 px-4">
						<!-- CPU SIDE -->
						<div class="flex flex-col items-center relative">
							<div
								class="flex items-center gap-2 mb-4 bg-black/40 px-4 py-2 rounded-full border border-neon-teal/30">
								<i data-lucide="cpu" class="text-neon-teal w-5 h-5"></i>
								<h4 class="text-neon-teal font-bold font-mono">CPU (32 Core)</h4>
							</div>
							<!-- CPU Canvas -->
							<canvas id="cpu-canvas" width="100" height="100"
								class="w-48 h-48 bg-gray-900 border-2 border-gray-700 rounded-lg shadow-lg mb-4"></canvas>
							<div class="w-full bg-gray-800 h-2 rounded-full overflow-hidden mb-2">
								<div id="cpu-progress" class="bg-neon-teal h-full w-0 transition-all duration-75"></div>
							</div>
							<p id="cpu-stats" class="text-xs font-mono text-gray-500">Stato: In attesa</p>
						</div>
						<!-- DIVISORE VS -->
						<div
							class="absolute left-1/2 top-1/2 -translate-x-1/2 -translate-y-1/2 hidden md:flex flex-col items-center justify-center pointer-events-none z-10">
							<div class="w-px h-24 bg-gradient-to-b from-transparent via-gray-500 to-transparent"></div>
							<span
								class="bg-dark-card border border-white/20 px-2 py-1 rounded text-xs font-bold text-white my-2">VS</span>
							<div class="w-px h-24 bg-gradient-to-b from-transparent via-gray-500 to-transparent"></div>
						</div>
						<!-- GPU SIDE -->
						<div class="flex flex-col items-center relative">
							<div
								class="flex items-center gap-2 mb-4 bg-black/40 px-4 py-2 rounded-full border border-neon-pink/30">
								<i data-lucide="grid" class="text-neon-pink w-5 h-5"></i>
								<h4 class="text-neon-pink font-bold font-mono">GPU (10.000 Core)</h4>
							</div>
							<!-- GPU Canvas -->
							<canvas id="gpu-canvas" width="100" height="100"
								class="w-48 h-48 bg-gray-900 border-2 border-gray-700 rounded-lg shadow-lg mb-4"></canvas>
							<div class="w-full bg-gray-800 h-2 rounded-full overflow-hidden mb-2">
								<div id="gpu-progress" class="bg-neon-pink h-full w-0 transition-all duration-75"></div>
							</div>
							<p id="gpu-stats" class="text-xs font-mono text-gray-500">Stato: In attesa</p>
						</div>
					</div>
				</div>
				<!-- Perché non posso usare solo la GPU? -->
				<div class="mb-12">
					<h3 class="text-xl font-bold text-white mb-6 pl-4 border-l-4 border-neon-pink">Perché non posso
						usare solo la GPU?</h3>
					<div
						class="bg-gradient-to-r from-red-900/20 to-transparent p-6 rounded-xl border-l-4 border-red-500 mb-6">
						<p class="text-gray-300 italic">
							La GPU non è una “CPU migliore”, ma un processore diverso, progettato per svolgere un tipo
							di lavoro differente: non sostituisce la CPU, ma <strong class="text-white">collabora
							</strong> con essa.
						</p>
					</div>
					<div class="grid md:grid-cols-2 gap-6 my-6">
						<div class="bg-black/30 p-4 rounded-lg">
							<p class="text-sm text-white text-justify">
								<strong class="text-neon-teal block mb-3 text-lg uppercase tracking-wide">La CPU eccelle
									(e la GPU soffre):</strong>
								Nel calcolo sequenziale e per la gestione di flussi di controllo complessi.
								È particolarmente efficiente quando le istruzioni devono essere eseguite una dopo
								l’altra,
								con frequenti decisioni, salti condizionali e percorsi di esecuzione variabili.
								La sua architettura infatti privilegia la rapidità nel cambiare contesto e la
								capacità di coordinare molte operazioni diverse, anche poco prevedibili.
							</p>
						</div>
						<div class="bg-black/30 p-4 rounded-lg">
							<p class="text-sm text-white text-justify">
								<strong class="text-neon-pink block mb-3 text-lg uppercase tracking-wide">La GPU eccelle
									(e la CPU soffre):</strong>
								Nel calcolo parallelo massivo, in cui un numero elevatissimo di operazioni simili viene
								eseguito
								contemporaneamente su dati differenti. È particolarmente efficace quando il flusso di
								esecuzione è
								regolare e uniforme, con poche diramazioni e molte operazioni identiche applicate a
								grandi quantità
								di dati. La sua architettura infatti privilegia l’elevata produttività complessiva
								(throughput)
								piuttosto che la velocità di una singola operazione.
							</p>
						</div>
					</div>
				</div>
				<!-- Confronto CPU vs GPU -->
				<div class="bg-gray-900/50 rounded-2xl p-8 border border-white/10 mb-12">
					<h3 class="text-2xl font-bold text-white text-center mb-8">Confronto Architetturale: CPU vs GPU</h3>
					<!-- NUOVO SCHEMINO ARCHITETTURALE AGGIORNATO -->
					<div class="grid grid-cols-1 md:grid-cols-2 gap-8 mb-12">
						<!-- CPU Schematic -->
						<div
							class="bg-black/40 p-6 rounded-xl border border-neon-teal/30 flex flex-col items-center shadow-[0_0_20px_rgba(45,212,191,0.1)] h-full">
							<h5 class="text-neon-teal font-bold mb-6 font-mono text-center flex items-center gap-2">
								<i data-lucide="cpu" class="w-5 h-5"></i> CPU: Central Processing Unit
							</h5>
							<!-- Detailed Core Representation -->
							<div
								class="w-full max-w-[220px] bg-gray-800 border-2 border-neon-teal rounded-lg p-3 flex flex-col gap-2 relative shadow-lg group hover:scale-105 transition-transform">
								<div
									class="absolute -top-3 left-1/2 -translate-x-1/2 bg-gray-900 px-2 text-xs text-neon-teal font-mono border border-neon-teal/50 rounded">
									SINGLE CORE</div>
								<!-- Control Unit (Dominant) -->
								<div
									class="bg-yellow-500/20 border border-yellow-500/50 rounded p-3 flex flex-col items-center justify-center mb-1">
									<span class="text-[10px] text-yellow-500 font-bold font-mono">CONTROL UNIT
										(CU)</span>
								</div>
								<div class="flex gap-2 h-24">
									<!-- ALU -->
									<div
										class="flex-1 bg-neon-teal/20 border border-neon-teal rounded flex flex-col items-center justify-center p-1">
										<span class="text-xs font-bold text-neon-teal font-mono">ALU</span>
									</div>
									<!-- Registers -->
									<div
										class="w-1/3 bg-blue-500/20 border border-blue-500/50 rounded flex flex-col items-center justify-center p-1">
										<span
											class="text-[9px] text-blue-500 font-bold font-mono break-all text-center">REGISTRI</span>
									</div>
								</div>
								<!-- Cache -->
								<div
									class="bg-purple-500/20 border border-purple-500/50 rounded p-2 flex items-center justify-center">
									<span class="text-[10px] text-purple-400 font-mono font-bold">CACHE</span>
								</div>
							</div>
						</div>
						<!-- GPU Schematic -->
						<div
							class="bg-black/40 p-6 rounded-xl border border-neon-pink/30 flex flex-col items-center shadow-[0_0_20px_rgba(255,0,153,0.1)] h-full">
							<h5 class="text-neon-pink font-bold mb-6 font-mono text-center flex items-center gap-2">
								<i data-lucide="grid" class="w-5 h-5"></i> GPU: Graphics Processing Unit
							</h5>
							<!-- GPU Hierarchy Container (AGGIORNATO: VRAM Verticale + Righe CU) -->
							<div
								class="w-full max-w-[280px] bg-gray-900 border-2 border-neon-pink rounded-lg p-2 flex gap-2 relative shadow-lg group hover:scale-105 transition-transform">
								<div
									class="absolute -top-3 left-1/2 -translate-x-1/2 bg-gray-900 px-2 text-xs text-neon-pink font-mono border border-neon-pink/50 rounded whitespace-nowrap">
									STRUTTURA GPU</div>
								<!-- LEFT: SHARED VRAM (Verticale) -->
								<div
									class="w-10 bg-green-900/20 border-2 border-green-500/50 rounded flex flex-col items-center justify-center relative py-2">
									<!-- Testo ruotato -->
									<span
										class="text-[10px] text-green-400 font-bold font-mono tracking-wider -rotate-90 whitespace-nowrap">RAM
										CONDIVISA</span>
									<!-- Connection Lines to CUs -->
									<div class="absolute right-[-8px] top-[15%] w-2 h-[1px] bg-gray-600"></div>
									<div class="absolute right-[-8px] top-[38%] w-2 h-[1px] bg-gray-600"></div>
									<div class="absolute right-[-8px] top-[62%] w-2 h-[1px] bg-gray-600"></div>
									<div class="absolute right-[-8px] top-[85%] w-2 h-[1px] bg-gray-600"></div>
								</div>
								<!-- RIGHT: STACK OF COMPUTE UNITS (Righe) -->
								<div class="flex-1 flex flex-col gap-2 pt-2">
									<!-- CU 1 (Detailed Row) -->
									<div
										class="w-full h-10 bg-gray-800 border border-neon-pink/60 rounded p-1 flex items-center gap-1.5 relative">
										<!-- CU Control Box (Giallo) -->
										<div
											class="flex flex-col items-center justify-center w-6 border-r border-white/10 pr-1">
											<div
												class="w-5 h-5 bg-yellow-500 rounded-[2px] flex items-center justify-center shadow-[0_0_5px_rgba(234,179,8,0.5)]">
												<span class="text-[6px] text-black font-bold font-mono">CU</span>
											</div>
										</div>
										<!-- ALUs Grid (Green Squares with Text) -->
										<div
											class="flex-1 bg-black/40 rounded p-0.5 grid grid-cols-5 gap-[1px] content-center h-full overflow-hidden">
											<!-- Riga 1 -->
											<div class="bg-neon-green rounded-[1px] flex items-center justify-center">
												<span class="text-[4px] font-bold text-black leading-none">ALU</span>
											</div>
											<div class="bg-neon-green rounded-[1px] flex items-center justify-center">
												<span class="text-[4px] font-bold text-black leading-none">ALU</span>
											</div>
											<div class="bg-neon-green rounded-[1px] flex items-center justify-center">
												<span class="text-[4px] font-bold text-black leading-none">ALU</span>
											</div>
											<div class="bg-neon-green rounded-[1px] flex items-center justify-center">
												<span class="text-[4px] font-bold text-black leading-none">ALU</span>
											</div>
											<div class="bg-neon-green rounded-[1px] flex items-center justify-center">
												<span class="text-[4px] font-bold text-black leading-none">ALU</span>
											</div>
											<!-- Riga 2 -->
											<div class="bg-neon-green rounded-[1px] flex items-center justify-center">
												<span class="text-[4px] font-bold text-black leading-none">ALU</span>
											</div>
											<div class="bg-neon-green rounded-[1px] flex items-center justify-center">
												<span class="text-[4px] font-bold text-black leading-none">ALU</span>
											</div>
											<div class="bg-neon-green rounded-[1px] flex items-center justify-center">
												<span class="text-[4px] font-bold text-black leading-none">ALU</span>
											</div>
											<div class="bg-neon-green rounded-[1px] flex items-center justify-center">
												<span class="text-[4px] font-bold text-black leading-none">ALU</span>
											</div>
											<div class="bg-neon-green rounded-[1px] flex items-center justify-center">
												<span class="text-[4px] font-bold text-black leading-none">ALU</span>
											</div>
											<!-- Riga 3 -->
											<div class="bg-neon-green rounded-[1px] flex items-center justify-center">
												<span class="text-[4px] font-bold text-black leading-none">ALU</span>
											</div>
											<div class="bg-neon-green rounded-[1px] flex items-center justify-center">
												<span class="text-[4px] font-bold text-black leading-none">ALU</span>
											</div>
											<div class="bg-neon-green rounded-[1px] flex items-center justify-center">
												<span class="text-[4px] font-bold text-black leading-none">ALU</span>
											</div>
											<div class="bg-neon-green rounded-[1px] flex items-center justify-center">
												<span class="text-[4px] font-bold text-black leading-none">ALU</span>
											</div>
											<div class="bg-neon-green rounded-[1px] flex items-center justify-center">
												<span class="text-[4px] font-bold text-black leading-none">ALU</span>
											</div>
										</div>
										<!-- Local Mem (R & C) -->
										<div class="w-3 flex flex-col gap-[1px] h-full">
											<div
												class="h-1/2 bg-blue-500/30 rounded-[1px] flex items-center justify-center">
												<span class="text-[6px] font-mono text-blue-200 font-bold">R</span>
											</div>
											<div
												class="h-1/2 bg-purple-500/30 rounded-[1px] flex items-center justify-center">
												<span class="text-[6px] font-mono text-purple-200 font-bold">C</span>
											</div>
										</div>
									</div>
									<!-- CU 2 (Row) -->
									<div
										class="w-full h-10 bg-gray-800 border border-neon-pink/60 rounded p-1 flex items-center gap-1.5 relative opacity-90">
										<div
											class="flex flex-col items-center justify-center w-6 border-r border-white/10 pr-1">
											<div
												class="w-5 h-5 bg-yellow-500 rounded-[2px] flex items-center justify-center shadow-[0_0_5px_rgba(234,179,8,0.5)]">
												<span class="text-[6px] text-black font-bold font-mono">CU</span>
											</div>
										</div>
										<div
											class="flex-1 bg-black/40 rounded p-0.5 grid grid-cols-5 gap-[1px] content-center h-full overflow-hidden">
											<div class="bg-neon-green rounded-[1px] flex items-center justify-center">
												<span class="text-[4px] font-bold text-black leading-none">ALU</span>
											</div>
											<div class="bg-neon-green rounded-[1px] flex items-center justify-center">
												<span class="text-[4px] font-bold text-black leading-none">ALU</span>
											</div>
											<div class="bg-neon-green rounded-[1px] flex items-center justify-center">
												<span class="text-[4px] font-bold text-black leading-none">ALU</span>
											</div>
											<div class="bg-neon-green rounded-[1px] flex items-center justify-center">
												<span class="text-[4px] font-bold text-black leading-none">ALU</span>
											</div>
											<div class="bg-neon-green rounded-[1px] flex items-center justify-center">
												<span class="text-[4px] font-bold text-black leading-none">ALU</span>
											</div>
											<div class="bg-neon-green rounded-[1px] flex items-center justify-center">
												<span class="text-[4px] font-bold text-black leading-none">ALU</span>
											</div>
											<div class="bg-neon-green rounded-[1px] flex items-center justify-center">
												<span class="text-[4px] font-bold text-black leading-none">ALU</span>
											</div>
											<div class="bg-neon-green rounded-[1px] flex items-center justify-center">
												<span class="text-[4px] font-bold text-black leading-none">ALU</span>
											</div>
											<div class="bg-neon-green rounded-[1px] flex items-center justify-center">
												<span class="text-[4px] font-bold text-black leading-none">ALU</span>
											</div>
											<div class="bg-neon-green rounded-[1px] flex items-center justify-center">
												<span class="text-[4px] font-bold text-black leading-none">ALU</span>
											</div>
											<div class="bg-neon-green rounded-[1px] flex items-center justify-center">
												<span class="text-[4px] font-bold text-black leading-none">ALU</span>
											</div>
											<div class="bg-neon-green rounded-[1px] flex items-center justify-center">
												<span class="text-[4px] font-bold text-black leading-none">ALU</span>
											</div>
											<div class="bg-neon-green rounded-[1px] flex items-center justify-center">
												<span class="text-[4px] font-bold text-black leading-none">ALU</span>
											</div>
											<div class="bg-neon-green rounded-[1px] flex items-center justify-center">
												<span class="text-[4px] font-bold text-black leading-none">ALU</span>
											</div>
											<div class="bg-neon-green rounded-[1px] flex items-center justify-center">
												<span class="text-[4px] font-bold text-black leading-none">ALU</span>
											</div>
										</div>
										<div class="w-3 flex flex-col gap-[1px] h-full">
											<div
												class="h-1/2 bg-blue-500/30 rounded-[1px] flex items-center justify-center">
												<span class="text-[6px] font-mono text-blue-200 font-bold">R</span>
											</div>
											<div
												class="h-1/2 bg-purple-500/30 rounded-[1px] flex items-center justify-center">
												<span class="text-[6px] font-mono text-purple-200 font-bold">C</span>
											</div>
										</div>
									</div>
									<!-- CU 3 (Row) -->
									<div
										class="w-full h-10 bg-gray-800 border border-neon-pink/60 rounded p-1 flex items-center gap-1.5 relative opacity-80">
										<div
											class="flex flex-col items-center justify-center w-6 border-r border-white/10 pr-1">
											<div
												class="w-5 h-5 bg-yellow-500 rounded-[2px] flex items-center justify-center">
												<span class="text-[6px] text-black font-bold font-mono">CU</span>
											</div>
										</div>
										<div
											class="flex-1 bg-black/40 rounded p-0.5 grid grid-cols-5 gap-[1px] content-center h-full overflow-hidden">
											<div class="bg-neon-green rounded-[1px] flex items-center justify-center">
												<span class="text-[4px] font-bold text-black leading-none">ALU</span>
											</div>
											<div class="bg-neon-green rounded-[1px] flex items-center justify-center">
												<span class="text-[4px] font-bold text-black leading-none">ALU</span>
											</div>
											<div class="bg-neon-green rounded-[1px] flex items-center justify-center">
												<span class="text-[4px] font-bold text-black leading-none">ALU</span>
											</div>
											<div class="bg-neon-green rounded-[1px] flex items-center justify-center">
												<span class="text-[4px] font-bold text-black leading-none">ALU</span>
											</div>
											<div class="bg-neon-green rounded-[1px] flex items-center justify-center">
												<span class="text-[4px] font-bold text-black leading-none">ALU</span>
											</div>
											<div class="bg-neon-green rounded-[1px] flex items-center justify-center">
												<span class="text-[4px] font-bold text-black leading-none">ALU</span>
											</div>
											<div class="bg-neon-green rounded-[1px] flex items-center justify-center">
												<span class="text-[4px] font-bold text-black leading-none">ALU</span>
											</div>
											<div class="bg-neon-green rounded-[1px] flex items-center justify-center">
												<span class="text-[4px] font-bold text-black leading-none">ALU</span>
											</div>
											<div class="bg-neon-green rounded-[1px] flex items-center justify-center">
												<span class="text-[4px] font-bold text-black leading-none">ALU</span>
											</div>
											<div class="bg-neon-green rounded-[1px] flex items-center justify-center">
												<span class="text-[4px] font-bold text-black leading-none">ALU</span>
											</div>
											<div class="bg-neon-green rounded-[1px] flex items-center justify-center">
												<span class="text-[4px] font-bold text-black leading-none">ALU</span>
											</div>
											<div class="bg-neon-green rounded-[1px] flex items-center justify-center">
												<span class="text-[4px] font-bold text-black leading-none">ALU</span>
											</div>
											<div class="bg-neon-green rounded-[1px] flex items-center justify-center">
												<span class="text-[4px] font-bold text-black leading-none">ALU</span>
											</div>
											<div class="bg-neon-green rounded-[1px] flex items-center justify-center">
												<span class="text-[4px] font-bold text-black leading-none">ALU</span>
											</div>
											<div class="bg-neon-green rounded-[1px] flex items-center justify-center">
												<span class="text-[4px] font-bold text-black leading-none">ALU</span>
											</div>
										</div>
										<div class="w-3 flex flex-col gap-[1px] h-full">
											<div
												class="h-1/2 bg-blue-500/30 rounded-[1px] flex items-center justify-center">
												<span class="text-[6px] font-mono text-blue-200 font-bold">R</span>
											</div>
											<div
												class="h-1/2 bg-purple-500/30 rounded-[1px] flex items-center justify-center">
												<span class="text-[6px] font-mono text-purple-200 font-bold">C</span>
											</div>
										</div>
									</div>
									<!-- CU 4 (Row) -->
									<div
										class="w-full h-10 bg-gray-800 border border-neon-pink/60 rounded p-1 flex items-center gap-1.5 relative opacity-70">
										<div
											class="flex flex-col items-center justify-center w-6 border-r border-white/10 pr-1">
											<div
												class="w-5 h-5 bg-yellow-500 rounded-[2px] flex items-center justify-center">
												<span class="text-[6px] text-black font-bold font-mono">CU</span>
											</div>
										</div>
										<div
											class="flex-1 bg-black/40 rounded p-0.5 grid grid-cols-5 gap-[1px] content-center h-full overflow-hidden">
											<div class="bg-neon-green rounded-[1px] flex items-center justify-center">
												<span class="text-[4px] font-bold text-black leading-none">ALU</span>
											</div>
											<div class="bg-neon-green rounded-[1px] flex items-center justify-center">
												<span class="text-[4px] font-bold text-black leading-none">ALU</span>
											</div>
											<div class="bg-neon-green rounded-[1px] flex items-center justify-center">
												<span class="text-[4px] font-bold text-black leading-none">ALU</span>
											</div>
											<div class="bg-neon-green rounded-[1px] flex items-center justify-center">
												<span class="text-[4px] font-bold text-black leading-none">ALU</span>
											</div>
											<div class="bg-neon-green rounded-[1px] flex items-center justify-center">
												<span class="text-[4px] font-bold text-black leading-none">ALU</span>
											</div>
											<div class="bg-neon-green rounded-[1px] flex items-center justify-center">
												<span class="text-[4px] font-bold text-black leading-none">ALU</span>
											</div>
											<div class="bg-neon-green rounded-[1px] flex items-center justify-center">
												<span class="text-[4px] font-bold text-black leading-none">ALU</span>
											</div>
											<div class="bg-neon-green rounded-[1px] flex items-center justify-center">
												<span class="text-[4px] font-bold text-black leading-none">ALU</span>
											</div>
											<div class="bg-neon-green rounded-[1px] flex items-center justify-center">
												<span class="text-[4px] font-bold text-black leading-none">ALU</span>
											</div>
											<div class="bg-neon-green rounded-[1px] flex items-center justify-center">
												<span class="text-[4px] font-bold text-black leading-none">ALU</span>
											</div>
											<div class="bg-neon-green rounded-[1px] flex items-center justify-center">
												<span class="text-[4px] font-bold text-black leading-none">ALU</span>
											</div>
											<div class="bg-neon-green rounded-[1px] flex items-center justify-center">
												<span class="text-[4px] font-bold text-black leading-none">ALU</span>
											</div>
											<div class="bg-neon-green rounded-[1px] flex items-center justify-center">
												<span class="text-[4px] font-bold text-black leading-none">ALU</span>
											</div>
											<div class="bg-neon-green rounded-[1px] flex items-center justify-center">
												<span class="text-[4px] font-bold text-black leading-none">ALU</span>
											</div>
											<div class="bg-neon-green rounded-[1px] flex items-center justify-center">
												<span class="text-[4px] font-bold text-black leading-none">ALU</span>
											</div>
										</div>
										<div class="w-3 flex flex-col gap-[1px] h-full">
											<div
												class="h-1/2 bg-blue-500/30 rounded-[1px] flex items-center justify-center">
												<span class="text-[6px] font-mono text-blue-200 font-bold">R</span>
											</div>
											<div
												class="h-1/2 bg-purple-500/30 rounded-[1px] flex items-center justify-center">
												<span class="text-[6px] font-mono text-purple-200 font-bold">C</span>
											</div>
										</div>
									</div>
								</div>
							</div>
						</div>
					</div>
				</div>
				<br>
				<!-- A cosa serve la GPU -->
				<h3 class="text-xl font-bold text-white mb-6 pl-4 border-l-4 border-neon-pink">A cosa serve la GPU</h3>
				<p class="text-gray-300 mb-6 text-justify">
					Per questo motivo la GPU non è adatta a eseguire un programma qualsiasi. Un sistema operativo, un
					browser o un editor di testo richiedono la gestione continua di eventi, interruzioni e input/output.
				</p>
				<p class="text-gray-300 mb-6 text-justify">
					La GPU è invece fondamentale nei <strong class="text-white">videogiochi </strong>, dove si occupa
					del rendering della grafica tridimensionale, cioè del calcolo delle immagini visualizzate sullo
					schermo: luci, ombre, movimenti e colori non sono nient'altro che lo stesso semplice calcolo
					applicato a milioni di pixel.
				</p>
				<p class="text-gray-300 mb-6 text-justify">
					Oggi, però, la GPU non viene utilizzata solo per la grafica. Grazie alla sua straordinaria capacità
					di calcolo parallelo, è impiegata anche in altri ambiti che richiedono l’elaborazione di grandi
					quantità di dati, come:
				</p>
				<div class="grid md:grid-cols-3 gap-6 mb-12">
					<!-- Card Science -->
					<div
						class="bg-dark-lighter p-6 rounded-xl border border-white/5 hover:border-neon-pink/50 transition-all group hover:-translate-y-1">
						<div
							class="w-12 h-12 bg-neon-pink/10 rounded-full flex items-center justify-center mb-4 group-hover:scale-110 transition-transform">
							<i data-lucide="flask-conical" class="text-neon-pink w-6 h-6"></i>
						</div>
						<h4 class="text-white font-bold mb-2">Scienza</h4>
						<p class="text-gray-400 text-sm">L’analisi dei dati negli esperimenti scientifici.</p>
					</div>
					<!-- Card AI -->
					<div
						class="bg-dark-lighter p-6 rounded-xl border border-white/5 hover:border-neon-purple/50 transition-all group hover:-translate-y-1">
						<div
							class="w-12 h-12 bg-neon-purple/10 rounded-full flex items-center justify-center mb-4 group-hover:scale-110 transition-transform">
							<i data-lucide="brain-circuit" class="text-neon-purple w-6 h-6"></i>
						</div>
						<h4 class="text-white font-bold mb-2">Machine Learning</h4>
						<p class="text-gray-400 text-sm">Il machine learning e l’addestramento delle intelligenze
							artificiali.</p>
					</div>
					<!-- Card Crypto -->
					<div
						class="bg-dark-lighter p-6 rounded-xl border border-white/5 hover:border-neon-yellow/50 transition-all group hover:-translate-y-1">
						<div
							class="w-12 h-12 bg-neon-yellow/10 rounded-full flex items-center justify-center mb-4 group-hover:scale-110 transition-transform">
							<i data-lucide="coins" class="text-neon-yellow w-6 h-6"></i>
						</div>
						<h4 class="text-white font-bold mb-2">Crypto Mining</h4>
						<p class="text-gray-400 text-sm">Il mining delle criptovalute.</p>
					</div>
				</div>
			</section>
			<div class="flex justify-between mt-12 pt-8 border-t border-white/10">
				<button onclick="navigateTo('lesson-4')"
					class="flex items-center gap-2 text-gray-400 hover:text-white transition-colors">
					<i data-lucide="arrow-left"></i> Precedente: CPU
				</button>
				<button class="flex items-center gap-2 text-gray-600 cursor-not-allowed font-bold">
					Prossima: Memorie <i data-lucide="lock" class="w-4 h-4"></i>
				</button>
			</div>
		</div>
		<!-- ================= LESSON 6 VIEW (NUOVA: RAM) ================= -->
		<div id="lesson-6-view" class="hidden w-full max-w-5xl mx-auto animate-fade-in z-10">
			<!-- Intestazione -->
			<div class="mb-12 border-b border-white/10 pb-6 flex items-center justify-between">
				<div>
					<span class="text-neon-purple font-mono text-sm tracking-widest">LEZIONE 06</span>
					<h1 class="text-4xl md:text-5xl font-bold text-white mt-2">La memoria RAM</h1>
					<p class="text-gray-400 mt-4 text-lg">Lo spazio di lavoro temporaneo del computer.</p>
				</div>
				<div class="hidden md:block text-neon-purple/20 animate-pulse-slow">
					<i data-lucide="grid-3x3" class="w-24 h-24"></i>
				</div>
			</div>
			<!-- Intro -->
			<section class="mb-16">
				<div
					class="bg-dark-card border border-white/5 rounded-2xl p-8 hover:border-neon-purple/30 transition-all">
					<div class="flex flex-col md:flex-row gap-12 items-center">
						<!-- TESTO -->
						<div class="md:w-2/3">
							<p class="text-gray-300 leading-relaxed text-lg mb-8 text-justify">
								Il termine memoria indica l’insieme dei dispositivi del computer che conservano dati e
								istruzioni.
							</p>
							<p class="text-gray-300 leading-relaxed text-lg mb-8 text-justify">
								La memoria centrale, detta RAM (Random Access Memory), è una memoria di lettura e
								scrittura utilizzata dal computer mentre elabora le informazioni.
								Durante il processo di elaborazione, nella memoria RAM vengono caricati le istruzioni
								del sistema operativo, i programmi in esecuzione e i dati su cui questi lavorano.
							</p>
							<p class="text-gray-300 leading-relaxed text-lg text-justify">
								In altre parole, la RAM è lo spazio di lavoro temporaneo del computer.
							</p>
						</div>
						<!-- IMMAGINE -->
						<div class="md:w-2/3 bg-gray-900 p-4 rounded-xl border border-white/10 group">
							<img src="https://images.unsplash.com/photo-1562976540-1502c2145186?auto=format&fit=crop&q=80&w=600"
								alt="RAM Modulo Fig 3.13"
								class="w-full rounded-lg shadow-2xl group-hover:scale-105 transition-transform">
							<p class="text-center text-xs text-gray-500 font-mono mt-4 tracking-widest">
								Modulo di memoria RAM
							</p>
						</div>
					</div>
				</div>
			</section>
			<!-- Sezione: Volatilità e Velocità -->
			<section class="mb-16">
				<h2 class="text-3xl font-bold text-white mb-8 border-l-4 border-neon-purple pl-6">Le due caratteristiche
					fondamentali</h2>
				<div class="grid md:grid-cols-2 gap-8">
					<div class="bg-dark-lighter p-8 rounded-2xl border border-white/5 space-y-4">
						<h3 class="text-2xl font-bold text-white flex items-center gap-3">
							<i data-lucide="ghost" class="text-neon-blue"></i> È volatile
						</h3>
						<p class="text-gray-300 text-justify">
							Cioè temporanea, un po’ come una lavagna: vi si scrivono dati utili durante una certa
							elaborazione, ma al termine di essa il contenuto può essere cancellato e la memoria
							riutilizzata per nuove operazioni.
						</p>
						<p class="text-gray-300 text-justify">
							Quando il computer viene spento, infatti, i dati presenti nella RAM vengono persi.
						</p>
						<!-- SIMULATORE VOLATILITÀ -->
						<div class="mt-8 bg-black/40 p-6 rounded-xl border border-white/10 flex flex-col items-center">
							<div class="flex justify-between w-full mb-6 items-center">
								<button onclick="toggleRamPower()" id="ram-power-btn"
									class="px-4 py-2 bg-neon-green text-black font-bold rounded-full text-xs transition-all flex items-center gap-2 shadow-[0_0_15px_rgba(0,255,157,0.3)]">
									<i data-lucide="power"></i> <span>ALIMENTATO</span>
								</button>
							</div>
							<!-- Griglia di dati RAM Verticale -->
							<div class="w-full max-w-[200px] border-x border-white/10 bg-dark-card/50 overflow-hidden rounded-lg shadow-inner"
								id="ram-grid">
								<!-- Generati da JS con layout verticale -->
							</div>
						</div>
					</div>
					<div class="bg-dark-lighter p-8 rounded-2xl border border-white/5 space-y-4">
						<h3 class="text-2xl font-bold text-white flex items-center gap-3">
							<i data-lucide="gauge" class="text-neon-purple"></i> È molto veloce
						</h3>
						<p class="text-gray-300 text-justify">
							La CPU può accedere ai dati memorizzati nella RAM in tempi estremamente ridotti, evitando
							rallentamenti durante l’elaborazione.
						</p>
						<p class="text-gray-300 text-justify">
							Come vedremo, l'accesso alla memoria di massa è estremamente più lento rispetto alla RAM.
						</p>
						<div
							class="mt-8 bg-black/40 p-6 rounded-xl border border-white/10 flex flex-col items-center overflow-hidden">
							<div class="relative w-full h-80 flex flex-col items-center justify-between py-4">
								<!-- RAM (Sopra) -->
								<div id="speed-ram"
									class="w-48 p-3 bg-dark-card border-2 border-neon-purple rounded-lg flex flex-col items-center gap-1 shadow-[0_0_15px_rgba(188,19,254,0.1)] transition-all">
									<i data-lucide="grid-3x3" class="text-neon-purple w-6 h-6"></i>
									<span class="text-[10px] font-bold font-mono text-white">RAM (Nanosecondi)</span>
								</div>
								<!-- CPU (Centro) -->
								<div id="speed-cpu"
									class="w-32 p-3 bg-dark-card border-2 border-neon-teal rounded-lg flex flex-col items-center gap-1 z-10 shadow-[0_0_20px_rgba(45,212,191,0.2)]">
									<i data-lucide="cpu" class="text-neon-teal w-8 h-8"></i>
									<span class="text-[10px] font-bold font-mono text-white">CPU</span>
								</div>
								<!-- DISCO (Sotto) -->
								<div id="speed-disk"
									class="w-48 p-3 bg-dark-card border-2 border-neon-amber rounded-lg flex flex-col items-center gap-1 shadow-[0_0_15px_rgba(255,191,0,0.1)] transition-all">
									<i data-lucide="hard-drive" class="text-neon-amber w-6 h-6"></i>
									<span class="text-[10px] font-bold font-mono text-white">DISCO (Millisecondi)</span>
								</div>
								<!-- Linee Bus -->
								<div class="absolute top-[4.5rem] bottom-[4.5rem] w-1 bg-white/5 bus-line"
									id="speed-bus"></div>
								<!-- Pacchetto Dati (Animato) -->
								<div id="data-packet"
									class="absolute w-4 h-4 bg-white rounded-full hidden z-20 shadow-[0_0_10px_white]">
								</div>
							</div>
							<!-- Controlli -->
							<div class="grid grid-cols-2 gap-4 w-full mt-4">
								<button onclick="requestFrom('ram')" id="btn-req-ram"
									class="p-2 bg-neon-purple/20 border border-neon-purple text-neon-purple font-mono text-[10px] font-bold rounded hover:bg-neon-purple/40 transition-all uppercase">Richiedi
									dati alla RAM</button>
								<button onclick="requestFrom('disk')" id="btn-req-disk"
									class="p-2 bg-neon-amber/20 border border-neon-amber text-neon-amber font-mono text-[10px] font-bold rounded hover:bg-neon-amber/40 transition-all uppercase">Richiedi
									dati al disco</button>
							</div>
							<!-- Barra di caricamento per il disco -->
							<div class="w-full h-1 bg-white/5 mt-4 rounded-full overflow-hidden">
								<div id="disk-loading-bar" class="h-full bg-neon-amber w-0 loading-bar-inner"></div>
							</div>
							<p id="speed-info"
								class="text-[10px] text-gray-500 font-mono mt-4 uppercase tracking-widest text-center min-h-[1.2rem]">
								Seleziona una memoria per avviare la richiesta.</p>
						</div>
					</div>
				</div>
			</section>
			<!-- Sezione: Struttura e funzionamento -->
			<section class="mb-16">
				<div class="bg-gradient-to-br from-dark-lighter to-dark-bg p-8 rounded-3xl border border-white/10">
					<h2 class="text-3xl font-bold text-white mb-8">Struttura e funzionamento della RAM</h2>

					<!-- Contenitore flessibile per affiancare testo e simulatore -->
					<div class="md:flex md:gap-8 items-start">
						<!-- Colonna Testo -->
						<div class="space-y-6 md:w-1/2">
							<p class="text-gray-300 text-justify">
								La RAM è formata da moltissimi microscopici condensatori, componenti elettronici capaci
								di accumulare carica elettrica.
								Ogni condensatore memorizza un bit: se è carico il bit vale 1, altrimenti vale 0.
							</p>
							<p class="text-gray-300 text-justify">
								Tuttavia, al contrario dei transistor, la carica elettrica del condensatore non è
								stabile: col passare del tempo tende a svuotarsi, passando da 1 a 0 per errore.
							</p>
							<p class="text-gray-300 text-justify">
								Per questo motivo, per mantenere le proprie informazioni la RAM deve essere
								periodicamente “ricaricata” tramite un processo chiamato refresh, riscrivendo il dato
								prima che la carica si esaurisca.
								Questo processo di refresh è continuo e automatico, tipicamente ogni 64 ms.
								finché il computer non viene spento, momento in cui i condensatori si svuotano
								completamente.
							</p>
							<p class="text-gray-300 text-justify">
								Essendo volatile, la RAM può conservare i dati comunque finché il computer è acceso e
								alimentato elettricamente. Quando il computer viene spento, i condensatori si svuotano
								completamente e le informazioni vengono perse.
								Per memorizzare in modo permanente i risultati di un’elaborazione è quindi
								indispensabile salvarli nella memoria di massa prima di spegnere il computer. Questo
								spiega perché è importante salvare spesso il proprio lavoro: nel caso in cui il computer
								dovesse spegnersi improvvisamente, le informazioni in RAM sarebbero perse per sempre!
							</p>



						</div>

						<!-- Colonna Simulatore -->
						<div class="md:w-1/2 flex flex-col items-center">
							<div class="bg-gray-900 p-4 rounded-xl border border-white/10 group">
								<img src="condensatore.jpg" alt="Condensatore"
									class="w-full h-40 object-cover rounded-lg shadow-2xl group-hover:scale-105 transition-transform">
								<p class="text-center text-xs text-gray-500 font-mono mt-4 tracking-widest">
									Forma di un condensatore: è uno più grande presente sulla superficie della RAM, con
									uno scopo diverso ma con la stessa struttura di base.</p>
							</div>
							<br><br>
							<div id="refresh-sim-target"
								class="bg-black/40 border border-white/10 rounded-2xl p-6 shadow-2xl w-full flex flex-col items-center">
								<div class="flex gap-3 md:gap-4 h-64 mb-2">
									<!-- Deve rimanere con lo stesso ID perché il JS lo seleziona -->
									<div id="refresh-sim-container" class="flex gap-2 md:gap-2"></div>
								</div>
								<div class="flex flex-col items-center w-auto">
									<button onclick="performRefresh()"
										class=" text-sm w-auto py-2 px-6 bg-blue-400 text-black font-bold rounded-xl flex items-center justify-center gap-3 hover:shadow-[0_0_25px_rgba(79,195,247,0.4)] transition-all transform hover:-translate-y-1 active:scale-95">
										<i data-lucide="refresh-cw"></i> Refresh
									</button>
								</div>
							</div>

						</div>

					</div>

					<!-- Altri paragrafi sotto il simulatore -->
					<div class="mt-10 space-y-6">
						<p class="text-gray-300 text-justify">
							All’interno della RAM, gruppi di otto condensatori rappresentano otto bit, cioè un byte, e a
							ciascun byte è associato un indirizzo di memoria ben definito, ovvero un numero che
							identifica in modo univoco la sua posizione all’interno della memoria.
						</p>
						<p class="text-gray-300 text-justify">
							La memoria è dunque organizzata come una grande matrice di celle, disposte in righe e
							colonne. Ogni cella contiene un condensatore e i circuiti necessari per leggerne o
							modificarne lo stato. Quando la CPU deve accedere a un dato, fornisce l’indirizzo di
							memoria; i circuiti della RAM utilizzano questo indirizzo per individuare prima la riga
							corrispondente, consentendo un accesso diretto e rapido alla memoria.
						</p>



					</div>
					<div class="flex flex-col lg:flex-row items-center justify-center gap-0 relative h-[380px]">

						<!-- Colonna 1: Metafora Cassettiera -->
						<div class="w-20 flex flex-col items-center flex-shrink-0 mr-4">
							<div
								class="text-[9px] text-center font-mono text-gray-500 uppercase mb-2 tracking-widest font-bold">
								RAM = Cassettiera</div>
							<div id="drawer-cabinet" class="w-full h-[320px] overflow-hidden flex flex-col">
								<!-- Generati da JS -->
							</div>
						</div>

						<!-- Colonna 2: Stack -->
						<div class="w-24 flex flex-col items-center flex-shrink-0 relative z-10">
							<div class="text-[9px] font-mono text-gray-500 uppercase mb-2 tracking-widest font-bold">RAM
							</div>
							<div class="w-16 h-[320px] bg-black/60 border border-white/20 rounded overflow-hidden flex flex-col p-0 relative shadow-inner"
								id="ram-stack-container">
								<div id="zoom-indicator-target"
									class="absolute top-2 left-0 w-full h-12 bg-neon-purple/40 border-y border-neon-purple z-10 pointer-events-none shadow-[0_0:15px_rgba(188,19,254,0.4)]">
								</div>
							</div>
						</div>

						<!-- AREA CONNETTORE DINAMICO (IMBUTO) -->
						<div class="hidden lg:block flex-shrink-0 w-20 h-[320px] relative">
							<svg id="zoom-lines-svg" width="100%" height="100%" preserveAspectRatio="none"
								class="absolute inset-0 pointer-events-none overflow-visible">
								<defs>
									<linearGradient id="zoomGradient" x1="0%" y1="0%" x2="100%" y2="0%">
										<stop offset="0%" style="stop-color:#bc13fe; stop-opacity:0.4" />
										<stop offset="100%" style="stop-color:#bc13fe; stop-opacity:0.05" />
									</linearGradient>
								</defs>
								<polygon id="zoom-funnel" points="0,0 80,0 80,320 0,60" class="zoom-connector-shape" />
							</svg>
						</div>

						<!-- Colonna 3: Zoom Detail -->
						<div id="matrix-zoom-box"
							class="w-fit bg-black/40 rounded-2xl border border-neon-purple/30 p-4 relative shadow-2xl z-10 flex-shrink-0 mt-4">
							<div
								class="absolute -top-3 left-4 bg-dark-card px-2 py-0.5 border border-neon-purple/30 rounded text-[8px] font-mono text-neon-purple font-bold uppercase tracking-widest">
								Dettaglio Zoom
							</div>

							<div class="w-fit">
								<div class="flex mb-3 border-b border-white/10 pb-1">
									<div
										class="w-10 text-[8px] font-mono text-gray-500 flex items-center justify-center font-bold uppercase">
										Ind.</div>
									<div class="flex gap-1.5 px-2">
										<span class="w-5 text-center text-[7px] font-mono text-neon-blue">b0</span>
										<span class="w-5 text-center text-[7px] font-mono text-neon-blue">b1</span>
										<span class="w-5 text-center text-[7px] font-mono text-neon-blue">b2</span>
										<span class="w-5 text-center text-[7px] font-mono text-neon-blue">b3</span>
										<span class="w-5 text-center text-[7px] font-mono text-neon-blue">b4</span>
										<span class="w-5 text-center text-[7px] font-mono text-neon-blue">b5</span>
										<span class="w-5 text-center text-[7px] font-mono text-neon-blue">b6</span>
										<span class="w-5 text-center text-[7px] font-mono text-neon-blue">b7</span>
									</div>
								</div>
								<div id="matrix-container" class="space-y-1"></div>
							</div>
						</div>
					</div>
			</section>

			<!-- Sezione: Accesso Casuale -->
			<section class="mb-16">
				<h2 class="text-3xl font-bold text-white mb-8 border-l-4 border-neon-purple pl-6">L’accesso casuale ai
					dati</h2>
				<p class="text-gray-300 text-lg mb-8 text-justify">
					Come detto, RAM è l’acronimo di Random Access Memory, cioè “memoria ad accesso casuale”, anche detto
					accesso diretto.
				</p>
				<div class="grid  gap-12 items-center">
					<div class="space-y-6">
						<p class="text-gray-300 text-justify">
							L’aggettivo casuale non significa che per accedere a un dato ci si muove " a caso", ma che
							il fatto che ogni cella venga identificata da un indirizzo, la CPU può accedere direttamente
							a qualsiasi indirizzo di memoria senza dover scorrere tutte le posizioni precedenti.
						</p>
						<p class="text-gray-300 text-justify">
							In altre parole, scegliendo casualmente una qualsiasi delle miliardi di celle della memoria
							RAM, il tempo di accesso non cambia.
						</p>
						<p class="text-gray-300 text-justify">
							Questo tipo di accesso di contrappone a quello di tipo sequenziale, tipico dei nastri
							magnetici (ormai non più utilizzati) o parzialmente agli HDD odierni: per raggiungere un
							dato è necessario far scorrere il supporto a partire dall'inizio, una posizione dopo l'altra
							fino a quella desiderata. <br> Oggi l’accesso casuale è invece presente anche nei
							dispositivi di memoria di massa più moderni, come gli SSD o i dischi ottici.
						</p>
					</div>
				</div>
				<br><br>
				<div
					class="bg-dark-card border border-white/10 rounded-2xl p-4 md:p-6 shadow-2xl relative overflow-hidden">
					<div class="absolute top-0 left-0 w-full h-1 bg-gradient-to-r from-neon-purple to-neon-amber"></div>
					<!-- INPUT AREA -->
					<div class="flex flex-col items-center mb-6">
						<div
							class="flex items-center gap-4 bg-black/40 px-4 py-2 rounded-xl border border-white/10 shadow-inner">
							<label for="letter-input"
								class="text-white font-mono text-[10px] uppercase tracking-widest font-bold">
								Inserisci lettera (A-Z):
							</label>
							<input type="text" id="letter-input" maxlength="1"
								class="w-10 h-10 bg-dark-bg border-2 border-neon-blue rounded-lg text-white text-center font-mono font-bold text-xl focus:outline-none focus:border-white transition-all uppercase"
								placeholder="?" autocomplete="off">
						</div>
					</div>
					<!-- RAM TRACK -->
					<div class="space-y-2 mb-6">
						<div class="flex justify-between items-center px-1">
							<span
								class="text-[12px] font-mono text-neon-purple uppercase font-bold tracking-widest">Accesso
								casuale (o diretto)</span>
						</div>
						<div class="flex justify-between gap-[1px] p-1 bg-black/40 rounded border border-white/5"
							id="ram-access-track">
							<!-- Generati da JS: 26 elementi -->
						</div>
						<!-- CPU ANALYSIS -->
						<div id="calc-display"
							class="bg-neon-purple/5 p-2 rounded-xl border border-neon-purple/20 min-h-[55px] flex items-center justify-center text-center shadow-inner mx-auto max-w-lg">
							<p class="text-[8px] text-gray-500 font-mono italic uppercase tracking-widest">In attesa
								della CPU...</p>
						</div>
					</div>
					<!-- TAPE TRACK -->
					<div class="space-y-2 pt-4 border-t border-white/10">
						<div class="flex justify-between items-center px-1">
							<span
								class="text-[12px] font-mono text-neon-amber uppercase font-bold tracking-widest">Accesso
								sequenziale</span>
						</div>
						<div class="relative h-14 bg-black rounded-xl border border-white/10 flex items-center px-2"
							id="tape-container-box">
							<div class="flex gap-[1px] items-center z-10 w-full justify-between" id="tape-track-static">
								<!-- Generati da JS: 26 elementi -->
							</div>
							<!-- Head -->
							<div id="read-head"
								class="absolute top-0 h-full border-x-[1px] border-neon-amber bg-neon-amber/5 read-head z-20 pointer-events-none flex flex-col justify-between items-center py-1">
								<i data-lucide="chevron-down" class="text-neon-amber w-2 h-2"></i>
								<i data-lucide="chevron-up" class="text-neon-amber w-2 h-2"></i>
							</div>
						</div>
						<div id="calc-display-msg"
							class="bg-neon-purple/5 p-2 rounded-xl border border-neon-purple/20 min-h-[55px] flex items-center justify-center text-center shadow-inner mx-auto max-w-lg">
							<p class="text-[8px] text-gray-500 font-mono italic uppercase tracking-widest">In attesa
								della CPU...</p>
						</div>
					</div>
				</div>
			</section>
			<!-- Sezione: Capacità -->
			<section class="mb-16">
				<h2 class="text-3xl font-bold text-white mb-8 border-l-4 border-neon-purple pl-6">Capacità e prestazioni
				</h2>
				<div class="gap-12 items-start">
					<div class="space-y-6">
						<p class="text-gray-300 text-justify">
							Nei personal computer, la RAM è generalmente costituita da uno o più moduli o banchi, come
							quelli mostrati nella foto iniziale, inseriti direttamente sulla scheda madre.</p>
						<p class="text-gray-300 text-justify">
							La capacità della RAM indica il numero massimo di byte che essa può contenere, cioè la
							quantità di dati e istruzioni che possono essere memorizzati contemporaneamente per essere
							utilizzati dalla CPU. Oggigiorno questa capacità è misurata in gigabyte (GB), cioè miliardi
							di byte.</p>
						<div class="text-gray-300 text-justify">
							Questo è un fattore determinante per le prestazioni di un computer. È infatti necessaria
							per:
							<div class="mt-1">
								<div class="flex items-start gap-2 mt-1">
									<span class="text-white-400">•</span>
									<span>Il funzionamento del sistema operativo, che spesso occupa una parte
										significativa della memoria.</span>
								</div>
								<div class="flex items-start gap-2 mt-1">
									<span class="text-white-400">•</span>
									<span>Il multitasking, dovendo contenere tutti i programmi e i dati in
										esecuzione.</span>
								</div>
								<div class="flex items-start gap-2 mt-1">
									<span class="text-white-400">•</span>
									<span>Prestazioni generali: RAM insufficiente porta alla virtualizzazione della
										memoria (di cui si parlerà successivamente) che rallenta pesantemente il
										sistema.</span>
								</div>
							</div>
						</div>



						<p class="text-gray-300 text-justify mb-0">
							In generale, maggiore è la RAM disponibile, maggiore è il numero di programmi che possono
							essere eseguiti contemporaneamente in modo fluido, senza rallentamenti o blocchi.
						</p>


						<span class="text-neon-teal block mt-2">I PC moderni usano banchi di RAM da 4 - 32 GB,
							raggiungendo un totale di 8 - 64 GB.</span>
					</div>




				</div>
			</section>
			<!-- Navigazione Lezioni -->
			<div class="flex justify-between mt-12 pt-8 border-t border-white/10">
				<button onclick="navigateTo('lesson-5')"
					class="flex items-center gap-2 text-gray-400 hover:text-white transition-colors">
					<i data-lucide="arrow-left"></i> Precedente: La GPU
				</button>
				<button onclick="navigateTo('lesson-7')"
					class="flex items-center gap-2 text-neon-amber hover:text-white font-bold transition-colors">
					Prossima: La Memoria ROM <i data-lucide="arrow-right"></i>
				</button>
			</div>
		</div>

		<!-- ================= LESSON 7 VIEW ================= -->
		<div id="lesson-7-view" class="hidden w-full max-w-5xl mx-auto animate-fade-in z-10">
			<!-- Intestazione -->
			<div class="mb-12 border-b border-white/10 pb-6 flex items-center justify-between">
				<div>
					<span class="text-neon-amber font-mono text-sm tracking-widest">LEZIONE 07</span>
					<h1 class="text-4xl md:text-5xl font-bold text-white mt-2">La Memoria ROM</h1>
					<p class="text-gray-400 mt-4 text-lg">La memoria di sola lettura e il soffio vitale del computer.
					</p>
				</div>
				<div class="hidden md:block text-neon-amber/20 animate-pulse-slow">
					<i data-lucide="save" class="w-24 h-24"></i>
				</div>
			</div>

			<!-- ROM vs RAM -->
			<section class="mb-16">
				<div
					class="bg-dark-card border border-white/5 rounded-2xl p-8 hover:border-neon-amber/30 transition-all">
					<div class="flex flex-col md:flex-row gap-12 items-center">
						<!-- TESTO -->
						<div class="md:w-2/3">
							<div class="bg-neon-red/10 border border-neon-red/30 p-6 rounded-2xl mb-6">
								<h3 class="text-neon-red font-bold flex items-center gap-2 mb-4">
									<i data-lucide="zap-off"></i> Il limite della RAM
								</h3>
								<p class="text-gray-300 leading-relaxed text-justify">
									La RAM presenta però un limite importante: è una memoria <b>volatile</b>. Questo
									significa che, quando il computer viene spento, il suo contenuto viene perso e la
									RAM risulta inizialmente vuota. Dunque, chi carica le istruzioni necessarie
									per l'avvio del computer?
								</p>
							</div>
							<p class="text-gray-300 leading-relaxed text-lg text-justify">
								Per ovviare a questo problema, il computer utilizza un altro tipo di memoria: la <b>ROM
									(Read-Only Memory)</b>, cioè memoria di sola lettura. La ROM è una memoria
								<b>permanente</b>, quindi mantiene le informazioni anche quando il computer è spento.
								Essa risiede sulla scheda madre ed è progettata per contenere i dati fondamentali per
								l’avvio del sistema.
							</p>
						</div>
						<!-- IMMAGINE ROM -->
						<div class="md:w-1/3 bg-gray-900 p-4 rounded-xl border border-white/10 group">
							<img src="rom.jpg" alt="ROM Chip"
								class="w-full rounded-lg shadow-2xl group-hover:scale-105 transition-transform duration-700">
							<p class="text-center text-[10px] text-gray-500 font-mono mt-4 tracking-widest uppercase">
								Chip di una ROM
							</p>
						</div>
					</div>
				</div>
			</section>

			<!-- Firmware and Boot -->
			<section class="mb-16">
				<h2 class="text-3xl font-bold text-white mb-8 border-l-4 border-neon-amber pl-6">Firmware e fase di Boot
				</h2>
				<div
					class="bg-dark-card border border-white/5 rounded-3xl p-8 hover:border-neon-amber/30 transition-all">
					<div class="grid md:grid-cols-3 gap-8">
						<div class="md:col-span-2 space-y-6">
							<p class="text-gray-300 leading-relaxed text-lg text-justify">
								All’interno della ROM è memorizzato un particolare tipo di software chiamato
								<b>firmware</b>, un software di base fornito dal costruttore del computer che ha il
								compito di avviare e controllare le prime operazioni dell'hardware.
							</p>
							<p class="text-gray-300 leading-relaxed text-lg text-justify">
								In particolare, la ROM contiene il programma di avviamento, detto bootstrap o più
								semplicemente boot.
							</p>
							<p class="text-gray-300 leading-relaxed text-lg text-justify">
								Questo programma viene eseguito subito dopo l’accensione del computer e ha il compito
								di:
							</p>
							<ul class="space-y-4">
								<li
									class="flex items-start gap-4 bg-white/5 p-4 rounded-xl border border-white/10 hover:bg-white/10 transition-colors">
									<div
										class="w-8 h-8 rounded-lg bg-neon-amber/20 flex items-center justify-center flex-shrink-0">
										<i data-lucide="settings" class="text-neon-amber w-5 h-5"></i>
									</div>
									<span class="text-gray-200">Inizializzare i componenti hardware principali (CPU,
										RAM, periferiche);</span>
								</li>
								<li
									class="flex items-start gap-4 bg-white/5 p-4 rounded-xl border border-white/10 hover:bg-white/10 transition-colors">
									<div
										class="w-8 h-8 rounded-lg bg-neon-green/20 flex items-center justify-center flex-shrink-0">
										<i data-lucide="check-circle" class="text-neon-green w-5 h-5"></i>
									</div>
									<span class="text-gray-200">Verificare che il sistema funzioni correttamente;</span>
								</li>
								<li
									class="flex items-start gap-4 bg-white/5 p-4 rounded-xl border border-white/10 hover:bg-white/10 transition-colors">
									<div
										class="w-8 h-8 rounded-lg bg-neon-blue/20 flex items-center justify-center flex-shrink-0">
										<i data-lucide="search" class="text-neon-blue w-5 h-5"></i>
									</div>
									<span class="text-gray-200">Individuare il dispositivo che contiene il sistema
										operativo (disco fisso, SSD, chiavetta USB, ecc.);</span>
								</li>
								<li
									class="flex items-start gap-4 bg-white/5 p-4 rounded-xl border border-white/10 hover:bg-white/10 transition-colors">
									<div
										class="w-8 h-8 rounded-lg bg-neon-purple/20 flex items-center justify-center flex-shrink-0">
										<i data-lucide="upload" class="text-neon-purple w-5 h-5"></i>
									</div>
									<span class="text-gray-200">Caricare in RAM il sistema operativo, che da quel
										momento prenderà il controllo del computer.</span>
								</li>
							</ul>
							<span class="text-neon-teal block mt-2">I PC moderni hanno una ROM di 8 - 32 MB.</span>
						</div>

						<!-- BOOT SIMULATOR -->
						<div
							class="bg-black rounded-2xl border-2 border-neon-amber/50 overflow-hidden flex flex-col h-fit max-h-[450px] self-start shadow-[0_0_30px_rgba(255,191,0,0.1)]">
							<div class="bg-neon-amber px-4 py-2 flex items-center justify-between">
								<span class="text-black font-mono font-bold text-xs uppercase">Boot Simulator</span>
								<div class="flex gap-1">
									<div class="w-2 h-2 rounded-full bg-black/30"></div>
									<div class="w-2 h-2 rounded-full bg-black/30"></div>
									<div class="w-2 h-2 rounded-full bg-black/30"></div>
								</div>
							</div>
							<div id="boot-terminal"
								class="h-[280px] p-4 font-mono text-[10px] text-neon-amber/80 overflow-y-auto custom-scrollbar bg-black leading-tight">
								<div class="opacity-50 italic mb-2">// Premere il tasto di accensione</div>
							</div>
							<div class="p-4 border-t border-white/10">
								<button onclick="startBootSequence()" id="boot-btn"
									class="w-full py-2 bg-neon-amber text-black font-bold rounded-lg hover:shadow-[0_0_15px_rgba(255,191,0,0.5)] transition-all flex items-center justify-center gap-2">
									<i data-lucide="power" class="w-4 h-4"></i> ACCENDI PC
								</button>
							</div>
						</div>
					</div>
				</div>
			</section>

			<!-- BIOS vs UEFI -->
			<section class="mb-16">
				<h2 class="text-3xl font-bold text-white mb-8 border-l-4 border-neon-blue pl-6">L'evoluzione: BIOS e
					UEFI</h2>
				<div class="grid md:grid-cols-2 gap-8">
					<div
						class="bg-bios-blue p-8 rounded-2xl border-4 border-white/20 shadow-xl relative group overflow-hidden flex flex-col h-full">
						<div
							class="absolute top-0 left-0 w-full h-full bg-white/5 opacity-0 group-hover:opacity-100 transition-opacity pointer-events-none">
						</div>
						<div class="flex-grow">
							<h3 class="text-2xl font-mono font-bold text-white mb-4 flex items-center gap-3">
								<i data-lucide="terminal"></i> BIOS
							</h3>
							<p class="text-white/80 font-mono text-sm leading-relaxed mb-6 text-justify">
								In passato, il firmware di avvio era chiamato <b>BIOS (Basic Input-Output System)</b>. È
								un
								sistema testuale risalente agli anni '70, caratterizzato da schermate blu e controlli
								esclusivamente tramite tastiera.
							</p>
						</div>
						<img src="bios.jpg" alt="BIOS Screenshot"
							class="w-full h-52 object-cover rounded border border-neon-blue/30 mt-auto">
					</div>
					<div
						class="bg-dark-card p-8 rounded-2xl border-4 border-neon-blue/30 shadow-xl relative group overflow-hidden flex flex-col h-full">
						<div
							class="absolute inset-0 bg-gradient-to-br from-neon-blue/5 to-transparent pointer-events-none">
						</div>
						<div class="flex-grow">
							<h3 class="text-2xl font-sans font-bold text-neon-blue mb-4 flex items-center gap-3">
								<i data-lucide="layout"></i> UEFI
							</h3>
							<p class="text-gray-300 leading-relaxed mb-6 text-justify">
								Oggi, nella maggior parte dei computer moderni, è stato sostituito da <b>UEFI (Unified
									Extensible Firmware Interface)</b>, una versione con interfaccia grafica moderna
								e che garantisce maggiore sicurezza.
							</p>
						</div>
						<img src="uefi.jpg" alt="UEFI Screenshot"
							class="w-full h-52 object-cover rounded border border-neon-blue/30 mt-auto">
					</div>
				</div>
			</section>

			<!-- Conclusione Lezione -->
			<div class="flex justify-between mt-12 pt-8 border-t border-white/10">
				<button onclick="navigateTo('lesson-6')"
					class="flex items-center gap-2 text-gray-400 hover:text-white transition-colors">
					<i data-lucide="arrow-left"></i> Precedente: La Memoria RAM
				</button>
				<button onclick="navigateTo('lesson-8')"
					class="flex items-center gap-2 text-neon-teal hover:text-white font-bold transition-colors">
					Prossima: Il BUS <i data-lucide="arrow-right"></i>
				</button>
			</div>
		</div>

		<!-- ================= LESSON 8 VIEW ================= -->
		<div id="lesson-8-view" class="hidden w-full max-w-5xl mx-auto animate-fade-in z-10">
			<!-- Intestazione -->
			<div class="mb-12 border-b border-white/10 pb-6 flex items-center justify-between">
				<div>
					<span class="text-neon-teal font-mono text-sm tracking-widest">LEZIONE 08</span>
					<h1 class="text-4xl md:text-5xl font-bold text-white mt-2">Il BUS</h1>
					<p class="text-gray-400 mt-4 text-lg">La comunicazione all’interno del computer</p>
				</div>
				<div class="hidden md:block text-neon-teal/20 animate-pulse-slow">
					<i data-lucide="network" class="w-24 h-24"></i>
				</div>
			</div>

			<!-- Cos'è il Bus -->
			<section class="mb-16">
				<div
					class="bg-dark-card border border-white/5 rounded-3xl p-8 hover:border-neon-teal/30 transition-all">
					<div class="flex flex-col md:flex-row gap-12 items-center">
						<div class="md:w-3/5 space-y-6">
							<p class="text-gray-300 leading-relaxed text-lg text-justify">
								Il Bus è un componente hardware fondamentale che permette la comunicazione tra
								CPU, memoria RAM e periferiche di input/output. Senza di esso, i vari
								componenti non potrebbero scambiarsi informazioni e il computer non
								funzionerebbe. Dati e istruzioni, rappresentati come sequenze di 0 e 1,
								viaggiano lungo il bus sotto forma di impulsi elettrici: in pratica,
								il bus è l’insieme dei circuiti che rendono possibile lo scambio di
								informazioni tra tutte le parti del sistema.
							</p>
						</div>
						<div
							class="md:w-2/5 bg-gray-900 p-4 rounded-xl border border-white/10 group relative overflow-hidden">
							<img src="bus.jpg" alt="Computer Bus Illustration"
								class="w-full rounded-lg shadow-2xl group-hover:scale-110 transition-transform duration-700">
							<p class="text-center text-[10px] text-gray-500 font-mono mt-4 tracking-widest">
								Le piste che formano il bus</p>
						</div>
					</div>
				</div>
			</section>

			<!-- Tipi di Bus -->
			<section class="mb-16">
				<h2 class="text-3xl font-bold text-white mb-8 border-l-4 border-neon-teal pl-6">Tipi di bus</h2>
				<p class="text-gray-400 mb-8 text-lg">A seconda dei componenti che collegano, si distinguono diversi
					tipi di bus:</p>
				<div class="grid md:grid-cols-2 gap-8">
					<div
						class="bg-dark-lighter p-8 rounded-2xl border-l-4 border-neon-blue space-y-4 hover:bg-white/5 transition-colors">
						<h3 class="text-2xl font-bold text-neon-blue flex items-center gap-3">
							<i data-lucide="cpu"></i> Bus di sistema
						</h3>
						<p class="text-gray-300 leading-relaxed text-justify">
							Collega la CPU alla memoria RAM ed è essenziale per l’esecuzione dei programmi, poiché
							consente alla CPU di leggere istruzioni e dati dalla memoria e di scrivere i risultati delle
							elaborazioni.
						</p>
					</div>
					<div
						class="bg-dark-lighter p-8 rounded-2xl border-l-4 border-neon-purple space-y-4 hover:bg-white/5 transition-colors">
						<h3 class="text-2xl font-bold text-neon-purple flex items-center gap-3">
							<i data-lucide="plug"></i> Bus di espansione
						</h3>
						<p class="text-gray-300 leading-relaxed text-justify">
							Collega il computer alle periferiche e ai dispositivi di input/output
							ed è essenziale per il funzionamento del sistema, poiché permette alla CPU di
							inviare comandi, trasferire dati e ricevere informazioni dallo stato delle periferiche.
						</p>
					</div>
				</div>
			</section>

			<!-- Le linee del bus di sistema -->
			<section class="mb-8">
				<h2 class="text-3xl font-bold text-white mb-8 border-l-4 border-neon-teal pl-6">Le linee del bus di
					sistema</h2>
				<div class="bg-dark-card border border-white/5 rounded-3xl p-8 transition-all">
					<p class="text-gray-300 mb-8 leading-relaxed text-justify">Il bus di sistema non è un canale unico,
						ma è suddiviso in diversi tipi di linee. Ciascuna trasmette impulsi elettrici, ma essi
						rappresentano informazioni diverse:</p>
					<div class="grid md:grid-cols-3 gap-8">
						<div
							class="p-6 bg-white/5 rounded-xl border border-white/10 hover:bg-white/10 transition-colors">
							<h4 class="text-neon-teal font-bold mb-2 flex items-center gap-2">
								<i data-lucide="binary"></i> Linee di dati
							</h4>
							<p class="text-gray-400 text-sm">Trasportano i dati
								e le istruzioni.</p>
						</div>
						<div
							class="p-6 bg-white/5 rounded-xl border border-white/10 hover:bg-white/10 transition-colors">
							<h4 class="text-neon-amber font-bold mb-2 flex items-center gap-2">
								<i data-lucide="map-pin"></i> Linee di indirizzi
							</h4>
							<p class="text-gray-400 text-sm">Trasportano gli indirizzi di memoria che indicano la
								posizione dei
								dati nella memoria RAM, permettendo l'accesso casuale.</p>
						</div>
						<div
							class="p-6 bg-white/5 rounded-xl border border-white/10 hover:bg-white/10 transition-colors">
							<h4 class="text-neon-purple font-bold mb-2 flex items-center gap-2">
								<i data-lucide="settings"></i> Linee di controllo
							</h4>
							<p class="text-gray-400 text-sm">Trasportano segnali speciali che dicono ai componenti cosa
								fare e quando farlo, fungendo da coordinamento.</p>
						</div>
					</div>
					<div class="pt-10 space-y-8">
						<p class="text-gray-300 leading-relaxed text-justify">
							Queste tre tipologie di Bus vengono utilizzate ben distintamente nel processo di
							comunicazione tra
							CPU e RAM, differenziando i momenti di lettura e di scrittura.
						</p>

						<div class="grid md:grid-cols-2 gap-8 mb-2">
							<!-- Lettura -->
							<div
								class="bg-white/5 p-6 rounded-2xl border border-white/10 hover:border-neon-teal/30 transition-colors">
								<h4 class="text-white font-bold mb-4 flex items-center gap-2 text-lg">
									<i data-lucide="book-open" class="w-5 h-5 text-white"></i> Lettura dei dati
									dalla RAM
								</h4>
								<ul class="space-y-3 text-gray-300 text-sm">
									<li class="flex gap-3">
										<div class="w-1.5 h-1.5 rounded-full bg-white mt-1.5 shrink-0"></div>
										<p>La CPU pone sul <span class="text-neon-amber font-bold">bus indirizzi</span>
											l’indirizzo della cella di memoria da leggere.</p>
									</li>
									<li class="flex gap-3">
										<div class="w-1.5 h-1.5 rounded-full bg-white mt-1.5 shrink-0"></div>
										<p>Invia un segnale di lettura tramite le <span
												class="text-neon-purple font-bold">linee di controllo</span>.</p>
									</li>
									<li class="flex gap-3">
										<div class="w-1.5 h-1.5 rounded-full bg-white mt-1.5 shrink-0"></div>
										<p>La RAM legge il dato dall’indirizzo specificato e lo mette sul <span
												class="text-neon-teal font-bold">bus dati</span>.</p>
									</li>
									<li class="flex gap-3">
										<div class="w-1.5 h-1.5 rounded-full bg-white mt-1.5 shrink-0"></div>
										<p>La CPU riceve il dato dal <span class="text-neon-teal font-bold">bus
												dati</span> e lo usa per l’elaborazione.</p>
									</li>
								</ul>
							</div>
							<!-- Scrittura -->
							<div
								class="bg-white/5 p-6 rounded-2xl border border-white/10 hover:border-neon-amber/30 transition-colors">
								<h4 class="text-white font-bold mb-4 flex items-center gap-2 text-lg">
									<i data-lucide="edit-3" class="w-5 h-5 text-white"></i> Scrittura dei dati
									nella RAM
								</h4>
								<ul class="space-y-3 text-gray-300 text-sm">
									<li class="flex gap-3">
										<div class="w-1.5 h-1.5 rounded-full bg-white mt-1.5 shrink-0"></div>
										<p>La CPU pone sul <span class="text-neon-amber font-bold">bus indirizzi</span>
											l’indirizzo della cella di memoria in cui scrivere.</p>
									</li>
									<li class="flex gap-3">
										<div class="w-1.5 h-1.5 rounded-full bg-white mt-1.5 shrink-0"></div>
										<p>Pone invece sul <span class="text-neon-teal font-bold">bus dati</span> il
											valore
											da memorizzare.</p>
									</li>
									<li class="flex gap-3">
										<div class="w-1.5 h-1.5 rounded-full bg-white mt-1.5 shrink-0"></div>
										<p>Invia un segnale di scrittura tramite le <span
												class="text-neon-purple font-bold">linee di controllo</span>.</p>
									</li>
									<li class="flex gap-3">
										<div class="w-1.5 h-1.5 rounded-full bg-white mt-1.5 shrink-0"></div>
										<p>La RAM salva il dato dalla <span class="text-neon-teal font-bold">linea
												dati</span> nella cella specificata.</p>
									</li>
								</ul>
							</div>
						</div>

						<div class="pt-0">

							<div class="relative p-0">
								<!-- Interfaccia Animazione -->
								<div class="flex justify-between items-center mb-4 relative">
									<!-- CPU -->
									<div class="z-10 group">
										<div
											class="w-24 h-24 md:w-32 md:h-32 bg-dark-lighter border-2 border-neon-blue rounded-2xl flex flex-col items-center justify-center shadow-[0_0_30px_rgba(0,243,255,0.1)] group-hover:border-neon-blue transition-all">
											<i data-lucide="cpu" class="text-neon-blue w-10 h-10 mb-2"></i>
											<span class="text-white font-bold text-xs">CPU</span>
											<div id="cpu-status"
												class="mt-2 text-[9px] text-neon-blue/60 font-mono uppercase tracking-tighter text-center leading-tight px-1">
												Attesa...</div>
										</div>
									</div>

									<!-- BUS AREA -->
									<div
										class="absolute left-32 right-[148px] top-1/2 -translate-y-1/2 flex flex-col justify-center space-y-8">
										<!-- Address Bus -->
										<div class="relative">
											<div
												class="flex justify-between text-[10px] font-mono text-neon-amber mb-1 uppercase tracking-widest px-8 md:px-24">
												<span>Bus Indirizzi</span>
												<span id="addr-bus-status">Inattivo</span>
											</div>
											<div id="addr-wire" class="bus-wire">
												<div id="packet-addr" class="data-packet packet-addr">0x0000</div>
											</div>
										</div>

										<!-- Data Bus -->
										<div class="relative">
											<div
												class="flex justify-between text-[10px] font-mono text-neon-teal mb-1 uppercase tracking-widest px-8 md:px-24">
												<span>Bus Dati</span>
												<span id="data-bus-status">Inattivo</span>
											</div>
											<div id="data-wire" class="bus-wire">
												<div id="packet-data" class="data-packet packet-data">00000000</div>
											</div>
										</div>

										<!-- Control Bus -->
										<div class="relative">
											<div
												class="flex justify-between text-[10px] font-mono text-neon-purple mb-1 uppercase tracking-widest px-8 md:px-24">
												<span>Bus Controllo</span>
												<span id="control-bus-status">Inattivo</span>
											</div>
											<div id="control-wire" class="bus-wire">
												<div id="packet-control" class="data-packet packet-control">READ</div>
											</div>
										</div>
									</div>

									<!-- RAM (MEMORY STACK) -->
									<div class="z-10 group flex flex-col items-center">
										<div
											class="w-full bg-dark-lighter px-4 py-1 border border-neon-amber/30 rounded-t-lg border-b-0 text-center">
											<span class="text-white font-bold text-[9px] uppercase tracking-widest">RAM
												Module</span>
										</div>
										<div id="bus-mem-stack"
											class="memory-stack mb-2 shadow-[0_0_20px_rgba(251,191,36,0.1)] group-hover:border-neon-amber transition-all rounded-t-none">
											<!-- Cells will be generated by JS, but here are some for initial view -->
											<div class="stack-cell" id="cell-0x07">
												<div class="stack-cell-addr">0x07</div>
												<div class="stack-cell-data">10100111</div>
											</div>
											<div class="stack-cell" id="cell-0x06">
												<div class="stack-cell-addr">0x06</div>
												<div class="stack-cell-data">00110011</div>
											</div>
											<div class="stack-cell shadow-[inset_0_0_10px_rgba(251,191,36,0.1)]"
												id="cell-0x05">
												<div class="stack-cell-addr">0x05</div>
												<div class="stack-cell-data">11110000</div>
											</div>
											<div class="stack-cell" id="cell-0x04">
												<div class="stack-cell-addr">0x04</div>
												<div class="stack-cell-data">00001111</div>
											</div>
											<div class="stack-cell" id="cell-0x03">
												<div class="stack-cell-addr">0x03</div>
												<div class="stack-cell-data">10110010</div>
											</div>
											<div class="stack-cell" id="cell-0x02">
												<div class="stack-cell-addr">0x02</div>
												<div class="stack-cell-data">01010101</div>
											</div>
											<div class="stack-cell" id="cell-0x01">
												<div class="stack-cell-addr">0x01</div>
												<div class="stack-cell-data">11001100</div>
											</div>
											<div class="stack-cell" id="cell-0x00">
												<div class="stack-cell-addr">0x00</div>
												<div class="stack-cell-data">01101001</div>
											</div>
										</div>
										<div id="ram-status"
											class="text-[9px] text-neon-amber/60 font-mono tracking-tighter text-center leading-tight px-1">
											Pronta</div>
									</div>
								</div>

								<!-- Controlli -->
								<div class="flex flex-col items-center gap-2">
									<div class="flex flex-wrap justify-center gap-6">
										<button id="start-bus-read" onclick="runBusCycle('read')"
											class="px-5 py-2 bg-transparent border border-neon-teal/30 text-neon-teal/80 rounded-lg text-xs font-bold hover:bg-neon-teal/10 hover:border-neon-teal hover:text-white transition-all flex items-center gap-2 group min-w-[140px] justify-center uppercase tracking-wider">
											<i data-lucide="eye" class="w-4 h-4"></i> Lettura
										</button>
										<button id="start-bus-write" onclick="runBusCycle('write')"
											class="px-5 py-2 bg-transparent border border-neon-amber/30 text-neon-amber/80 rounded-lg text-xs font-bold hover:bg-neon-amber/10 hover:border-neon-amber hover:text-white transition-all flex items-center gap-2 group min-w-[140px] justify-center uppercase tracking-wider">
											<i data-lucide="edit-3" class="w-4 h-4"></i> Scrittura
										</button>
									</div>
									<p id="bus-sim-log"
										class="text-white font-mono text-[10px] md:text-xs font-bold text-center w-full max-w-md h-16 flex items-center justify-center bg-black/40 px-4 py-2 rounded-lg border border-white/10 shadow-[0_0_10px_rgba(255,255,255,0.05)]">
										In attesa di input...</p>
								</div>
							</div>
						</div>
			</section>

			<!-- Prestazioni del bus -->
			<section class="mb-8">
				<h2 class="text-3xl font-bold text-white mb-8 border-l-4 border-neon-teal pl-6">Come si misurano le
					prestazioni del bus</h2>
				<div class="bg-gradient-to-br from-dark-lighter to-dark-bg p-8 rounded-3xl border border-white/10">
					<div class="space-y-8 mb-4">
						<p class="text-gray-300 leading-relaxed text-lg text-justify w-full">
							Le prestazioni di un bus si valutano principalmente attraverso due caratteristiche
							fondamentali:
							l'ampiezza e la velocità. A partire da queste due caratteristiche, si può calcolare
							la capacità di trasferimento di dati (Throughput).
						</p>
						<div class="grid md:grid-cols-3 gap-6">
							<div
								class="p-6 bg-white/5 rounded-2xl border-l-4 border-neon-teal hover:bg-white/10 transition-colors">
								<h4 class="text-white font-bold mb-2 flex items-center gap-2">
									<i data-lucide="expand" class="w-4 h-4 text-neon-teal"></i> Ampiezza
								</h4>
								<p class="text-gray-400 text-sm">Indica il numero di bit trasferiti in una singola
									trasmissione (tipicamente la lunghezza della parola).</p>
							</div>
							<div
								class="p-6 bg-white/5 rounded-2xl border-l-4 border-neon-teal hover:bg-white/10 transition-colors">
								<h4 class="text-white font-bold mb-2 flex items-center gap-2">
									<i data-lucide="zap" class="w-4 h-4 text-neon-teal"></i> Velocità
								</h4>
								<p class="text-gray-400 text-sm">Indica il numero di trasferimenti svolti in un secondo,
									misurata in Hertz (Hz).</p>
							</div>
							<div
								class="p-6 bg-white/5 rounded-2xl border-l-4 border-neon-teal hover:bg-white/10 transition-colors">
								<h4 class="text-white font-bold mb-2 flex items-center gap-2">
									<i data-lucide="activity" class="w-4 h-4 text-neon-teal"></i> Throughput
								</h4>
								<p class="text-gray-400 text-sm">La banda complessiva, calcolata come il prodotto tra
									ampiezza e velocità.</p>
							</div>
						</div>
					</div>

					<div class="mt-2 space-y-8">
						<div class="space-y-4">
							<div class="text-neon-teal font-mono tracking-wide text-base font-bold">
								I PC moderni hanno:
							</div>
							<div
								class="grid md:grid-cols-3 divide-x divide-white/20 text-neon-teal font-mono tracking-wide text-sm">
								<div class="text-justify px-6">
									Un'ampiezza del bus di 64 bit.
								</div>
								<div class="text-justify px-6">
									Una velocità per i bus di sistema tra 2 e 8 GHz, mentre i bus di espansione tra 1 e
									4 GHz.
								</div>
								<div class="text-justify px-6">
									Un throughput per i bus di sistema tra 16 e 64 GB/s, mentre per i bus di espansione
									tra 8 e 32 GB/s.
								</div>
							</div>
						</div>
						<div
							class="bg-neon-red/10 border border-neon-red/30 p-5 rounded-2xl text-justify text-base flex flex-col lg:flex-row items-center gap-8">
							<div class="flex-1 text-gray-200 leading-relaxed">
								Il bus rappresenta un possibile <b>collo di bottiglia</b> (bottleneck): anche se la
								CPU
								e la RAM sono estremamente veloci, un bus con ampiezza o velocità limitata può
								strozzare
								il flusso di dati, limitando drasticamente le prestazioni complessive dell'intero
								computer.
							</div>
							<!-- Schema Collo di Bottiglia Ottimizzato -->
							<div
								class="relative w-64 h-32 shrink-0 bg-black/40 rounded-xl border border-white/10 p-1 overflow-hidden shadow-2xl">
								<svg viewBox="0 0 200 100" class="w-full h-full">
									<!-- Bottiglia/Condotto -->
									<path d="M10,20 L80,20 L120,40 L190,40 L190,60 L120,60 L80,80 L10,80 Z" fill="none"
										stroke="rgba(239, 68, 68, 0.6)" stroke-width="3" />

									<!-- Pacchetti entranti -->
									<g class="animate-pulse">
										<rect x="20" y="30" width="12" height="8" fill="#fbbf24" rx="1" />
										<rect x="45" y="45" width="12" height="8" fill="#fbbf24" rx="1" />
										<rect x="25" y="65" width="12" height="8" fill="#fbbf24" rx="1" />
										<rect x="60" y="35" width="12" height="8" fill="#fbbf24" rx="1" />
										<rect x="55" y="70" width="12" height="8" fill="#fbbf24" rx="1" />
									</g>

									<!-- Strizzatura -->
									<line x1="80" y1="20" x2="120" y2="40" stroke="#ef4444" stroke-width="1.5"
										stroke-dasharray="3,3" />
									<line x1="80" y1="80" x2="120" y2="60" stroke="#ef4444" stroke-width="1.5"
										stroke-dasharray="3,3" />

									<!-- Pacchetti uscenti -->
									<rect x="150" y="46" width="14" height="8" fill="#ef4444" rx="1">
										<animate attributeName="x" from="120" to="180" dur="2.5s"
											repeatCount="indefinite" />
										<animate attributeName="opacity" values="0;1;0" dur="2.5s"
											repeatCount="indefinite" />
									</rect>
								</svg>
							</div>
						</div>
					</div>


				</div>
			</section>

			<!-- Conclusione Lezione -->
			<div class="flex justify-between mt-12 pt-8 border-t border-white/10">
				<button onclick="navigateTo('lesson-7')"
					class="flex items-center gap-2 text-gray-400 hover:text-white transition-colors">
					<i data-lucide="arrow-left"></i> Precedente: La Memoria ROM
				</button>
				<button onclick="navigateTo('lesson-9')"
					class="flex items-center gap-2 text-neon-amber hover:text-white font-bold transition-colors">
					Prossima: Memorie di Massa <i data-lucide="arrow-right"></i>
				</button>
			</div>
		</div>

		<!-- ================= LESSON 9 VIEW ================= -->
		<div id="lesson-9-view" class="hidden w-full max-w-5xl mx-auto animate-fade-in z-10">
			<div class="flex flex-col items-center justify-center py-20 text-center space-y-8">
				<div class="relative">
					<div class="w-32 h-32 bg-neon-amber/20 rounded-full flex items-center justify-center animate-pulse">
						<i data-lucide="hard-drive" class="w-16 h-16 text-neon-amber"></i>
					</div>
					<i data-lucide="hammer"
						class="absolute -top-2 -right-2 w-12 h-12 text-gray-500 animate-spin-slow"></i>
					<i data-lucide="settings-2"
						class="absolute -bottom-2 -left-2 w-10 h-10 text-gray-600 animate-spin-reverse"></i>
				</div>
				<div>
					<span class="text-neon-amber font-mono text-sm tracking-widest uppercase mb-2 block">Lezione
						09</span>
					<h1 class="text-4xl md:text-6xl font-bold text-white mb-4">Lavori in Corso</h1>
					<p class="text-gray-400 text-lg md:text-xl max-w-md mx-auto leading-relaxed">
						Stiamo installando i dischi delle <strong class="text-neon-amber">Memorie di Massa</strong>.
						<br>
						Questa sezione sarà disponibile a breve con schemi interattivi su Hard Disk e SSD.
					</p>
				</div>
				<div
					class="w-full h-2 bg-gray-800 rounded-full overflow-hidden max-w-sm mx-auto border border-gray-700">
					<div
						class="h-full bg-[repeating-linear-gradient(45deg,#ffbf00,#ffbf00_10px,#cc9900_10px,#cc9900_20px)] animate-flow w-[200%]">
					</div>
				</div>
			</div>
			<div class="flex justify-between w-full mt-12 pt-8 border-t border-white/10">
				<button onclick="navigateTo('lesson-8')"
					class="flex items-center gap-2 text-gray-400 hover:text-white transition-colors">
					<i data-lucide="arrow-left"></i> Precedente: Il Bus
				</button>
				<button onclick="navigateTo('lesson-10')"
					class="flex items-center gap-2 text-neon-pink hover:text-white font-bold transition-colors">
					Prossima: Periferiche e Porte <i data-lucide="arrow-right"></i>
				</button>
			</div>
		</div>

		<!-- ================= LESSON 10 VIEW ================= -->
		<div id="lesson-10-view" class="hidden w-full max-w-5xl mx-auto animate-fade-in z-10">
			<div class="flex flex-col items-center justify-center py-20 text-center space-y-8">
				<div class="relative">
					<div class="w-32 h-32 bg-neon-pink/20 rounded-full flex items-center justify-center animate-pulse">
						<i data-lucide="usb" class="w-16 h-16 text-neon-pink"></i>
					</div>
					<i data-lucide="hammer"
						class="absolute -top-2 -right-2 w-12 h-12 text-gray-500 animate-spin-slow"></i>
					<i data-lucide="settings-2"
						class="absolute -bottom-2 -left-2 w-10 h-10 text-gray-600 animate-spin-reverse"></i>
				</div>
				<div>
					<span class="text-neon-pink font-mono text-sm tracking-widest uppercase mb-2 block">Lezione
						10</span>
					<h1 class="text-4xl md:text-6xl font-bold text-white mb-4">Lavori in Corso</h1>
					<p class="text-gray-400 text-lg md:text-xl max-w-md mx-auto leading-relaxed">
						Stiamo collegando i cavi di <strong class="text-neon-pink">Periferiche e Porte</strong>. <br>
						Questa sezione sarà disponibile a breve con dettagli su USB, HDMI e periferiche I/O.
					</p>
				</div>
				<div
					class="w-full h-2 bg-gray-800 rounded-full overflow-hidden max-w-sm mx-auto border border-gray-700">
					<div
						class="h-full bg-[repeating-linear-gradient(45deg,#ff0099,#ff0099_10px,#cc007a_10px,#cc007a_20px)] animate-flow w-[200%]">
					</div>
				</div>
			</div>
			<div class="flex justify-between w-full mt-12 pt-8 border-t border-white/10">
				<button onclick="navigateTo('lesson-9')"
					class="flex items-center gap-2 text-gray-400 hover:text-white transition-colors">
					<i data-lucide="arrow-left"></i> Precedente: Memorie di Massa
				</button>
				<div class="w-32"></div>
			</div>
		</div>
	</main>
	<!-- Footer -->
	<footer class="w-full py-6 text-center border-t border-white/5 bg-dark-bg z-10 mt-auto">
		<p class="text-gray-600 text-sm font-mono">Prof. Patrick Militello &copy; | IIS Altiero Spinelli | Powered by
			Gemini | <span id="year"></span></p>
	</footer>
	<script>
		// Inizializza Icone
		lucide.createIcons();
		document.getElementById('year').textContent = new Date().getFullYear();

		// Menu Logic
		const menuBtn = document.getElementById('menu-btn');
		const closeBtn = document.getElementById('close-btn');
		const sidebar = document.getElementById('sidebar');
		const overlay = document.getElementById('overlay');

		function openMenu() {
			sidebar.classList.remove('translate-x-full');
			overlay.classList.remove('hidden');
			setTimeout(() => overlay.classList.remove('opacity-0'), 10);
		}

		function closeMenu() {
			sidebar.classList.add('translate-x-full');
			overlay.classList.add('opacity-0');
			setTimeout(() => overlay.classList.add('hidden'), 300);
		}

		if (menuBtn) menuBtn.addEventListener('click', openMenu);
		if (closeBtn) closeBtn.addEventListener('click', closeMenu);
		if (overlay) overlay.addEventListener('click', closeMenu);

		// Navigation Logic
		function navigateTo(viewId) {
			// Nascondi tutto
			document.getElementById('home-view').classList.add('hidden');

			// Nascondi tutte le lezioni (Loop dinamico fino a 10)
			for (let i = 1; i <= 10; i++) {
				const el = document.getElementById('lesson-' + i + '-view');
				if (el) el.classList.add('hidden');
			}

			// Mostra target
			const target = document.getElementById(viewId + '-view');
			if (target) {
				target.classList.remove('hidden');
			}

			// Chiudi menu se aperto
			closeMenu();

			// Scroll to top
			window.scrollTo(0, 0);

			// Re-inizializza icone
			lucide.createIcons();

			// FIX: Animazioni per specifiche lezioni
			if (viewId === 'lesson-2') {
				setTimeout(updateVisuals, 100);
			}
			if (viewId === 'lesson-4') {
				setTimeout(updateFetchVisuals, 100);
			}
			if (viewId === 'lesson-5') {
				setTimeout(initRace, 100);
			}
			if (viewId === 'lesson-6') {
				setTimeout(initRamLesson, 100);
				setTimeout(initAccessSim, 100);
				setTimeout(initRefreshSim, 100);
				setTimeout(initMatrixSim, 100);
			}
			if (viewId === 'lesson-7') {
				const term = document.getElementById('boot-terminal');
				const btn = document.getElementById('boot-btn');
				if (term) term.innerHTML = '<div class="opacity-50 italic mb-2">// Premere il tasto di accensione</div>';
				if (btn) {
					btn.innerHTML = '<i data-lucide="power" class="w-4 h-4"></i> ACCENDI PC';
					btn.disabled = false;
					btn.classList.remove('opacity-50', 'cursor-not-allowed');
				}
				lucide.createIcons();
			}
			if (viewId === 'lesson-8') {
				// Bus lesson specific init if needed
			}
		}



		let isBusSimRunning = false;
		function runBusCycle(mode = 'read') {
			if (isBusSimRunning) return;
			isBusSimRunning = true;

			const btnRead = document.getElementById('start-bus-read');
			const btnWrite = document.getElementById('start-bus-write');
			const log = document.getElementById('bus-sim-log');
			const cpuStatus = document.getElementById('cpu-status');
			const ramStatus = document.getElementById('ram-status');
			const addrWire = document.getElementById('addr-wire');
			const dataWire = document.getElementById('data-wire');
			const pAddr = document.getElementById('packet-addr');
			const pData = document.getElementById('packet-data');
			const pControl = document.getElementById('packet-control');
			const addrBusStatus = document.getElementById('addr-bus-status');
			const dataBusStatus = document.getElementById('data-bus-status');
			const controlBusStatus = document.getElementById('control-bus-status');
			const controlWire = document.getElementById('control-wire');

			const buttons = [btnRead, btnWrite];
			buttons.forEach(btn => {
				btn.disabled = true;
				btn.classList.add('opacity-50', 'cursor-not-allowed');
			});

			// Reset visuals
			pAddr.style.opacity = '0';
			pData.style.opacity = '0';
			pControl.style.opacity = '0';
			pAddr.classList.remove('animate-flow-lr', 'animate-flow-rl');
			pData.classList.remove('animate-flow-lr', 'animate-flow-rl');
			pControl.classList.remove('animate-flow-lr', 'animate-flow-rl');
			addrWire.classList.remove('bus-wire-active-addr');
			dataWire.classList.remove('bus-wire-active-data');
			controlWire.classList.remove('bus-wire-active-control');

			// Remove previous highlights
			document.querySelectorAll('.stack-cell').forEach(c => c.classList.remove('active-ram-cell'));

			const addrValue = Math.floor(Math.random() * 8);
			const addressStr = "0x0" + addrValue;
			const targetCell = document.getElementById('cell-' + addressStr);
			const targetDataEl = targetCell.querySelector('.stack-cell-data');

			const dataVal = Math.floor(Math.random() * 256).toString(2).padStart(8, '0');
			const existingData = targetDataEl.textContent;

			if (mode === 'read') {
				// READ SEQUENCE
				log.textContent = "Inizio operazione di LETTURA...";
				cpuStatus.textContent = "Inizio Lettura";

				setTimeout(() => {
					log.textContent = "La CPU pone l'indirizzo sul bus indirizzi e invia un segnale di lettura tramite le linee di controllo.";
					addrBusStatus.textContent = "ATTIVO (Indirizzo)";
					controlBusStatus.textContent = "ATTIVO (Read)";
					addrWire.classList.add('bus-wire-active-addr');
					controlWire.classList.add('bus-wire-active-control');
					pAddr.textContent = addressStr;
					pControl.textContent = "READ";
					pAddr.classList.add('animate-flow-lr');
					pControl.classList.add('animate-flow-lr');

					setTimeout(() => {
						log.textContent = "La RAM riceve l'indirizzo e inizia la ricerca...";
						ramStatus.textContent = "Ricerca Cella...";
						addrWire.classList.remove('bus-wire-active-addr');
						controlWire.classList.remove('bus-wire-active-control');
						addrBusStatus.textContent = "Inattivo";
						controlBusStatus.textContent = "Inattivo";

						setTimeout(() => {
							// Highlight target cell
							targetCell.classList.add('active-ram-cell');
							ramStatus.textContent = "Cella Trovata!";

							setTimeout(() => {
								log.textContent = "La RAM legge il dato dall’indirizzo specificato sul bus indirizzi e lo mette sul bus dati.";
								dataBusStatus.textContent = "ATTIVO (Dati)";
								dataWire.classList.add('bus-wire-active-data');
								pData.textContent = existingData;
								pData.classList.add('animate-flow-rl');

								setTimeout(() => {
									log.textContent = "La CPU riceve il dato dal bus dati e lo usa per l’elaborazione.";
									cpuStatus.textContent = "Dato ricevuto!";
									dataBusStatus.textContent = "Inattivo";
									dataWire.classList.remove('bus-wire-active-data');

									setTimeout(() => {
										targetCell.classList.remove('active-ram-cell');
										finish();
									}, 2000);
								}, 4000);
							}, 1500);
						}, 2000);
					}, 3000);
				}, 1000);
			} else {
				// WRITE SEQUENCE
				log.textContent = "Inizio operazione di SCRITTURA...";
				cpuStatus.textContent = "Inizio Scrittura";

				setTimeout(() => {
					log.textContent = "La CPU pone l'indirizzo sul bus indirizzi, il dato sul bus dati e invia il segnale di scrittura tramite le linee di controllo.";
					addrBusStatus.textContent = "ATTIVO (Indirizzo)";
					dataBusStatus.textContent = "ATTIVO (Dati)";
					controlBusStatus.textContent = "ATTIVO (Write)";
					addrWire.classList.add('bus-wire-active-addr');
					dataWire.classList.add('bus-wire-active-data');
					controlWire.classList.add('bus-wire-active-control');

					pAddr.textContent = addressStr;
					pData.textContent = dataVal;
					pControl.textContent = "WRITE";
					pAddr.classList.add('animate-flow-lr');
					pData.classList.add('animate-flow-lr');
					pControl.classList.add('animate-flow-lr');

					setTimeout(() => {
						log.textContent = "La RAM salva il dato dal bus dati nella cella specificata dal bus indirizzi.";
						ramStatus.textContent = "Salvataggio...";
						addrWire.classList.remove('bus-wire-active-addr');
						dataWire.classList.remove('bus-wire-active-data');
						controlWire.classList.remove('bus-wire-active-control');
						addrBusStatus.textContent = "Inattivo";
						dataBusStatus.textContent = "Inattivo";
						controlBusStatus.textContent = "Inattivo";

						setTimeout(() => {
							// Highlight and update cell
							targetCell.classList.add('active-ram-cell');

							setTimeout(() => {
								targetDataEl.textContent = dataVal;
								targetDataEl.classList.add('text-white', 'scale-110');
								ramStatus.textContent = "Dato Salvato!";
								cpuStatus.textContent = "OK!";

								setTimeout(() => {
									targetDataEl.classList.remove('text-white', 'scale-110');
									targetCell.classList.remove('active-ram-cell');
									finish();
								}, 2000);
							}, 2000);
						}, 1000);
					}, 4000);
				}, 1000);
			}

			function finish() {
				log.textContent = "Operazione completata.";
				cpuStatus.textContent = "Attesa...";
				ramStatus.textContent = "Pronta";
				buttons.forEach(btn => {
					btn.disabled = false;
					btn.classList.remove('opacity-50', 'cursor-not-allowed');
				});
				isBusSimRunning = false;
			}
		}

		/* --- LOGICA LEZIONE 7 (ROM/BOOT) --- */
		function startBootSequence() {
			const term = document.getElementById('boot-terminal');
			const btn = document.getElementById('boot-btn');
			if (!term || !btn) return;

			btn.disabled = true;
			btn.classList.add('opacity-50', 'cursor-not-allowed');
			term.innerHTML = '';

			const messages = [
				{ text: "> UEFI Firmware Version 4.2.0", delay: 300 },
				{ text: "> CPU: Intel(R) Core(TM) i7 initialized [OK]", delay: 600 },
				{ text: "> RAM: 16384 MB detected and tested [OK]", delay: 500 },
				{ text: "> Checking storage devices...", delay: 800 },
				{ text: "> Found bootable device: SSD (SATA 0) [OK]", delay: 400 },
				{ text: "> Loading Bootstrap Loader...", delay: 600 },
				{ text: "> Identifying System Partition...", delay: 400 },
				{ text: "> Jumping to entry point at 0x7C00...", delay: 700 },
				{ text: "> Loading OS Kernel into RAM...", delay: 900 },
				{ text: "> Handing control to Operating System...", delay: 800 },
				{ text: "------------------------------------", delay: 200 },
				{ text: "SYSTEM BOOT COMPLETED SUCCESSFULLY", delay: 200, color: '#00ff9d' },
			];

			let i = 0;
			function typeMessage() {
				if (i < messages.length) {
					const msg = messages[i];
					const div = document.createElement('div');
					div.textContent = msg.text;
					if (msg.color) div.style.color = msg.color;
					div.className = "mb-1";
					term.appendChild(div);
					term.scrollTop = term.scrollHeight;
					i++;
					setTimeout(typeMessage, msg.delay);
				} else {
					btn.disabled = false;
					btn.classList.remove('opacity-50', 'cursor-not-allowed');
					btn.innerHTML = '<i data-lucide="refresh-cw" class="w-4 h-4"></i> RIAVVIA PC';
					lucide.createIcons();
				}
			}
			setTimeout(typeMessage, 200);
		}

		const styleSheet = document.createElement("style");
		styleSheet.innerText = `
			    @keyframes shimmer {
			        0% { transform: translateX(-100%); }
			        100% { transform: translateX(400%); }
			    }
			    .font-handwriting {
			        font-family: 'Courier New', Courier, monospace; 
			    }
			`;
		document.head.appendChild(styleSheet);

		/* --- LOGICA LEZIONE 2 --- */
		let currentStep = 0;
		const dataGroup = document.getElementById('data-group');
		const stepDesc = document.getElementById('step-desc');
		const btnPrev = document.getElementById('btn-prev');
		const btnNext = document.getElementById('btn-next');

		function renderData(step) {
			if (!dataGroup) return;
			if (step < 3) {
				dataGroup.innerHTML = `
			            <div class="w-10 h-10 bg-white text-black font-bold font-mono flex items-center justify-center rounded shadow-lg border-2 border-green-500">3</div>
			            <div class="w-10 h-10 bg-gray-800 text-white font-bold font-mono flex items-center justify-center rounded shadow-lg border-2 border-gray-500">+</div>
			            <div class="w-10 h-10 bg-white text-black font-bold font-mono flex items-center justify-center rounded shadow-lg border-2 border-green-500">5</div>
			        `;
			} else {
				dataGroup.innerHTML = `
			            <div class="w-12 h-12 bg-cyan-400 text-black font-bold font-mono flex items-center justify-center rounded-full shadow-[0_0_20px_rgba(0,243,255,0.8)] border-2 border-white animate-pulse">8</div>
			        `;
			}
		}

		function getTargetCoordinates(targetId) {
			const container = document.getElementById('vn-diagram');
			const target = document.getElementById(targetId);

			if (!container || !target) return { left: '50%', top: '50%' };

			const containerRect = container.getBoundingClientRect();
			const targetRect = target.getBoundingClientRect();

			const relativeLeft = targetRect.left - containerRect.left + (targetRect.width / 2);
			const relativeTop = targetRect.top - containerRect.top + (targetRect.height / 2);

			return { left: relativeLeft + 'px', top: relativeTop + 'px' };
		}

		function updateVisuals() {
			if (!document.getElementById('vn-diagram')) return;

			renderData(currentStep);
			if (dataGroup) {
				dataGroup.style.opacity = '1';
				dataGroup.style.transform = 'translate(-50%, -50%)';
			}

			let targetId = '';
			let extraTransform = '';

			switch (currentStep) {
				case 0:
					targetId = 'input-target';
					if (stepDesc) { stepDesc.textContent = "1: Inserimento dati (3 + 5)"; stepDesc.className = "font-mono text-green-400 text-sm font-bold truncate px-2"; }
					break;
				case 1:
					targetId = 'ram-target';
					if (stepDesc) { stepDesc.textContent = "2: Trasferimento in RAM"; stepDesc.className = "font-mono text-purple-400 text-sm font-bold truncate px-2"; }
					break;
				case 2:
					targetId = 'cpu-target';
					if (stepDesc) { stepDesc.textContent = "3: Prelievo della CPU"; stepDesc.className = "font-mono text-cyan-400 text-sm font-bold truncate px-2"; }
					break;
				case 3:
					targetId = 'cpu-target';
					extraTransform = 'scale(1.2)';
					if (stepDesc) { stepDesc.textContent = "4: Elaborazione (3 + 5 = 8)"; stepDesc.className = "font-mono text-cyan-500 text-sm font-bold truncate px-2"; }
					break;
				case 4:
					targetId = 'ram-target';
					if (stepDesc) { stepDesc.textContent = "5: Salvataggio in RAM"; stepDesc.className = "font-mono text-purple-400 text-sm font-bold truncate px-2"; }
					break;
				case 5:
					targetId = 'output-target';
					if (stepDesc) { stepDesc.textContent = "6: Scrittura dei dati"; stepDesc.className = "font-mono text-red-400 text-sm font-bold truncate px-2"; }
					break;
			}

			if (targetId && dataGroup) {
				const coords = getTargetCoordinates(targetId);
				dataGroup.style.left = coords.left;
				dataGroup.style.top = coords.top;
				dataGroup.style.bottom = 'auto';
				if (extraTransform) dataGroup.style.transform = `translate(-50%, -50%) ${extraTransform}`;
			}

			if (btnPrev) btnPrev.disabled = currentStep === 0;
			if (btnNext) btnNext.disabled = currentStep === 5;
		}

		function nextStep() {
			if (currentStep < 5) {
				currentStep++;
				updateVisuals();
			}
		}

		function prevStep() {
			if (currentStep > 0) {
				currentStep--;
				updateVisuals();
			}
		}

		/* --- LOGICA LEZIONE 4 (FETCH CYCLE) --- */
		let fetchStep = 0;
		const fToken = document.getElementById('f-token');
		const fDesc = document.getElementById('fetch-desc');
		const btnFPrev = document.getElementById('btn-f-prev');
		const btnFNext = document.getElementById('btn-f-next');

		// Helper per coordinate Lezione 4
		function getFetchCoords(elementId) {
			const container = document.getElementById('fetch-diagram');
			const el = document.getElementById(elementId);
			if (!container || !el) return { left: '50%', top: '50%' };

			const cRect = container.getBoundingClientRect();
			const eRect = el.getBoundingClientRect();

			return {
				left: (eRect.left - cRect.left + eRect.width / 2) + 'px',
				top: (eRect.top - cRect.top + eRect.height / 2) + 'px'
			};
		}

		function resetFetchHighlights() {
			const ids = ['f-ram', 'f-mem-cell', 'f-cu', 'f-alu', 'f-reg', 'f-ram-result', 'f-mem-data1', 'f-mem-data2', 'f-mem-instr'];
			ids.forEach(id => {
				const el = document.getElementById(id);
				if (el) {
					el.classList.remove('ring-2', 'ring-white/60', 'shadow-[0_0_15px_rgba(255,255,255,0.2)]', 'scale-105');
					el.style.zIndex = '0';
				}
			});
		}

		function highlightFetch(id) {
			const el = document.getElementById(id);
			if (el) {
				// Glow meno intenso
				el.classList.add('ring-2', 'ring-white/60', 'shadow-[0_0_15px_rgba(255,255,255,0.2)]', 'scale-105');
				el.style.zIndex = '10';
			}
		}

		function updateFetchVisuals() {
			if (!document.getElementById('fetch-diagram')) return;

			const tokenInstr = document.getElementById('f-token-instr');
			const tokenData1 = document.getElementById('f-token-data1');
			const tokenData2 = document.getElementById('f-token-data2');
			const tokenResult = document.getElementById('f-token-result');
			const desc = document.getElementById('fetch-desc');
			const prevBtn = document.getElementById('btn-f-prev');
			const nextBtn = document.getElementById('btn-f-next');
			const resultCell = document.getElementById('f-ram-result');

			if (!tokenInstr) return;

			resetFetchHighlights();

			// Gestione Visibilità Token Iniziale
			tokenInstr.style.display = 'none';
			tokenData1.style.display = 'none';
			tokenData2.style.display = 'none';
			tokenResult.style.display = 'none';

			// Reset della cella risultato se non siamo all'ultimo step
			if (fetchStep < 4 && resultCell) {
				resultCell.innerHTML = '';
				resultCell.className = "w-full h-10 bg-gray-800/50 border border-gray-700 rounded flex items-center justify-between px-4 text-gray-400 text-sm font-mono opacity-50 transition-all duration-500";
			}

			switch (fetchStep) {
				case 0: // START: Tutti i token in RAM
					tokenInstr.style.display = 'flex';
					tokenData1.style.display = 'flex';
					tokenData2.style.display = 'flex';

					highlightFetch('f-ram');
					highlightFetch('f-mem-instr');
					highlightFetch('f-mem-data1');
					highlightFetch('f-mem-data2');

					const coordsInstr0 = getFetchCoords('f-mem-instr');
					tokenInstr.style.left = coordsInstr0.left;
					tokenInstr.style.top = coordsInstr0.top;
					tokenInstr.style.transform = 'translate(-50%, -50%)';

					const coordsData1_0 = getFetchCoords('f-mem-data1');
					tokenData1.style.left = coordsData1_0.left;
					tokenData1.style.top = coordsData1_0.top;
					tokenData1.style.transform = 'translate(-50%, -50%)';

					const coordsData2_0 = getFetchCoords('f-mem-data2');
					tokenData2.style.left = coordsData2_0.left;
					tokenData2.style.top = coordsData2_0.top;
					tokenData2.style.transform = 'translate(-50%, -50%)';

					if (desc) {
						desc.textContent = "Inizio: istruzione (somma) e dati (3 e 5) presenti in RAM";
						desc.className = "font-mono text-white-400 text-xs font-bold px-2";
					}
					break;

				case 1: // FETCH: Tutti i token vanno nei Registri
					tokenInstr.style.display = 'flex';
					tokenData1.style.display = 'flex';
					tokenData2.style.display = 'flex';

					highlightFetch('f-reg');

					const coordsReg = getFetchCoords('f-reg');

					// Li mettiamo vicini nei registri
					tokenInstr.style.left = coordsReg.left;
					tokenInstr.style.top = coordsReg.top;
					tokenInstr.style.transform = 'translate(-150%, -50%)';

					tokenData1.style.left = coordsReg.left;
					tokenData1.style.top = coordsReg.top;
					tokenData1.style.transform = 'translate(-50%, -50%)';

					tokenData2.style.left = coordsReg.left;
					tokenData2.style.top = coordsReg.top;
					tokenData2.style.transform = 'translate(50%, -50%)';

					if (desc) {
						desc.textContent = "1 - FETCH: Dati e istruzioni vengono caricati nei Registri della CPU";
						desc.className = "font-mono text-blue-400 text-xs font-bold px-2";
					}
					break;

				case 2: // DECODE: Instr -> CU, Data -> ALU
					tokenInstr.style.display = 'flex';
					tokenData1.style.display = 'flex';
					tokenData2.style.display = 'flex';

					highlightFetch('f-cu');
					highlightFetch('f-alu');

					const coordsCU = getFetchCoords('f-cu');
					tokenInstr.style.left = coordsCU.left;
					tokenInstr.style.top = coordsCU.top;
					tokenInstr.style.transform = 'translate(-50%, -50%)';

					const coordsALU = getFetchCoords('f-alu');
					tokenData1.style.left = coordsALU.left;
					tokenData1.style.top = coordsALU.top;
					tokenData1.style.transform = 'translate(-60%, -50%)';

					tokenData2.style.left = coordsALU.left;
					tokenData2.style.top = coordsALU.top;
					tokenData2.style.transform = 'translate(60%, -50%)';

					if (desc) {
						desc.textContent = "2 - DECODE: l'operazione viene interpretata dalla CU come somma; viene dunque comunicata alla ALU insieme ai dati.";
						desc.className = "font-mono text-neon-yellow text-xs font-bold px-2";
					}
					break;

				case 3: // EXECUTE: Spariscono 3,5,+ -> Appare 8 in ALU
					tokenResult.style.display = 'flex';

					highlightFetch('f-alu');

					const coordsExec = getFetchCoords('f-alu');
					tokenResult.style.left = coordsExec.left;
					tokenResult.style.top = coordsExec.top;
					tokenResult.style.transform = 'translate(-50%, -50%) scale(1.2)';

					if (desc) {
						desc.textContent = "3 - EXECUTE: La ALU effettua la somma tra i valori e ottiene il risultato (8)";
						desc.className = "font-mono text-neon-red text-xs font-bold px-2";
					}
					break;

				case 4: // STORE: 8 va in RAM
					tokenResult.style.display = 'flex';

					highlightFetch('f-ram');
					highlightFetch('f-ram-result');

					const coordsStore = getFetchCoords('f-ram-result');
					tokenResult.style.left = coordsStore.left;
					tokenResult.style.top = coordsStore.top;
					tokenResult.style.transform = 'translate(-50%, -50%)';

					// Mostra il risultato nella cella
					if (resultCell) {
						resultCell.innerHTML = '<span class="text-xs">0x03</span> <span class="text-neon-green font-bold">DATA: 8</span>';
						resultCell.className = "w-full h-10 bg-green-900/30 border border-neon-green rounded flex items-center justify-between px-4 text-white text-sm font-mono opacity-100 shadow-[0_0_15px_rgba(0,255,157,0.3)] transition-all duration-500";
					}

					if (desc) {
						desc.textContent = "4 - STORE: Il risultato viene salvato in RAM in un altro indirizzo.";
						desc.className = "font-mono text-green-400 text-xs font-bold px-2";
					}
					break;
			}

			if (prevBtn) prevBtn.disabled = fetchStep === 0;
			if (nextBtn) nextBtn.disabled = fetchStep === 4;

			// Re-render icons inside token if innerHTML changed
			if (typeof lucide !== 'undefined') lucide.createIcons();
		}

		function nextFetchStep() {
			if (fetchStep < 4) {
				fetchStep++;
				updateFetchVisuals();
			}
		}

		function prevFetchStep() {
			if (fetchStep > 0) {
				fetchStep--;
				updateFetchVisuals();
			}
		}

		// Init
		window.addEventListener('resize', () => {
			updateVisuals();
			updateFetchVisuals();
		});

		if (typeof lucide !== 'undefined') lucide.createIcons();
		setTimeout(() => {
			updateVisuals();
			// Assicuriamoci che se partiamo da L4 sia tutto ok
			updateFetchVisuals();
		}, 100);

		/* --- LOGICA METRONOMO / CLOCK --- */
		function changeClockSpeed(speed, btn) {
			const stick = document.getElementById('metronome-stick');
			const weight = document.getElementById('metronome-weight');
			const statusText = document.getElementById('clock-status-text');
			const allBtns = document.querySelectorAll('.clock-btn');

			// Reset Stile Pulsanti
			allBtns.forEach(b => {
				b.className = "clock-btn bg-transparent text-gray-400 hover:text-white hover:bg-white/10 px-4 py-2 rounded-lg text-xs font-mono transition-all border border-transparent";
			});

			// Stile Pulsante Attivo
			btn.className = "clock-btn bg-neon-teal text-black font-bold px-4 py-2 rounded-lg text-xs font-mono transition-all scale-105 border border-transparent shadow-[0_0_10px_rgba(45,212,191,0.3)]";

			// Logica Velocità
			switch (speed) {
				case 'slow':
					stick.style.animationDuration = '2s'; // Lento (Didattico)
					// weight.style.top = '1rem'; (RIMOSSO per richiesta utente)
					statusText.textContent = "1 Hz (Didattico)";
					statusText.className = "absolute bottom-4 text-neon-teal font-mono text-xs font-bold tracking-widest uppercase z-30";
					break;
				case 'medium':
					stick.style.animationDuration = '0.6s'; // Medio (Vintage)
					// weight.style.top = '3rem'; (RIMOSSO per richiesta utente)
					statusText.textContent = "100 MHz (Vintage)";
					statusText.className = "absolute bottom-4 text-yellow-400 font-mono text-xs font-bold tracking-widest uppercase z-30";
					btn.className = "clock-btn bg-neon-yellow text-black font-bold px-4 py-2 rounded-lg text-xs font-mono transition-all scale-105 border border-transparent shadow-[0_0_15px_rgba(255,51,51,0.5)]";

					break;
				case 'fast':
					stick.style.animationDuration = '0.15s'; // Velocissimo (Moderno)
					// weight.style.top = '6rem'; (RIMOSSO per richiesta utente)
					statusText.textContent = "4 GHz (Moderno)";
					// RIMOSSO animate-pulse per leggibilità
					statusText.className = "absolute bottom-4 text-neon-teal font-mono text-xs font-bold tracking-widest uppercase z-30";

					// Cambio colore pulsante attivo in rosso per coerenza con la velocità estrema
					btn.className = "clock-btn bg-neon-red text-black font-bold px-4 py-2 rounded-lg text-xs font-mono transition-all scale-105 border border-transparent shadow-[0_0_15px_rgba(255,51,51,0.5)]";
					break;
			}
		}

		/* --- LOGICA SIMULATORE PROCESSI --- */
		let simMode = null; // Inizialmente nullo
		let simTimeouts = [];
		let isRunning = false;

		// CONFIGURAZIONE NUOVA: Durate diverse
		// T2 (Spotify): Corto
		// T1 (Word): Medio
		// T3 (Chrome): Lungo
		const TASKS_CONFIG = [
			{ id: 'T1', color: 'bg-blue-600', name: 'Word', duration: 3000 },
			{ id: 'T2', color: 'bg-green-600', name: 'Spotify', duration: 1500 },
			{ id: 'T3', color: 'bg-yellow-600', name: 'Chrome', duration: 4500 }
		];

		// Variabili di stato per simulazione
		let pendingTasks = [];
		let coresStatus = { 1: false, 2: false }; // false = libero, true = occupato

		function clearSim() {
			simTimeouts.forEach(t => clearTimeout(t));
			simTimeouts = [];
			isRunning = false;
			pendingTasks = [];
			coresStatus = { 1: false, 2: false };

			document.getElementById('sim-queue').innerHTML = '';
			document.getElementById('sim-finished').innerHTML = '';

			// Reset Cores
			resetCore('sim-core-1', 'progress-core-1');
			resetCore('sim-core-2', 'progress-core-2');
		}

		function resetCore(coreId, progId) {
			const core = document.getElementById(coreId);
			const prog = document.getElementById(progId);
			if (core) {
				// Rimuovi eventuali task visualizzati
				const taskEl = core.querySelector('.sim-task');
				if (taskEl) taskEl.remove();

				// Reset testo idle
				let idleText = core.querySelector('span');
				if (!idleText) {
					idleText = document.createElement('span');
					idleText.className = "text-gray-600 text-xs font-mono";
					core.appendChild(idleText);
				}
				// Logica visuale per Core 2 (Offline se non parallelo)
				idleText.textContent = (coreId === 'sim-core-2' && simMode !== 'parallel') ? "OFFLINE" : "IDLE";
				idleText.style.display = 'block';
			}
			if (prog) {
				prog.style.transition = 'none';
				prog.style.width = '0%';
			}
		}

		function createVisualTask(taskData) {
			const el = document.createElement('div');
			el.className = `sim-task ${taskData.color} w-full h-10 rounded-md flex items-center justify-between px-2 shadow-lg mb-1 task-queue-enter text-white text-xs font-bold font-mono`;
			el.innerHTML = `<span>${taskData.id}</span><span class="opacity-75 text-[10px]">${taskData.name}</span>`;
			el.id = `vis-${taskData.id}`;
			return el;
		}

		function setSimMode(mode) {
			clearSim();
			simMode = mode;

			// Update UI Buttons
			['seq', 'multi', 'para'].forEach(m => {
				const btn = document.getElementById(`btn-${m}`);
				if (mode === 'sequential' && m === 'seq') {
					btn.className = "px-4 py-2 rounded-md text-xs font-mono font-bold transition-all bg-neon-blue text-black shadow-[0_0_10px_rgba(0,243,255,0.4)] scale-105";
				} else if (mode === 'multitasking' && m === 'multi') {
					btn.className = "px-4 py-2 rounded-md text-xs font-mono font-bold transition-all bg-neon-purple text-black shadow-[0_0_10px_rgba(188,19,254,0.4)] scale-105";
				} else if (mode === 'parallel' && m === 'para') {
					btn.className = "px-4 py-2 rounded-md text-xs font-mono font-bold transition-all bg-neon-teal text-black shadow-[0_0_10px_rgba(45,212,191,0.4)] scale-105";
				} else {
					btn.className = "px-4 py-2 rounded-md text-xs font-mono font-bold transition-all text-gray-400 hover:text-white";
				}
			});

			// Config Core 2 Visibility
			const c2 = document.getElementById('core-2-container');
			const c2Box = document.getElementById('sim-core-2');
			if (mode === 'parallel') {
				c2.classList.remove('opacity-30', 'blur-[2px]');
				c2Box.querySelector('span').textContent = "IDLE";
			} else {
				c2.classList.add('opacity-30', 'blur-[2px]');
				c2Box.querySelector('span').textContent = "OFFLINE";
			}

			// Update Description
			const desc = document.getElementById('sim-description');
			if (mode === 'sequential') desc.innerHTML = "<strong>Sequenziale:</strong> Esegue un processo alla volta. Se Word è lento, Spotify deve aspettare che Word finisca completamente prima di iniziare.";
			if (mode === 'multitasking') desc.innerHTML = "<strong>Multitasking:</strong> La CPU dedica un breve intervallo di tempo (quanto temporale) a ciascun processo a turno, dando l'apparenza che i processi vengano eseguiti contemporaneamente.";
			if (mode === 'parallel') desc.innerHTML = "<strong>Parallelo (Multi-core):</strong> I processi vengono smistati sui due Core. Appena un Core si libera, prende subito il prossimo processo in coda senza aspettare l'altro.";

			startSimulation();
		}

		function startSimulation() {
			if (!simMode) return;

			const queueEl = document.getElementById('sim-queue');

			// Crea una copia dei task con stato di avanzamento
			// Aggiungiamo 'remaining' e 'total' per gestire il progresso
			pendingTasks = TASKS_CONFIG.map(t => ({
				...t,
				executed: 0,
				domId: `vis-${t.id}`
			}));

			// Populate Queue Visuals
			pendingTasks.forEach(t => {
				queueEl.appendChild(createVisualTask(t));
			});

			if (simMode === 'sequential') runSequential();
			if (simMode === 'multitasking') runMultitasking();
			if (simMode === 'parallel') runParallel();
		}

		/* --- 1. SEQUENZIALE --- */
		function runSequential() {
			// Esegui il primo, poi ricorsivamente il successivo
			function processNext() {
				if (pendingTasks.length === 0) return;
				const task = pendingTasks.shift(); // Prendi il primo

				runTaskOnCore(task, 1, () => {
					processNext(); // Al termine, chiama il prossimo
				});
			}
			processNext();
		}

		/* --- 2. PARALLELO (Event Driven) --- */
		function runParallel() {
			// Controlla ciclicamente se ci sono task e core liberi
			function checkAndAssign() {
				// Se non ci sono più task da assegnare (né in coda né in esecuzione), stop
				if (pendingTasks.length === 0 && !coresStatus[1] && !coresStatus[2]) return;

				// Controllo Core 1
				if (!coresStatus[1] && pendingTasks.length > 0) {
					const task = pendingTasks.shift();
					coresStatus[1] = true;
					runTaskOnCore(task, 1, () => {
						coresStatus[1] = false;
						checkAndAssign(); // Appena finisce, ricontrolla
					});
				}

				// Controllo Core 2
				if (!coresStatus[2] && pendingTasks.length > 0) {
					const task = pendingTasks.shift();
					coresStatus[2] = true;
					runTaskOnCore(task, 2, () => {
						coresStatus[2] = false;
						checkAndAssign(); // Appena finisce, ricontrolla
					});
				}
			}

			checkAndAssign(); // Avvio iniziale
		}

		/* --- Helper: Esecuzione Completa Task su Core --- */
		function runTaskOnCore(task, coreIdNum, onComplete) {
			const coreId = `sim-core-${coreIdNum}`;
			const progId = `progress-core-${coreIdNum}`;

			const taskEl = document.getElementById(task.domId);
			const core = document.getElementById(coreId);
			const prog = document.getElementById(progId);
			const finished = document.getElementById('sim-finished');

			if (!taskEl || !core) return;

			// Sposta visualmente nel core
			core.querySelector('span').style.display = 'none';
			core.appendChild(taskEl);

			// Setup barra (parte da 0)
			prog.style.transition = 'none';
			prog.style.width = '0%';

			// Forza reflow
			void prog.offsetWidth;

			// Avvia animazione
			// Usiamo setTimeout per dare tempo al browser di renderizzare lo stato 0%
			simTimeouts.push(setTimeout(() => {
				prog.style.transition = `width ${task.duration}ms linear`;
				prog.style.width = '100%';
			}, 50));

			// Schedule fine task
			simTimeouts.push(setTimeout(() => {
				// Reset barra
				prog.style.transition = 'none';
				prog.style.width = '0%';

				// Sposta nei finiti
				core.querySelector('span').style.display = 'block';
				finished.appendChild(taskEl);

				if (onComplete) onComplete();
			}, task.duration + 50));
		}


		/* --- 3. MULTITASKING (Round Robin) --- */
		function runMultitasking() {
			const TIME_SLICE = 1000; // 1 secondo per turno

			function processNextSlice() {
				if (pendingTasks.length === 0) return;

				const task = pendingTasks.shift(); // Prendi dalla testa della coda

				// LOGICA CORRETTA:
				// Se pendingTasks è vuoto dopo lo shift, significa che NON ci sono altri processi in attesa.
				// Quindi 'task' è l'unico rimasto nel sistema.
				const isOnlyTaskLeft = pendingTasks.length === 0;

				const remaining = task.duration - task.executed;

				// MODIFICA FONDAMENTALE:
				// Se è l'unico task rimasto, non lo spezzettiamo più. Lo finiamo tutto in una volta.
				// Altrimenti, usiamo il TIME_SLICE standard.
				const slice = isOnlyTaskLeft ? remaining : Math.min(TIME_SLICE, remaining);

				// Percentuali per la barra
				const startPct = (task.executed / task.duration) * 100;
				const endPct = ((task.executed + slice) / task.duration) * 100;

				// Aggiorna stato
				task.executed += slice;

				const isFinished = task.executed >= task.duration;

				// stayInCore serve se vogliamo mantenere il task nel processore senza flash visivi.
				// Se è l'unico rimasto (isOnlyTaskLeft), lo finiremo sicuramente (slice = remaining),
				// quindi isFinished sarà true e stayInCore diventerà false correttamente.
				// Manteniamo la logica per robustezza.
				const stayInCore = isOnlyTaskLeft && !isFinished;

				// Esegui visualmente lo slice
				animateSlice(task, 1, startPct, endPct, slice, stayInCore, () => {
					if (isFinished) {
						// Finito: va nella lista finiti
						const finished = document.getElementById('sim-finished');
						const tEl = document.getElementById(task.domId);
						if (tEl) finished.appendChild(tEl);

						// Resetta visivamente la barra (pulizia finale)
						const prog = document.getElementById('progress-core-1');
						if (prog) {
							prog.style.transition = 'none';
							prog.style.width = '0%';
						}
						const core = document.getElementById('sim-core-1');
						if (core) core.querySelector('span').style.display = 'block';

					} else {
						// Non finito: torna in coda
						pendingTasks.push(task);

						if (!stayInCore) {
							// Sposta visivamente SOLO se ci sono altri task in attesa
							const queue = document.getElementById('sim-queue');
							const tEl = document.getElementById(task.domId);
							if (tEl) queue.insertBefore(tEl, queue.firstChild);
						}
					}

					// Pausa scenica piccolissima poi prossimo turno
					simTimeouts.push(setTimeout(processNextSlice, 200));
				});
			}

			processNextSlice();
		}

		function animateSlice(task, coreIdNum, startPct, endPct, duration, stayInCore, callback) {
			const coreId = `sim-core-${coreIdNum}`;
			const progId = `progress-core-${coreIdNum}`;
			const taskEl = document.getElementById(task.domId);
			const core = document.getElementById(coreId);
			const prog = document.getElementById(progId);

			if (!taskEl || !core) return;

			// Sposta nel core (se non è già lì)
			core.querySelector('span').style.display = 'none';
			core.appendChild(taskEl);

			// LOGICA CRUCIALE PER MULTITASKING:
			// 1. Disabilita transizione
			// 2. Setta larghezza al punto di INIZIO dello slice
			prog.style.transition = 'none';
			prog.style.width = startPct + '%';

			// 3. Forza reflow per applicare istantaneamente il CSS
			void prog.offsetWidth;

			// 4. Riabilita transizione e imposta target
			setTimeout(() => {
				prog.style.transition = `width ${duration}ms linear`;
				prog.style.width = endPct + '%';
			}, 20);

			// 5. Fine slice
			simTimeouts.push(setTimeout(() => {

				if (!stayInCore) {
					// Se dobbiamo uscire (o scambiare), puliamo il core
					prog.style.transition = 'none';
					// Nota: Non resettiamo a 0% qui per evitare flash brutti durante lo swap,
					// verrà sovrascritto dal prossimo task o resettato se finito.

					core.querySelector('span').style.display = 'block';
				}

				if (callback) callback();
			}, duration + 50));
		}

		/* --- LOGICA CPU vs GPU RACE (LEZIONE 5) --- */
		let raceInterval = null;

		// Pattern Function: Definita fuori per essere accessibile
		function getPixelValue(idx) {
			const x = idx % 100;
			const y = Math.floor(idx / 100);

			// Coordinate relative al centro (50, 50)
			const dx = x - 50;
			const dy = y - 50;
			const dist = Math.sqrt(dx * dx + dy * dy);

			// Cerchio esterno faccia
			if (dist > 45) return false;

			// Occhi (due buchi neri)
			if (y > 30 && y < 45) {
				if (x > 30 && x < 40) return false;
				if (x > 60 && x < 70) return false;
			}

			// Bocca (sorriso)
			if (y > 65 && y < 75 && Math.abs(dx) < 25) {
				return false;
			}

			return true; // Colore pieno faccia
		}

		function initRace() {
			// Setup Visual Cores CPU (32 quadratini)
			const cpuVisual = document.getElementById('cpu-cores-visual');
			if (cpuVisual) {
				cpuVisual.innerHTML = '';
				for (let i = 0; i < 32; i++) {
					const dot = document.createElement('div');
					dot.className = 'w-1.5 h-1.5 bg-neon-teal rounded-sm m-0.5';
					cpuVisual.appendChild(dot);
				}
			}

			// Clear Canvases
			const cpuCanvas = document.getElementById('cpu-canvas');
			const gpuCanvas = document.getElementById('gpu-canvas');
			if (cpuCanvas && gpuCanvas) {
				const ctx1 = cpuCanvas.getContext('2d');
				const ctx2 = gpuCanvas.getContext('2d');
				ctx1.clearRect(0, 0, 100, 100);
				ctx2.clearRect(0, 0, 100, 100);
			}
		}

		function startCpuGpuRace() {
			const btn = document.getElementById('btn-race');
			btn.disabled = true;
			btn.classList.add('opacity-50', 'cursor-not-allowed');

			const cpuCanvas = document.getElementById('cpu-canvas');
			const gpuCanvas = document.getElementById('gpu-canvas');
			const ctxCpu = cpuCanvas.getContext('2d');
			const ctxGpu = gpuCanvas.getContext('2d');

			// Reset Grafico e Testuale SUBITO
			ctxCpu.clearRect(0, 0, 100, 100);
			ctxGpu.clearRect(0, 0, 100, 100);
			document.getElementById('cpu-progress').style.width = '0%';
			document.getElementById('gpu-progress').style.width = '0%';
			document.getElementById('cpu-stats').innerText = 'Pronto alla partenza...';
			document.getElementById('gpu-stats').innerText = 'Pronto alla partenza...';

			// Constants
			const TOTAL_PIXELS = 10000;
			const CPU_BATCH = 32;
			const WIDTH = 100;
			let cpuPixelCount = 0;

			// --- COUNTDOWN SEQUENCE (INLINE) ---
			const display = document.getElementById('race-countdown-display');
			let count = 3;

			display.innerText = count;
			display.className = "h-16 flex items-center justify-center mb-6 font-mono text-5xl font-bold text-white tracking-widest min-h-[4rem]";

			const timer = setInterval(() => {
				count--;
				if (count > 0) {
					display.innerText = count;
				} else if (count === 0) {
					display.innerText = "GO!";
					display.className = "h-16 flex items-center justify-center mb-6 font-mono text-6xl font-bold text-neon-green tracking-widest animate-ping min-h-[4rem]";
				} else {
					clearInterval(timer);
					// Pulisci il display dopo il GO
					setTimeout(() => {
						display.innerText = "";
						display.className = "h-16 flex items-center justify-center mb-6 min-h-[4rem]";
					}, 500);

					// --- START REALE DELLA GARA ---
					launchRaceLogic(ctxCpu, ctxGpu, TOTAL_PIXELS, CPU_BATCH, WIDTH);
				}
			}, 800);
		}

		function launchRaceLogic(ctxCpu, ctxGpu, TOTAL_PIXELS, CPU_BATCH, WIDTH) {
			let cpuPixelCount = 0;
			const cpuStartTime = performance.now(); // Start Timer CPU

			// 1. CPU ANIMATION (Sequenziale simulata)
			if (raceInterval) clearInterval(raceInterval);

			// Update immediato status
			document.getElementById('cpu-stats').innerText = 'Elaborazione: 0/10.000';
			document.getElementById('gpu-stats').innerText = 'Elaborazione: 0/10.000';

			raceInterval = setInterval(() => {
				// Disegna un batch di 32 pixel
				ctxCpu.fillStyle = '#2dd4bf'; // Neon Teal

				for (let k = 0; k < CPU_BATCH; k++) {
					if (cpuPixelCount < TOTAL_PIXELS) {
						const x = cpuPixelCount % WIDTH;
						const y = Math.floor(cpuPixelCount / WIDTH);

						// Calcola se disegnare il pixel
						if (getPixelValue(cpuPixelCount)) {
							ctxCpu.fillRect(x, y, 1, 1);
						}

						cpuPixelCount++;
					}
				}

				// Update UI
				const pct = (cpuPixelCount / TOTAL_PIXELS) * 100;
				document.getElementById('cpu-progress').style.width = pct + '%';
				document.getElementById('cpu-stats').innerText = `Elaborazione: ${cpuPixelCount}/10.000`;

				if (cpuPixelCount >= TOTAL_PIXELS) {
					clearInterval(raceInterval);
					const cpuEndTime = performance.now();
					const cpuDuration = (cpuEndTime - cpuStartTime).toFixed(0);
					// Mostra tempo totale CPU
					document.getElementById('cpu-stats').innerText = `Completato: ${cpuDuration}ms (313 cicli)`;
					checkRaceEnd();
				}
			}, 16);

			// 2. GPU ANIMATION (Parallela Massiccia)
			// Parte ESATTAMENTE ORA senza ritardi
			requestAnimationFrame(() => {
				const gpuStartTime = performance.now();

				ctxGpu.fillStyle = '#ff0099'; // Neon Pink

				// Simuliamo il calcolo parallelo: un singolo loop istantaneo
				for (let i = 0; i < TOTAL_PIXELS; i++) {
					const x = i % WIDTH;
					const y = Math.floor(i / WIDTH);
					if (getPixelValue(i)) {
						ctxGpu.fillRect(x, y, 1, 1);
					}
				}

				const gpuEndTime = performance.now();
				document.getElementById('gpu-progress').style.width = '100%';
				document.getElementById('gpu-stats').innerText = `Completato: ${(gpuEndTime - gpuStartTime).toFixed(2)}ms (1 ciclo)`;
			});
		}

		function checkRaceEnd() {
			const btn = document.getElementById('btn-race');
			setTimeout(() => {
				btn.disabled = false;
				btn.classList.remove('opacity-50', 'cursor-not-allowed');
			}, 1000);
		}

		// Init race on load
		document.addEventListener('DOMContentLoaded', () => {
			initRace();
		});


		let ramPower = true;
		const ramData = ["OS_KERNEL", "CHROME_EXE", "WORD_DOC", "GPU_DRIVERS", "CLIPBOARD", "SPOTIFY", "FLOWGORITHM_PROGR", "USER_SESS"];

		function initRamLesson() {
			const grid = document.getElementById('ram-grid');
			if (!grid) return;

			grid.innerHTML = '';
			ramData.forEach((data, i) => {
				const row = document.createElement('div');
				row.className = "flex border-b border-white/5 last:border-0";

				const addr = document.createElement('div');
				addr.className = "bg-black/40 px-2 py-3 border-r border-white/5 text-[8px] font-mono text-gray-600 flex items-center justify-center min-w-[50px]";
				addr.textContent = `0x${(i * 16).toString(16).toUpperCase().padStart(3, '0')}`;

				const cell = document.createElement('div');
				cell.className = "ram-cell flex-1 px-4 py-3 bg-neon-purple/5 text-[9px] font-mono text-neon-purple font-bold flex items-center justify-center shadow-inner";
				cell.id = `ram-val-${i}`;
				cell.textContent = ramPower ? data : "";

				row.appendChild(addr);
				row.appendChild(cell);
				grid.appendChild(row);
			});
			updateRamVisuals();
		}

		function toggleRamPower() {
			ramPower = !ramPower;
			updateRamVisuals();
		}

		function updateRamVisuals() {
			const btn = document.getElementById('ram-power-btn');
			if (!btn) return;

			ramData.forEach((data, i) => {
				const cell = document.getElementById(`ram-val-${i}`);
				if (!cell) return;

				if (ramPower) {
					cell.classList.remove('off');
					cell.textContent = data;
					cell.style.boxShadow = "inset 0 0 10px rgba(188,19,254,0.1)";
				} else {
					cell.classList.add('off');
					cell.textContent = "";
					cell.style.boxShadow = "none";
				}
			});

			if (ramPower) {
				btn.className = "px-4 py-2 bg-neon-green text-black font-bold rounded-full text-xs transition-all flex items-center gap-2 shadow-[0_0_15px_rgba(0,255,157,0.3)]";
				btn.innerHTML = '<i data-lucide="power"></i> <span>ALIMENTATO</span>';
			} else {
				btn.className = "px-4 py-2 bg-neon-red text-white font-bold rounded-full text-xs transition-all flex items-center gap-2 shadow-[0_0_15px_rgba(255,51,51,0.3)]";
				btn.innerHTML = '<i data-lucide="power-off"></i> <span>OFFLINE</span>';
			}
			lucide.createIcons();
		}
		/* FINE CODICE VOLATILE */
		/* CODICE VELOCITÀ - SCRIPT */
		let speedAnimating = false;

		function requestFrom(type) {
			if (speedAnimating) return;
			speedAnimating = true;

			const packet = document.getElementById('data-packet');
			const info = document.getElementById('speed-info');
			const cpu = document.getElementById('speed-cpu');
			const targetEl = document.getElementById(type === 'ram' ? 'speed-ram' : 'speed-disk');

			// --- Tempo totale per la simulazione ---
			const totalTime = type === 'ram' ? 250 : 250 * 1000; // 250ms RAM, 250s disco

			// Suddivisione in 50% andata / 50% ritorno
			const halfTime = totalTime / 2;

			// Reset UI
			info.textContent = `Richiesta inviata a ${type.toUpperCase()}...`;
			info.className = `text-[10px] font-mono mt-4 uppercase tracking-widest text-center ${type === 'ram' ? 'text-neon-purple' : 'text-neon-amber'}`;

			// Posizioni verticali
			const startY = 160;
			const endY = type === 'ram' ? 30 : 290;

			packet.classList.remove('hidden');
			packet.style.left = "calc(50% - 8px)";
			packet.style.top = startY + "px";

			// 1. ANDATA (CPU -> Memoria)
			setTimeout(() => {
				packet.style.transition = `top ${halfTime}ms linear`;
				packet.style.top = endY + "px";
			}, 50);

			// 2. RITORNO (Memoria -> CPU)
			setTimeout(() => {
				info.textContent = `Dati ricevuti da ${type.toUpperCase()}!`;
				targetEl.classList.add('scale-110', 'brightness-125');

				packet.style.transition = `top ${halfTime}ms linear`;
				packet.style.top = startY + "px";

				setTimeout(() => {
					packet.classList.add('hidden');
					speedAnimating = false;
					targetEl.classList.remove('scale-110', 'brightness-125');
					cpu.classList.add('scale-110');
					setTimeout(() => cpu.classList.remove('scale-110'), 300);
				}, halfTime);

			}, halfTime + 50); // Ritorno inizia subito dopo fine andata
		}


		/* FINE CODICE VELOCITÀ */

		const labels = Array.from({ length: 26 }, (_, i) => String.fromCharCode(65 + i));
		let isBusy = false;

		function initAccessSim() {
			const ramTrack = document.getElementById('ram-access-track');
			const tapeTrack = document.getElementById('tape-track-static');
			if (!ramTrack || !tapeTrack) return;

			ramTrack.innerHTML = '';
			tapeTrack.innerHTML = '';

			labels.forEach((l, i) => {
				// RAM Cells
				const rCont = document.createElement('div');
				rCont.className = "flex-1 flex flex-col items-center overflow-hidden";
				rCont.innerHTML = `
			                 <div id="ram-${l}" class="access-cell w-full h-6 bg-white/5 rounded-[1px] border border-white/5 flex items-center justify-center font-mono text-[6px] text-gray-600">${l}</div>
			                 <span class="text-[4px] text-gray-700 mt-1 font-mono">${i * 8}</span>
			             `;
				ramTrack.appendChild(rCont);

				// Tape Cells
				const tCell = document.createElement('div');
				tCell.id = `tape-${l}`;
				tCell.className = "access-cell flex-1 h-6 bg-white/5 rounded-[1px] border border-white/5 flex items-center justify-center font-mono text-[6px] text-gray-600";
				tCell.textContent = l;
				tapeTrack.appendChild(tCell);
			});

			const head = document.getElementById('read-head');
			if (head) {
				head.style.left = "0%";
				head.style.opacity = "0";
			}

			const input = document.getElementById('letter-input');
			if (input) {
				input.addEventListener('input', (e) => {
					const val = e.target.value.toUpperCase();
					if (labels.includes(val)) {
						simulateUnifiedAccess(val);
					} else if (val !== "") {
						e.target.value = "";
					}
				});
			}
		}

		async function simulateUnifiedAccess(letter) {
			if (isBusy) return;
			isBusy = true;

			const index = labels.indexOf(letter);
			const address = index * 8;
			const calcDisplay = document.getElementById('calc-display');
			const head = document.getElementById('read-head');
			const msg = document.getElementById('calc-display-msg');
			const trackCells = document.querySelectorAll('#tape-track-static .access-cell');

			document.querySelectorAll('.access-cell').forEach(c => {
				c.classList.remove('active-ram', 'active-seq', 'opacity-20');
				c.classList.add('text-gray-600');
			});

			// 1. RAM CALC
			if (calcDisplay) {
				calcDisplay.innerHTML = `<div class="animate-fade-in space-y-0.5">
			                 <p class="text-white font-mono text-[10px]">Input: <span class="text-neon-blue font-bold">"${letter}"</span> - Lettera n° ${index + 1} (n° ${index} partendo da 0) </p>
			                 <p class="text-white font-mono text-[10px]">Indirizzo = Indice ${index} &times; 8 = <span class="text-neon-purple font-bold underline">Indirizzo ${address}</span></p>
			                 <p class="text-[10px] text-neon-purple font-bold tracking-widest mt-1">TROVATO! Ho effettuato 1 fase di lettura casuale. </p>
			             </div>`;
			}

			setTimeout(() => {
				const rCell = document.getElementById(`ram-${letter}`);
				if (rCell) { rCell.classList.add('active-ram'); rCell.classList.remove('text-gray-600'); }
			}, 150);

			// 2. SEQUENTIAL
			if (head && trackCells.length > 0) {
				head.style.opacity = "1";
				for (let i = 0; i <= index; i++) {
					if (msg) msg.innerHTML = ` <p class="text-[10px] text-neon-amber font-bold tracking-widest mt-1"> Scansione: cella ${labels[i]}... </p>`;

					const currentCell = trackCells[i];
					head.style.left = `${currentCell.offsetLeft}px`;
					head.style.width = `${currentCell.offsetWidth}px`;

					currentCell.classList.add('active-seq');
					currentCell.classList.remove('text-gray-600');

					await new Promise(r => setTimeout(r, 250));

					if (i < index) {
						currentCell.classList.remove('active-seq');
						currentCell.classList.add('opacity-20');
					} else {
						if (msg) msg.innerHTML = `<p class="text-[10px] text-neon-amber font-bold tracking-widest mt-1">TROVATO! Ho effettuato ${i + 1} fasi di lettura sequenziale. </p>`;
					}
				}
			}

			setTimeout(() => { isBusy = false; }, 400);
		}
		let capacitors = [100, 0, 100, 100, 0, 100, 0, 0];
		let refreshInterval = null;
		let isSimulationStarted = false;

		function initRefreshSim() {
			const container = document.getElementById('refresh-sim-container');
			if (!container) return;

			isSimulationStarted = false; // Reset stato
			if (refreshInterval) clearInterval(refreshInterval);

			container.innerHTML = '';
			capacitors = [100, 0, 100, 100, 0, 100, 0, 0]; // Reset cariche

			capacitors.forEach((charge, i) => {
				const bit = document.createElement('div');
				bit.className = "flex flex-col items-center gap-3";
				bit.innerHTML = `
			                 <div class="w-8 md:w-10 h-48 bg-gray-900 border border-white/10 rounded-full relative overflow-hidden flex flex-col justify-end">
			                     <div id="cap-fill-${i}" class="w-full capacitor-charge bg-neon-blue/40 shadow-[0_0:15px_rgba(0,243,255,0.3)]" style="height: ${charge}%"></div>
			                 </div>
			                 <div class="flex flex-col items-center">
			                     <span id="cap-val-${i}" class="font-mono text-lg font-bold ${charge > 0 ? 'text-white' : 'text-gray-700'}">${charge > 0 ? '1' : '0'}</span>
			                     <span class="text-[9px] text-white-600 font-mono uppercase">Bit ${7 - i}</span>
			                 </div>
			             `;
				container.appendChild(bit);
			});

			// Configura l'Observer per far partire lo svuotamento solo quando visibile
			setupRefreshObserver();
		}

		function setupRefreshObserver() {
			const target = document.getElementById('refresh-sim-target');
			if (!target) return;

			const observer = new IntersectionObserver((entries) => {
				entries.forEach(entry => {
					// Se l'elemento è visibile almeno al 50% e la simulazione non è già partita
					if (entry.isIntersecting && !isSimulationStarted) {
						startDischarging();
						isSimulationStarted = true;
					}
				});
			}, { threshold: 0.5 });

			observer.observe(target);
		}

		function startDischarging() {
			if (refreshInterval) clearInterval(refreshInterval);
			refreshInterval = setInterval(updateCapacitors, 100);
		}

		function updateCapacitors() {
			capacitors.forEach((charge, i) => {
				if (charge > 0) {
					capacitors[i] = Math.max(0, charge - 0.8);
					const fill = document.getElementById(`cap-fill-${i}`);
					const val = document.getElementById(`cap-val-${i}`);
					if (fill) fill.style.height = `${capacitors[i]}%`;
					if (capacitors[i] <= 0) {
						if (fill) fill.style.backgroundColor = "transparent";
						if (val) {
							val.textContent = "0";
							val.classList.replace('text-white', 'text-neon-red');
							val.classList.add('animate-pulse');
						}
					} else if (capacitors[i] < 30) {
						if (fill) fill.style.backgroundColor = "#ff3333";
					}
				}
			});
		}

		function performRefresh() {
			capacitors.forEach((charge, i) => {
				if (charge > 0) {
					capacitors[i] = 100;
					const fill = document.getElementById(`cap-fill-${i}`);
					const val = document.getElementById(`cap-val-${i}`);
					if (fill) { fill.style.height = "100%"; fill.style.backgroundColor = ""; }
					if (val) { val.textContent = "1"; val.className = "font-mono text-lg font-bold text-white"; }
				}
			});
			const btn = document.querySelector('[onclick="performRefresh()"]');
			btn.classList.add('brightness-150');
			setTimeout(() => btn.classList.remove('brightness-150'), 100);
		}

		document.addEventListener('keydown', (e) => {
			const lessonVisible = !document.getElementById('lesson-6-view').classList.contains('hidden');
			if (!lessonVisible || isBusy) return;
			const key = e.key.toUpperCase();
			if (labels.includes(key)) {
				const input = document.getElementById('letter-input');
				if (input) { input.value = key; simulateUnifiedAccess(key); }
			}
		});
		window.onload = () => { navigateTo('home'); };
		function initMatrixSim() {
			const cabinet = document.getElementById('drawer-cabinet');
			const stack = document.getElementById('ram-stack-container');
			const matrix = document.getElementById('matrix-container');
			const funnel = document.getElementById('zoom-funnel');
			const svg = document.getElementById('zoom-lines-svg');

			if (!cabinet || !stack || !matrix || !funnel || !svg) return;

			// 1. Popola Cassettiera
			cabinet.innerHTML = '';
			for (let d = 0; d < 15; d++) {
				const dr = document.createElement('div');
				dr.className = "drawer-box";
				dr.innerHTML = `<div class="drawer-handle"></div><span class="absolute right-1 bottom-0.5 text-[5px] font-mono text-gray-600">${d}</span>`;
				cabinet.appendChild(dr);
			}

			// 2. Popola Stack
			stack.innerHTML = '<div id="zoom-indicator-target" class="absolute top-2 left-0 w-full h-12 bg-neon-purple/40 border-y border-neon-purple z-10 pointer-events-none shadow-[0_0:15px_rgba(188,19,254,0.3)]"></div>';
			for (let s = 0; s < 28; s++) {
				const line = document.createElement('div');
				line.className = "ram-stack-line";
				stack.appendChild(line);
			}

			// 3. Popola Matrix
			matrix.innerHTML = '';
			for (let r = 0; r < 8; r++) {
				const row = document.createElement('div');
				row.className = "matrix-row flex items-center group transition-all duration-200 rounded py-1 border border-transparent hover:border-neon-purple/30";
				const addr = document.createElement('div');
				addr.className = "row-addr w-10 text-[8px] font-mono text-gray-500 flex items-center justify-center font-bold";
				addr.textContent = `0x${(r * 8).toString(16).toUpperCase().padStart(2, '0')}`;

				const bitsCont = document.createElement('div');
				bitsCont.className = "flex-1 flex justify-center gap-1 px-2";
				for (let b = 0; b < 8; b++) {
					const isOn = Math.random() > 0.5;
					const bit = document.createElement('div');
					bit.className = `matrix-bit w-5 h-5 border border-white/10 rounded-[1px] font-mono text-[8px] font-bold ${isOn ? 'bg-neon-purple/60 border-neon-purple/80 text-white' : 'bg-black/80 text-gray-700'}`;
					bit.textContent = isOn ? '1' : '0';
					bitsCont.appendChild(bit);
				}
				row.appendChild(addr); row.appendChild(bitsCont); matrix.appendChild(row);
			}

			// 4. Sincronizzazione Millimetrica IMBUTO
			setTimeout(() => {
				const indicator = document.getElementById('zoom-indicator-target');
				const zoomBox = document.getElementById('matrix-zoom-box');
				if (indicator && zoomBox) {
					const svgRect = svg.getBoundingClientRect();
					const indRect = indicator.getBoundingClientRect();
					const boxRect = zoomBox.getBoundingClientRect();
					const p1y = indRect.top - svgRect.top;
					const p2y = boxRect.top - svgRect.top;
					const p3y = boxRect.bottom - svgRect.top;
					const p4y = indRect.bottom - svgRect.top;
					const svgW = svg.clientWidth;
					funnel.setAttribute('points', `0,${p1y} ${svgW},${p2y} ${svgW},${p3y} 0,${p4y}`);
				}
			}, 500);
		}

		/* NUOVA LOGICA LENTE DI INGRANDIMENTO: SELEZIONE + SHORTCUT (Alt + Z) */
		let isMagnifierOpen = false;
		const magnifierBox = document.getElementById('magnifier-box');
		const magnifierContent = document.getElementById('magnifier-content');
		const magnifierHeader = document.getElementById('magnifier-header');

		window.openMagnifier = function (text) {
			if (!text || text.trim().length === 0) return;
			magnifierContent.textContent = text.trim();
			magnifierBox.style.display = 'flex';
			// Riporta al centro solo se è la prima apertura o resettato
			magnifierBox.style.top = '50%';
			magnifierBox.style.left = '50%';
			magnifierBox.style.transform = 'translate(-50%, -50%)';
			magnifierBox.style.width = '800px';
			magnifierBox.style.height = '350px';
			isMagnifierOpen = true;
			lucide.createIcons();
		}

		window.closeMagnifier = function () {
			const box = document.getElementById('magnifier-box');
			if (box) box.style.display = 'none';
			isMagnifierOpen = false;
		};

		document.getElementById('magnifier-close').addEventListener('click', closeMagnifier);

		// Shortcut Alt + Z
		document.addEventListener('keydown', (e) => {
			if (e.altKey && (e.key === 'z' || e.key === 'Z')) {
				const selection = window.getSelection().toString();
				if (selection) {
					openMagnifier(selection);
				}
			}
			// Escape per chiudere
			if (e.key === 'Escape' && isMagnifierOpen) {
				closeMagnifier();
			}
		});

		// Logica di Trascinamento (Drag)
		let isDragging = false;
		let offsetPosX, offsetPosY;

		magnifierHeader.addEventListener('mousedown', (e) => {
			// Se clicchiamo sulla X o dentro il pulsante di chiusura, non dobbiamo trascinare
			if (e.target.closest('#magnifier-close')) return;

			isDragging = true;
			const rect = magnifierBox.getBoundingClientRect();
			offsetPosX = e.clientX - rect.left;
			offsetPosY = e.clientY - rect.top;
			magnifierBox.style.transform = 'none';
			magnifierBox.style.left = rect.left + 'px';
			magnifierBox.style.top = rect.top + 'px';
		});

		document.getElementById('magnifier-close').addEventListener('mousedown', (e) => {
			e.stopPropagation(); // Impedisce al mousedown di arrivare all'header
		});

		document.getElementById('magnifier-close').addEventListener('click', (e) => {
			e.stopPropagation();
			closeMagnifier();
		});

		// Logica di Ridimensionamento (Resize) Bottom-Left
		let isResizingBL = false;
		const resizeHandleBL = document.getElementById('magnifier-resize-bl');

		resizeHandleBL.addEventListener('mousedown', (e) => {
			e.stopPropagation();
			e.preventDefault();
			isResizingBL = true;
		});

		document.addEventListener('mousemove', (e) => {
			if (isDragging) {
				magnifierBox.style.left = (e.clientX - offsetPosX) + 'px';
				magnifierBox.style.top = (e.clientY - offsetPosY) + 'px';
			} else if (isResizingBL) {
				const rect = magnifierBox.getBoundingClientRect();
				const newWidth = rect.right - e.clientX;
				const newHeight = e.clientY - rect.top;

				// Applichiamo limiti minimi e massimi
				if (newWidth > 300 && newWidth < window.innerWidth * 0.95) {
					magnifierBox.style.width = newWidth + 'px';
					magnifierBox.style.left = e.clientX + 'px';
				}
				if (newHeight > 150 && newHeight < window.innerHeight * 0.85) {
					magnifierBox.style.height = newHeight + 'px';
				}
			}
		});

		document.addEventListener('mouseup', () => {
			isDragging = false;
			isResizingBL = false;
		});

	</script>
</body>

</html>